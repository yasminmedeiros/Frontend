{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\nvar isNumeric = require('fast-isnumeric');\nvar tinycolor = require('tinycolor2');\nvar Registry = require('../../registry');\nvar Color = require('../color');\nvar Colorscale = require('../colorscale');\nvar Lib = require('../../lib');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\nvar alignment = require('../../constants/alignment');\nvar LINE_SPACING = alignment.LINE_SPACING;\nvar DESELECTDIM = require('../../constants/interactions').DESELECTDIM;\nvar subTypes = require('../../traces/scatter/subtypes');\nvar makeBubbleSizeFn = require('../../traces/scatter/make_bubble_size_func');\nvar drawing = module.exports = {};\n\n// -----------------------------------------------------\n// styling functions for plot elements\n// -----------------------------------------------------\n\ndrawing.font = function (s, family, size, color) {\n  // also allow the form font(s, {family, size, color})\n  if (Lib.isPlainObject(family)) {\n    color = family.color;\n    size = family.size;\n    family = family.family;\n  }\n  if (family) s.style('font-family', family);\n  if (size + 1) s.style('font-size', size + 'px');\n  if (color) s.call(Color.fill, color);\n};\n\n/*\n * Positioning helpers\n * Note: do not use `setPosition` with <text> nodes modified by\n * `svgTextUtils.convertToTspans`. Use `svgTextUtils.positionText`\n * instead, so that <tspan.line> elements get updated to match.\n */\ndrawing.setPosition = function (s, x, y) {\n  s.attr('x', x).attr('y', y);\n};\ndrawing.setSize = function (s, w, h) {\n  s.attr('width', w).attr('height', h);\n};\ndrawing.setRect = function (s, x, y, w, h) {\n  s.call(drawing.setPosition, x, y).call(drawing.setSize, w, h);\n};\n\n/** Translate node\n *\n * @param {object} d : calcdata point item\n * @param {sel} sel : d3 selction of node to translate\n * @param {object} xa : corresponding full xaxis object\n * @param {object} ya : corresponding full yaxis object\n *\n * @return {boolean} :\n *  true if selection got translated\n *  false if selection could not get translated\n */\ndrawing.translatePoint = function (d, sel, xa, ya) {\n  var x = xa.c2p(d.x);\n  var y = ya.c2p(d.y);\n  if (isNumeric(x) && isNumeric(y) && sel.node()) {\n    // for multiline text this works better\n    if (sel.node().nodeName === 'text') {\n      sel.attr('x', x).attr('y', y);\n    } else {\n      sel.attr('transform', 'translate(' + x + ',' + y + ')');\n    }\n  } else {\n    return false;\n  }\n  return true;\n};\ndrawing.translatePoints = function (s, xa, ya) {\n  s.each(function (d) {\n    var sel = d3.select(this);\n    drawing.translatePoint(d, sel, xa, ya);\n  });\n};\ndrawing.hideOutsideRangePoint = function (d, sel, xa, ya, xcalendar, ycalendar) {\n  sel.attr('display', xa.isPtWithinRange(d, xcalendar) && ya.isPtWithinRange(d, ycalendar) ? null : 'none');\n};\ndrawing.hideOutsideRangePoints = function (traceGroups, subplot) {\n  if (!subplot._hasClipOnAxisFalse) return;\n  var xa = subplot.xaxis;\n  var ya = subplot.yaxis;\n  traceGroups.each(function (d) {\n    var trace = d[0].trace;\n    var xcalendar = trace.xcalendar;\n    var ycalendar = trace.ycalendar;\n    var selector = trace.type === 'bar' ? '.bartext' : '.point,.textpoint';\n    traceGroups.selectAll(selector).each(function (d) {\n      drawing.hideOutsideRangePoint(d, d3.select(this), xa, ya, xcalendar, ycalendar);\n    });\n  });\n};\ndrawing.crispRound = function (gd, lineWidth, dflt) {\n  // for lines that disable antialiasing we want to\n  // make sure the width is an integer, and at least 1 if it's nonzero\n\n  if (!lineWidth || !isNumeric(lineWidth)) return dflt || 0;\n\n  // but not for static plots - these don't get antialiased anyway.\n  if (gd._context.staticPlot) return lineWidth;\n  if (lineWidth < 1) return 1;\n  return Math.round(lineWidth);\n};\ndrawing.singleLineStyle = function (d, s, lw, lc, ld) {\n  s.style('fill', 'none');\n  var line = (((d || [])[0] || {}).trace || {}).line || {};\n  var lw1 = lw || line.width || 0;\n  var dash = ld || line.dash || '';\n  Color.stroke(s, lc || line.color);\n  drawing.dashLine(s, dash, lw1);\n};\ndrawing.lineGroupStyle = function (s, lw, lc, ld) {\n  s.style('fill', 'none').each(function (d) {\n    var line = (((d || [])[0] || {}).trace || {}).line || {};\n    var lw1 = lw || line.width || 0;\n    var dash = ld || line.dash || '';\n    d3.select(this).call(Color.stroke, lc || line.color).call(drawing.dashLine, dash, lw1);\n  });\n};\ndrawing.dashLine = function (s, dash, lineWidth) {\n  lineWidth = +lineWidth || 0;\n  dash = drawing.dashStyle(dash, lineWidth);\n  s.style({\n    'stroke-dasharray': dash,\n    'stroke-width': lineWidth + 'px'\n  });\n};\ndrawing.dashStyle = function (dash, lineWidth) {\n  lineWidth = +lineWidth || 1;\n  var dlw = Math.max(lineWidth, 3);\n  if (dash === 'solid') dash = '';else if (dash === 'dot') dash = dlw + 'px,' + dlw + 'px';else if (dash === 'dash') dash = 3 * dlw + 'px,' + 3 * dlw + 'px';else if (dash === 'longdash') dash = 5 * dlw + 'px,' + 5 * dlw + 'px';else if (dash === 'dashdot') {\n    dash = 3 * dlw + 'px,' + dlw + 'px,' + dlw + 'px,' + dlw + 'px';\n  } else if (dash === 'longdashdot') {\n    dash = 5 * dlw + 'px,' + 2 * dlw + 'px,' + dlw + 'px,' + 2 * dlw + 'px';\n  }\n  // otherwise user wrote the dasharray themselves - leave it be\n\n  return dash;\n};\n\n// Same as fillGroupStyle, except in this case the selection may be a transition\ndrawing.singleFillStyle = function (sel) {\n  var node = d3.select(sel.node());\n  var data = node.data();\n  var fillcolor = (((data[0] || [])[0] || {}).trace || {}).fillcolor;\n  if (fillcolor) {\n    sel.call(Color.fill, fillcolor);\n  }\n};\ndrawing.fillGroupStyle = function (s) {\n  s.style('stroke-width', 0).each(function (d) {\n    var shape = d3.select(this);\n    // N.B. 'd' won't be a calcdata item when\n    // fill !== 'none' on a segment-less and marker-less trace\n    if (d[0].trace) {\n      shape.call(Color.fill, d[0].trace.fillcolor);\n    }\n  });\n};\nvar SYMBOLDEFS = require('./symbol_defs');\ndrawing.symbolNames = [];\ndrawing.symbolFuncs = [];\ndrawing.symbolNeedLines = {};\ndrawing.symbolNoDot = {};\ndrawing.symbolNoFill = {};\ndrawing.symbolList = [];\nObject.keys(SYMBOLDEFS).forEach(function (k) {\n  var symDef = SYMBOLDEFS[k];\n  drawing.symbolList = drawing.symbolList.concat([symDef.n, k, symDef.n + 100, k + '-open']);\n  drawing.symbolNames[symDef.n] = k;\n  drawing.symbolFuncs[symDef.n] = symDef.f;\n  if (symDef.needLine) {\n    drawing.symbolNeedLines[symDef.n] = true;\n  }\n  if (symDef.noDot) {\n    drawing.symbolNoDot[symDef.n] = true;\n  } else {\n    drawing.symbolList = drawing.symbolList.concat([symDef.n + 200, k + '-dot', symDef.n + 300, k + '-open-dot']);\n  }\n  if (symDef.noFill) {\n    drawing.symbolNoFill[symDef.n] = true;\n  }\n});\nvar MAXSYMBOL = drawing.symbolNames.length;\n// add a dot in the middle of the symbol\nvar DOTPATH = 'M0,0.5L0.5,0L0,-0.5L-0.5,0Z';\ndrawing.symbolNumber = function (v) {\n  if (typeof v === 'string') {\n    var vbase = 0;\n    if (v.indexOf('-open') > 0) {\n      vbase = 100;\n      v = v.replace('-open', '');\n    }\n    if (v.indexOf('-dot') > 0) {\n      vbase += 200;\n      v = v.replace('-dot', '');\n    }\n    v = drawing.symbolNames.indexOf(v);\n    if (v >= 0) {\n      v += vbase;\n    }\n  }\n  if (v % 100 >= MAXSYMBOL || v >= 400) {\n    return 0;\n  }\n  return Math.floor(Math.max(v, 0));\n};\nfunction makePointPath(symbolNumber, r) {\n  var base = symbolNumber % 100;\n  return drawing.symbolFuncs[base](r) + (symbolNumber >= 200 ? DOTPATH : '');\n}\nvar HORZGRADIENT = {\n  x1: 1,\n  x2: 0,\n  y1: 0,\n  y2: 0\n};\nvar VERTGRADIENT = {\n  x1: 0,\n  x2: 0,\n  y1: 1,\n  y2: 0\n};\nvar stopFormatter = d3.format('~.1f');\nvar gradientInfo = {\n  radial: {\n    node: 'radialGradient'\n  },\n  radialreversed: {\n    node: 'radialGradient',\n    reversed: true\n  },\n  horizontal: {\n    node: 'linearGradient',\n    attrs: HORZGRADIENT\n  },\n  horizontalreversed: {\n    node: 'linearGradient',\n    attrs: HORZGRADIENT,\n    reversed: true\n  },\n  vertical: {\n    node: 'linearGradient',\n    attrs: VERTGRADIENT\n  },\n  verticalreversed: {\n    node: 'linearGradient',\n    attrs: VERTGRADIENT,\n    reversed: true\n  }\n};\n\n/**\n * gradient: create and apply a gradient fill\n *\n * @param {object} sel: d3 selection to apply this gradient to\n *     You can use `selection.call(Drawing.gradient, ...)`\n * @param {DOM element} gd: the graph div `sel` is part of\n * @param {string} gradientID: a unique (within this plot) identifier\n *     for this gradient, so that we don't create unnecessary definitions\n * @param {string} type: 'radial', 'horizontal', or 'vertical', optionally with\n *     'reversed' at the end. Normally radial goes center to edge,\n *     horizontal goes right to left, and vertical goes bottom to top\n * @param {array} colorscale: as in attribute values, [[fraction, color], ...]\n * @param {string} prop: the property to apply to, 'fill' or 'stroke'\n */\ndrawing.gradient = function (sel, gd, gradientID, type, colorscale, prop) {\n  var len = colorscale.length;\n  var info = gradientInfo[type];\n  var colorStops = new Array(len);\n  for (var i = 0; i < len; i++) {\n    if (info.reversed) {\n      colorStops[len - 1 - i] = [stopFormatter((1 - colorscale[i][0]) * 100), colorscale[i][1]];\n    } else {\n      colorStops[i] = [stopFormatter(colorscale[i][0] * 100), colorscale[i][1]];\n    }\n  }\n  var fullID = 'g' + gd._fullLayout._uid + '-' + gradientID;\n  var gradient = gd._fullLayout._defs.select('.gradients').selectAll('#' + fullID).data([type + colorStops.join(';')], Lib.identity);\n  gradient.exit().remove();\n  gradient.enter().append(info.node).each(function () {\n    var el = d3.select(this);\n    if (info.attrs) el.attr(info.attrs);\n    el.attr('id', fullID);\n    var stops = el.selectAll('stop').data(colorStops);\n    stops.exit().remove();\n    stops.enter().append('stop');\n    stops.each(function (d) {\n      var tc = tinycolor(d[1]);\n      d3.select(this).attr({\n        offset: d[0] + '%',\n        'stop-color': Color.tinyRGB(tc),\n        'stop-opacity': tc.getAlpha()\n      });\n    });\n  });\n  sel.style(prop, 'url(#' + fullID + ')').style(prop + '-opacity', null);\n};\n\n/*\n * Make the gradients container and clear out any previous gradients.\n * We never collect all the gradients we need in one place,\n * so we can't ever remove gradients that have stopped being useful,\n * except all at once before a full redraw.\n * The upside of this is arbitrary points can share gradient defs\n */\ndrawing.initGradients = function (gd) {\n  var gradientsGroup = Lib.ensureSingle(gd._fullLayout._defs, 'g', 'gradients');\n  gradientsGroup.selectAll('linearGradient,radialGradient').remove();\n};\ndrawing.pointStyle = function (s, trace, gd) {\n  if (!s.size()) return;\n  var fns = drawing.makePointStyleFns(trace);\n  s.each(function (d) {\n    drawing.singlePointStyle(d, d3.select(this), trace, fns, gd);\n  });\n};\ndrawing.singlePointStyle = function (d, sel, trace, fns, gd) {\n  var marker = trace.marker;\n  var markerLine = marker.line;\n  sel.style('opacity', fns.selectedOpacityFn ? fns.selectedOpacityFn(d) : d.mo === undefined ? marker.opacity : d.mo);\n  if (fns.ms2mrc) {\n    var r;\n\n    // handle multi-trace graph edit case\n    if (d.ms === 'various' || marker.size === 'various') {\n      r = 3;\n    } else {\n      r = fns.ms2mrc(d.ms);\n    }\n\n    // store the calculated size so hover can use it\n    d.mrc = r;\n    if (fns.selectedSizeFn) {\n      r = d.mrc = fns.selectedSizeFn(d);\n    }\n\n    // turn the symbol into a sanitized number\n    var x = drawing.symbolNumber(d.mx || marker.symbol) || 0;\n\n    // save if this marker is open\n    // because that impacts how to handle colors\n    d.om = x % 200 >= 100;\n    sel.attr('d', makePointPath(x, r));\n  }\n  var perPointGradient = false;\n  var fillColor, lineColor, lineWidth;\n\n  // 'so' is suspected outliers, for box plots\n  if (d.so) {\n    lineWidth = markerLine.outlierwidth;\n    lineColor = markerLine.outliercolor;\n    fillColor = marker.outliercolor;\n  } else {\n    var markerLineWidth = (markerLine || {}).width;\n    lineWidth = (d.mlw + 1 || markerLineWidth + 1 ||\n    // TODO: we need the latter for legends... can we get rid of it?\n    (d.trace ? (d.trace.marker.line || {}).width : 0) + 1) - 1 || 0;\n    if ('mlc' in d) lineColor = d.mlcc = fns.lineScale(d.mlc);\n    // weird case: array wasn't long enough to apply to every point\n    else if (Lib.isArrayOrTypedArray(markerLine.color)) lineColor = Color.defaultLine;else lineColor = markerLine.color;\n    if (Lib.isArrayOrTypedArray(marker.color)) {\n      fillColor = Color.defaultLine;\n      perPointGradient = true;\n    }\n    if ('mc' in d) {\n      fillColor = d.mcc = fns.markerScale(d.mc);\n    } else {\n      fillColor = marker.color || 'rgba(0,0,0,0)';\n    }\n    if (fns.selectedColorFn) {\n      fillColor = fns.selectedColorFn(d);\n    }\n  }\n  if (d.om) {\n    // open markers can't have zero linewidth, default to 1px,\n    // and use fill color as stroke color\n    sel.call(Color.stroke, fillColor).style({\n      'stroke-width': (lineWidth || 1) + 'px',\n      fill: 'none'\n    });\n  } else {\n    sel.style('stroke-width', lineWidth + 'px');\n    var markerGradient = marker.gradient;\n    var gradientType = d.mgt;\n    if (gradientType) perPointGradient = true;else gradientType = markerGradient && markerGradient.type;\n\n    // for legend - arrays will propagate through here, but we don't need\n    // to treat it as per-point.\n    if (Array.isArray(gradientType)) {\n      gradientType = gradientType[0];\n      if (!gradientInfo[gradientType]) gradientType = 0;\n    }\n    if (gradientType && gradientType !== 'none') {\n      var gradientColor = d.mgc;\n      if (gradientColor) perPointGradient = true;else gradientColor = markerGradient.color;\n      var gradientID = trace.uid;\n      if (perPointGradient) gradientID += '-' + d.i;\n      drawing.gradient(sel, gd, gradientID, gradientType, [[0, gradientColor], [1, fillColor]], 'fill');\n    } else {\n      Color.fill(sel, fillColor);\n    }\n    if (lineWidth) {\n      Color.stroke(sel, lineColor);\n    }\n  }\n};\ndrawing.makePointStyleFns = function (trace) {\n  var out = {};\n  var marker = trace.marker;\n\n  // allow array marker and marker line colors to be\n  // scaled by given max and min to colorscales\n  out.markerScale = drawing.tryColorscale(marker, '');\n  out.lineScale = drawing.tryColorscale(marker, 'line');\n  if (Registry.traceIs(trace, 'symbols')) {\n    out.ms2mrc = subTypes.isBubble(trace) ? makeBubbleSizeFn(trace) : function () {\n      return (marker.size || 6) / 2;\n    };\n  }\n  if (trace.selectedpoints) {\n    Lib.extendFlat(out, drawing.makeSelectedPointStyleFns(trace));\n  }\n  return out;\n};\ndrawing.makeSelectedPointStyleFns = function (trace) {\n  var out = {};\n  var selectedAttrs = trace.selected || {};\n  var unselectedAttrs = trace.unselected || {};\n  var marker = trace.marker || {};\n  var selectedMarker = selectedAttrs.marker || {};\n  var unselectedMarker = unselectedAttrs.marker || {};\n  var mo = marker.opacity;\n  var smo = selectedMarker.opacity;\n  var usmo = unselectedMarker.opacity;\n  var smoIsDefined = smo !== undefined;\n  var usmoIsDefined = usmo !== undefined;\n  if (Lib.isArrayOrTypedArray(mo) || smoIsDefined || usmoIsDefined) {\n    out.selectedOpacityFn = function (d) {\n      var base = d.mo === undefined ? marker.opacity : d.mo;\n      if (d.selected) {\n        return smoIsDefined ? smo : base;\n      } else {\n        return usmoIsDefined ? usmo : DESELECTDIM * base;\n      }\n    };\n  }\n  var mc = marker.color;\n  var smc = selectedMarker.color;\n  var usmc = unselectedMarker.color;\n  if (smc || usmc) {\n    out.selectedColorFn = function (d) {\n      var base = d.mcc || mc;\n      if (d.selected) {\n        return smc || base;\n      } else {\n        return usmc || base;\n      }\n    };\n  }\n  var ms = marker.size;\n  var sms = selectedMarker.size;\n  var usms = unselectedMarker.size;\n  var smsIsDefined = sms !== undefined;\n  var usmsIsDefined = usms !== undefined;\n  if (Registry.traceIs(trace, 'symbols') && (smsIsDefined || usmsIsDefined)) {\n    out.selectedSizeFn = function (d) {\n      var base = d.mrc || ms / 2;\n      if (d.selected) {\n        return smsIsDefined ? sms / 2 : base;\n      } else {\n        return usmsIsDefined ? usms / 2 : base;\n      }\n    };\n  }\n  return out;\n};\ndrawing.makeSelectedTextStyleFns = function (trace) {\n  var out = {};\n  var selectedAttrs = trace.selected || {};\n  var unselectedAttrs = trace.unselected || {};\n  var textFont = trace.textfont || {};\n  var selectedTextFont = selectedAttrs.textfont || {};\n  var unselectedTextFont = unselectedAttrs.textfont || {};\n  var tc = textFont.color;\n  var stc = selectedTextFont.color;\n  var utc = unselectedTextFont.color;\n  out.selectedTextColorFn = function (d) {\n    var base = d.tc || tc;\n    if (d.selected) {\n      return stc || base;\n    } else {\n      if (utc) return utc;else return stc ? base : Color.addOpacity(base, DESELECTDIM);\n    }\n  };\n  return out;\n};\ndrawing.selectedPointStyle = function (s, trace) {\n  if (!s.size() || !trace.selectedpoints) return;\n  var fns = drawing.makeSelectedPointStyleFns(trace);\n  var marker = trace.marker || {};\n  var seq = [];\n  if (fns.selectedOpacityFn) {\n    seq.push(function (pt, d) {\n      pt.style('opacity', fns.selectedOpacityFn(d));\n    });\n  }\n  if (fns.selectedColorFn) {\n    seq.push(function (pt, d) {\n      Color.fill(pt, fns.selectedColorFn(d));\n    });\n  }\n  if (fns.selectedSizeFn) {\n    seq.push(function (pt, d) {\n      var mx = d.mx || marker.symbol || 0;\n      var mrc2 = fns.selectedSizeFn(d);\n      pt.attr('d', makePointPath(drawing.symbolNumber(mx), mrc2));\n\n      // save for Drawing.selectedTextStyle\n      d.mrc2 = mrc2;\n    });\n  }\n  if (seq.length) {\n    s.each(function (d) {\n      var pt = d3.select(this);\n      for (var i = 0; i < seq.length; i++) {\n        seq[i](pt, d);\n      }\n    });\n  }\n};\ndrawing.tryColorscale = function (marker, prefix) {\n  var cont = prefix ? Lib.nestedProperty(marker, prefix).get() : marker;\n  if (cont) {\n    var scl = cont.colorscale;\n    var colorArray = cont.color;\n    if (scl && Lib.isArrayOrTypedArray(colorArray)) {\n      return Colorscale.makeColorScaleFunc(Colorscale.extractScale(cont, {\n        cLetter: 'c'\n      }));\n    }\n  }\n  return Lib.identity;\n};\nvar TEXTOFFSETSIGN = {\n  start: 1,\n  end: -1,\n  middle: 0,\n  bottom: 1,\n  top: -1\n};\nfunction textPointPosition(s, textPosition, fontSize, markerRadius) {\n  var group = d3.select(s.node().parentNode);\n  var v = textPosition.indexOf('top') !== -1 ? 'top' : textPosition.indexOf('bottom') !== -1 ? 'bottom' : 'middle';\n  var h = textPosition.indexOf('left') !== -1 ? 'end' : textPosition.indexOf('right') !== -1 ? 'start' : 'middle';\n\n  // if markers are shown, offset a little more than\n  // the nominal marker size\n  // ie 2/1.6 * nominal, bcs some markers are a bit bigger\n  var r = markerRadius ? markerRadius / 0.8 + 1 : 0;\n  var numLines = (svgTextUtils.lineCount(s) - 1) * LINE_SPACING + 1;\n  var dx = TEXTOFFSETSIGN[h] * r;\n  var dy = fontSize * 0.75 + TEXTOFFSETSIGN[v] * r + (TEXTOFFSETSIGN[v] - 1) * numLines * fontSize / 2;\n\n  // fix the overall text group position\n  s.attr('text-anchor', h);\n  group.attr('transform', 'translate(' + dx + ',' + dy + ')');\n}\nfunction extracTextFontSize(d, trace) {\n  var fontSize = d.ts || trace.textfont.size;\n  return isNumeric(fontSize) && fontSize > 0 ? fontSize : 0;\n}\n\n// draw text at points\ndrawing.textPointStyle = function (s, trace, gd) {\n  if (!s.size()) return;\n  var selectedTextColorFn;\n  if (trace.selectedpoints) {\n    var fns = drawing.makeSelectedTextStyleFns(trace);\n    selectedTextColorFn = fns.selectedTextColorFn;\n  }\n  s.each(function (d) {\n    var p = d3.select(this);\n    var text = Lib.extractOption(d, trace, 'tx', 'text');\n    if (!text && text !== 0) {\n      p.remove();\n      return;\n    }\n    var pos = d.tp || trace.textposition;\n    var fontSize = extracTextFontSize(d, trace);\n    var fontColor = selectedTextColorFn ? selectedTextColorFn(d) : d.tc || trace.textfont.color;\n    p.call(drawing.font, d.tf || trace.textfont.family, fontSize, fontColor).text(text).call(svgTextUtils.convertToTspans, gd).call(textPointPosition, pos, fontSize, d.mrc);\n  });\n};\ndrawing.selectedTextStyle = function (s, trace) {\n  if (!s.size() || !trace.selectedpoints) return;\n  var fns = drawing.makeSelectedTextStyleFns(trace);\n  s.each(function (d) {\n    var tx = d3.select(this);\n    var tc = fns.selectedTextColorFn(d);\n    var tp = d.tp || trace.textposition;\n    var fontSize = extracTextFontSize(d, trace);\n    Color.fill(tx, tc);\n    textPointPosition(tx, tp, fontSize, d.mrc2 || d.mrc);\n  });\n};\n\n// generalized Catmull-Rom splines, per\n// http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf\nvar CatmullRomExp = 0.5;\ndrawing.smoothopen = function (pts, smoothness) {\n  if (pts.length < 3) {\n    return 'M' + pts.join('L');\n  }\n  var path = 'M' + pts[0];\n  var tangents = [];\n  var i;\n  for (i = 1; i < pts.length - 1; i++) {\n    tangents.push(makeTangent(pts[i - 1], pts[i], pts[i + 1], smoothness));\n  }\n  path += 'Q' + tangents[0][0] + ' ' + pts[1];\n  for (i = 2; i < pts.length - 1; i++) {\n    path += 'C' + tangents[i - 2][1] + ' ' + tangents[i - 1][0] + ' ' + pts[i];\n  }\n  path += 'Q' + tangents[pts.length - 3][1] + ' ' + pts[pts.length - 1];\n  return path;\n};\ndrawing.smoothclosed = function (pts, smoothness) {\n  if (pts.length < 3) {\n    return 'M' + pts.join('L') + 'Z';\n  }\n  var path = 'M' + pts[0];\n  var pLast = pts.length - 1;\n  var tangents = [makeTangent(pts[pLast], pts[0], pts[1], smoothness)];\n  var i;\n  for (i = 1; i < pLast; i++) {\n    tangents.push(makeTangent(pts[i - 1], pts[i], pts[i + 1], smoothness));\n  }\n  tangents.push(makeTangent(pts[pLast - 1], pts[pLast], pts[0], smoothness));\n  for (i = 1; i <= pLast; i++) {\n    path += 'C' + tangents[i - 1][1] + ' ' + tangents[i][0] + ' ' + pts[i];\n  }\n  path += 'C' + tangents[pLast][1] + ' ' + tangents[0][0] + ' ' + pts[0] + 'Z';\n  return path;\n};\nfunction makeTangent(prevpt, thispt, nextpt, smoothness) {\n  var d1x = prevpt[0] - thispt[0];\n  var d1y = prevpt[1] - thispt[1];\n  var d2x = nextpt[0] - thispt[0];\n  var d2y = nextpt[1] - thispt[1];\n  var d1a = Math.pow(d1x * d1x + d1y * d1y, CatmullRomExp / 2);\n  var d2a = Math.pow(d2x * d2x + d2y * d2y, CatmullRomExp / 2);\n  var numx = (d2a * d2a * d1x - d1a * d1a * d2x) * smoothness;\n  var numy = (d2a * d2a * d1y - d1a * d1a * d2y) * smoothness;\n  var denom1 = 3 * d2a * (d1a + d2a);\n  var denom2 = 3 * d1a * (d1a + d2a);\n  return [[d3.round(thispt[0] + (denom1 && numx / denom1), 2), d3.round(thispt[1] + (denom1 && numy / denom1), 2)], [d3.round(thispt[0] - (denom2 && numx / denom2), 2), d3.round(thispt[1] - (denom2 && numy / denom2), 2)]];\n}\n\n// step paths - returns a generator function for paths\n// with the given step shape\nvar STEPPATH = {\n  hv: function hv(p0, p1) {\n    return 'H' + d3.round(p1[0], 2) + 'V' + d3.round(p1[1], 2);\n  },\n  vh: function vh(p0, p1) {\n    return 'V' + d3.round(p1[1], 2) + 'H' + d3.round(p1[0], 2);\n  },\n  hvh: function hvh(p0, p1) {\n    return 'H' + d3.round((p0[0] + p1[0]) / 2, 2) + 'V' + d3.round(p1[1], 2) + 'H' + d3.round(p1[0], 2);\n  },\n  vhv: function vhv(p0, p1) {\n    return 'V' + d3.round((p0[1] + p1[1]) / 2, 2) + 'H' + d3.round(p1[0], 2) + 'V' + d3.round(p1[1], 2);\n  }\n};\nvar STEPLINEAR = function STEPLINEAR(p0, p1) {\n  return 'L' + d3.round(p1[0], 2) + ',' + d3.round(p1[1], 2);\n};\ndrawing.steps = function (shape) {\n  var onestep = STEPPATH[shape] || STEPLINEAR;\n  return function (pts) {\n    var path = 'M' + d3.round(pts[0][0], 2) + ',' + d3.round(pts[0][1], 2);\n    for (var i = 1; i < pts.length; i++) {\n      path += onestep(pts[i - 1], pts[i]);\n    }\n    return path;\n  };\n};\n\n// off-screen svg render testing element, shared by the whole page\n// uses the id 'js-plotly-tester' and stores it in drawing.tester\ndrawing.makeTester = function () {\n  var tester = Lib.ensureSingleById(d3.select('body'), 'svg', 'js-plotly-tester', function (s) {\n    s.attr(xmlnsNamespaces.svgAttrs).style({\n      position: 'absolute',\n      left: '-10000px',\n      top: '-10000px',\n      width: '9000px',\n      height: '9000px',\n      'z-index': '1'\n    });\n  });\n\n  // browsers differ on how they describe the bounding rect of\n  // the svg if its contents spill over... so make a 1x1px\n  // reference point we can measure off of.\n  var testref = Lib.ensureSingle(tester, 'path', 'js-reference-point', function (s) {\n    s.attr('d', 'M0,0H1V1H0Z').style({\n      'stroke-width': 0,\n      fill: 'black'\n    });\n  });\n  drawing.tester = tester;\n  drawing.testref = testref;\n};\n\n/*\n * use our offscreen tester to get a clientRect for an element,\n * in a reference frame where it isn't translated (or transformed) and\n * its anchor point is at (0,0)\n * always returns a copy of the bbox, so the caller can modify it safely\n *\n * @param {SVGElement} node: the element to measure. If possible this should be\n *   a <text> or MathJax <g> element that's already passed through\n *   `convertToTspans` because in that case we can cache the results, but it's\n *   possible to pass in any svg element.\n *\n * @param {boolean} inTester: is this element already in `drawing.tester`?\n *   If you are measuring a dummy element, rather than one you really intend\n *   to use on the plot, making it in `drawing.tester` in the first place\n *   allows us to test faster because it cuts out cloning and appending it.\n *\n * @param {string} hash: for internal use only, if we already know the cache key\n *   for this element beforehand.\n *\n * @return {object}: a plain object containing the width, height, left, right,\n *   top, and bottom of `node`\n */\ndrawing.savedBBoxes = {};\nvar savedBBoxesCount = 0;\nvar maxSavedBBoxes = 10000;\ndrawing.bBox = function (node, inTester, hash) {\n  /*\n   * Cache elements we've already measured so we don't have to\n   * remeasure the same thing many times\n   * We have a few bBox callers though who pass a node larger than\n   * a <text> or a MathJax <g>, such as an axis group containing many labels.\n   * These will not generate a hash (unless we figure out an appropriate\n   * hash key for them) and thus we will not hash them.\n   */\n  if (!hash) hash = nodeHash(node);\n  var out;\n  if (hash) {\n    out = drawing.savedBBoxes[hash];\n    if (out) return Lib.extendFlat({}, out);\n  } else if (node.childNodes.length === 1) {\n    /*\n     * If we have only one child element, which is itself hashable, make\n     * a new hash from this element plus its x,y,transform\n     * These bounding boxes *include* x,y,transform - mostly for use by\n     * callers trying to avoid overlaps (ie titles)\n     */\n    var innerNode = node.childNodes[0];\n    hash = nodeHash(innerNode);\n    if (hash) {\n      var x = +innerNode.getAttribute('x') || 0;\n      var y = +innerNode.getAttribute('y') || 0;\n      var transform = innerNode.getAttribute('transform');\n      if (!transform) {\n        // in this case, just varying x and y, don't bother caching\n        // the final bBox because the alteration is quick.\n        var innerBB = drawing.bBox(innerNode, false, hash);\n        if (x) {\n          innerBB.left += x;\n          innerBB.right += x;\n        }\n        if (y) {\n          innerBB.top += y;\n          innerBB.bottom += y;\n        }\n        return innerBB;\n      }\n      /*\n       * else we have a transform - rather than make a complicated\n       * (and error-prone and probably slow) transform parser/calculator,\n       * just continue on calculating the boundingClientRect of the group\n       * and use the new composite hash to cache it.\n       * That said, `innerNode.transform.baseVal` is an array of\n       * `SVGTransform` objects, that *do* seem to have a nice matrix\n       * multiplication interface that we could use to avoid making\n       * another getBoundingClientRect call...\n       */\n      hash += '~' + x + '~' + y + '~' + transform;\n      out = drawing.savedBBoxes[hash];\n      if (out) return Lib.extendFlat({}, out);\n    }\n  }\n  var testNode, tester;\n  if (inTester) {\n    testNode = node;\n  } else {\n    tester = drawing.tester.node();\n\n    // copy the node to test into the tester\n    testNode = node.cloneNode(true);\n    tester.appendChild(testNode);\n  }\n\n  // standardize its position (and newline tspans if any)\n  d3.select(testNode).attr('transform', null).call(svgTextUtils.positionText, 0, 0);\n  var testRect = testNode.getBoundingClientRect();\n  var refRect = drawing.testref.node().getBoundingClientRect();\n  if (!inTester) tester.removeChild(testNode);\n  var bb = {\n    height: testRect.height,\n    width: testRect.width,\n    left: testRect.left - refRect.left,\n    top: testRect.top - refRect.top,\n    right: testRect.right - refRect.left,\n    bottom: testRect.bottom - refRect.top\n  };\n\n  // make sure we don't have too many saved boxes,\n  // or a long session could overload on memory\n  // by saving boxes for long-gone elements\n  if (savedBBoxesCount >= maxSavedBBoxes) {\n    drawing.savedBBoxes = {};\n    savedBBoxesCount = 0;\n  }\n\n  // cache this bbox\n  if (hash) drawing.savedBBoxes[hash] = bb;\n  savedBBoxesCount++;\n  return Lib.extendFlat({}, bb);\n};\n\n// capture everything about a node (at least in our usage) that\n// impacts its bounding box, given that bBox clears x, y, and transform\nfunction nodeHash(node) {\n  var inputText = node.getAttribute('data-unformatted');\n  if (inputText === null) return;\n  return inputText + node.getAttribute('data-math') + node.getAttribute('text-anchor') + node.getAttribute('style');\n}\n\n/**\n * Set clipPath URL in a way that work for all situations.\n *\n * In details, graphs on pages with <base> HTML tags need to prepend\n * the clip path ids with the page's base url EXCEPT during toImage exports.\n *\n * @param {d3 selection} s : node to add clip-path attribute\n * @param {string} localId : local clip-path (w/o base url) id\n * @param {DOM element || object} gd\n * - context._baseUrl {string}\n * - context._exportedPlot {boolean}\n */\ndrawing.setClipUrl = function (s, localId, gd) {\n  if (!localId) {\n    s.attr('clip-path', null);\n    return;\n  }\n  var context = gd._context;\n  var baseUrl = context._exportedPlot ? '' : context._baseUrl || '';\n  s.attr('clip-path', 'url(' + baseUrl + '#' + localId + ')');\n};\ndrawing.getTranslate = function (element) {\n  // Note the separator [^\\d] between x and y in this regex\n  // We generally use ',' but IE will convert it to ' '\n  var re = /.*\\btranslate\\((-?\\d*\\.?\\d*)[^-\\d]*(-?\\d*\\.?\\d*)[^\\d].*/;\n  var getter = element.attr ? 'attr' : 'getAttribute';\n  var transform = element[getter]('transform') || '';\n  var translate = transform.replace(re, function (match, p1, p2) {\n    return [p1, p2].join(' ');\n  }).split(' ');\n  return {\n    x: +translate[0] || 0,\n    y: +translate[1] || 0\n  };\n};\ndrawing.setTranslate = function (element, x, y) {\n  var re = /(\\btranslate\\(.*?\\);?)/;\n  var getter = element.attr ? 'attr' : 'getAttribute';\n  var setter = element.attr ? 'attr' : 'setAttribute';\n  var transform = element[getter]('transform') || '';\n  x = x || 0;\n  y = y || 0;\n  transform = transform.replace(re, '').trim();\n  transform += ' translate(' + x + ', ' + y + ')';\n  transform = transform.trim();\n  element[setter]('transform', transform);\n  return transform;\n};\ndrawing.getScale = function (element) {\n  var re = /.*\\bscale\\((\\d*\\.?\\d*)[^\\d]*(\\d*\\.?\\d*)[^\\d].*/;\n  var getter = element.attr ? 'attr' : 'getAttribute';\n  var transform = element[getter]('transform') || '';\n  var translate = transform.replace(re, function (match, p1, p2) {\n    return [p1, p2].join(' ');\n  }).split(' ');\n  return {\n    x: +translate[0] || 1,\n    y: +translate[1] || 1\n  };\n};\ndrawing.setScale = function (element, x, y) {\n  var re = /(\\bscale\\(.*?\\);?)/;\n  var getter = element.attr ? 'attr' : 'getAttribute';\n  var setter = element.attr ? 'attr' : 'setAttribute';\n  var transform = element[getter]('transform') || '';\n  x = x || 1;\n  y = y || 1;\n  transform = transform.replace(re, '').trim();\n  transform += ' scale(' + x + ', ' + y + ')';\n  transform = transform.trim();\n  element[setter]('transform', transform);\n  return transform;\n};\nvar SCALE_RE = /\\s*sc.*/;\ndrawing.setPointGroupScale = function (selection, xScale, yScale) {\n  xScale = xScale || 1;\n  yScale = yScale || 1;\n  if (!selection) return;\n\n  // The same scale transform for every point:\n  var scale = xScale === 1 && yScale === 1 ? '' : ' scale(' + xScale + ',' + yScale + ')';\n  selection.each(function () {\n    var t = (this.getAttribute('transform') || '').replace(SCALE_RE, '');\n    t += scale;\n    t = t.trim();\n    this.setAttribute('transform', t);\n  });\n};\nvar TEXT_POINT_LAST_TRANSLATION_RE = /translate\\([^)]*\\)\\s*$/;\ndrawing.setTextPointsScale = function (selection, xScale, yScale) {\n  if (!selection) return;\n  selection.each(function () {\n    var transforms;\n    var el = d3.select(this);\n    var text = el.select('text');\n    if (!text.node()) return;\n    var x = parseFloat(text.attr('x') || 0);\n    var y = parseFloat(text.attr('y') || 0);\n    var existingTransform = (el.attr('transform') || '').match(TEXT_POINT_LAST_TRANSLATION_RE);\n    if (xScale === 1 && yScale === 1) {\n      transforms = [];\n    } else {\n      transforms = ['translate(' + x + ',' + y + ')', 'scale(' + xScale + ',' + yScale + ')', 'translate(' + -x + ',' + -y + ')'];\n    }\n    if (existingTransform) {\n      transforms.push(existingTransform);\n    }\n    el.attr('transform', transforms.join(' '));\n  });\n};","map":{"version":3,"names":["d3","require","isNumeric","tinycolor","Registry","Color","Colorscale","Lib","svgTextUtils","xmlnsNamespaces","alignment","LINE_SPACING","DESELECTDIM","subTypes","makeBubbleSizeFn","drawing","module","exports","font","s","family","size","color","isPlainObject","style","call","fill","setPosition","x","y","attr","setSize","w","h","setRect","translatePoint","d","sel","xa","ya","c2p","node","nodeName","translatePoints","each","select","hideOutsideRangePoint","xcalendar","ycalendar","isPtWithinRange","hideOutsideRangePoints","traceGroups","subplot","_hasClipOnAxisFalse","xaxis","yaxis","trace","selector","type","selectAll","crispRound","gd","lineWidth","dflt","_context","staticPlot","Math","round","singleLineStyle","lw","lc","ld","line","lw1","width","dash","stroke","dashLine","lineGroupStyle","dashStyle","dlw","max","singleFillStyle","data","fillcolor","fillGroupStyle","shape","SYMBOLDEFS","symbolNames","symbolFuncs","symbolNeedLines","symbolNoDot","symbolNoFill","symbolList","Object","keys","forEach","k","symDef","concat","n","f","needLine","noDot","noFill","MAXSYMBOL","length","DOTPATH","symbolNumber","v","vbase","indexOf","replace","floor","makePointPath","r","base","HORZGRADIENT","x1","x2","y1","y2","VERTGRADIENT","stopFormatter","format","gradientInfo","radial","radialreversed","reversed","horizontal","attrs","horizontalreversed","vertical","verticalreversed","gradient","gradientID","colorscale","prop","len","info","colorStops","Array","i","fullID","_fullLayout","_uid","_defs","join","identity","exit","remove","enter","append","el","stops","tc","offset","tinyRGB","getAlpha","initGradients","gradientsGroup","ensureSingle","pointStyle","fns","makePointStyleFns","singlePointStyle","marker","markerLine","selectedOpacityFn","mo","undefined","opacity","ms2mrc","ms","mrc","selectedSizeFn","mx","symbol","om","perPointGradient","fillColor","lineColor","so","outlierwidth","outliercolor","markerLineWidth","mlw","mlcc","lineScale","mlc","isArrayOrTypedArray","defaultLine","mcc","markerScale","mc","selectedColorFn","markerGradient","gradientType","mgt","isArray","gradientColor","mgc","uid","out","tryColorscale","traceIs","isBubble","selectedpoints","extendFlat","makeSelectedPointStyleFns","selectedAttrs","selected","unselectedAttrs","unselected","selectedMarker","unselectedMarker","smo","usmo","smoIsDefined","usmoIsDefined","smc","usmc","sms","usms","smsIsDefined","usmsIsDefined","makeSelectedTextStyleFns","textFont","textfont","selectedTextFont","unselectedTextFont","stc","utc","selectedTextColorFn","addOpacity","selectedPointStyle","seq","push","pt","mrc2","prefix","cont","nestedProperty","get","scl","colorArray","makeColorScaleFunc","extractScale","cLetter","TEXTOFFSETSIGN","start","end","middle","bottom","top","textPointPosition","textPosition","fontSize","markerRadius","group","parentNode","numLines","lineCount","dx","dy","extracTextFontSize","ts","textPointStyle","p","text","extractOption","pos","tp","textposition","fontColor","tf","convertToTspans","selectedTextStyle","tx","CatmullRomExp","smoothopen","pts","smoothness","path","tangents","makeTangent","smoothclosed","pLast","prevpt","thispt","nextpt","d1x","d1y","d2x","d2y","d1a","pow","d2a","numx","numy","denom1","denom2","STEPPATH","hv","p0","p1","vh","hvh","vhv","STEPLINEAR","steps","onestep","makeTester","tester","ensureSingleById","svgAttrs","position","left","height","testref","savedBBoxes","savedBBoxesCount","maxSavedBBoxes","bBox","inTester","hash","nodeHash","childNodes","innerNode","getAttribute","transform","innerBB","right","testNode","cloneNode","appendChild","positionText","testRect","getBoundingClientRect","refRect","removeChild","bb","inputText","setClipUrl","localId","context","baseUrl","_exportedPlot","_baseUrl","getTranslate","element","re","getter","translate","match","p2","split","setTranslate","setter","trim","getScale","setScale","SCALE_RE","setPointGroupScale","selection","xScale","yScale","scale","t","setAttribute","TEXT_POINT_LAST_TRANSLATION_RE","setTextPointsScale","transforms","parseFloat","existingTransform"],"sources":["/home/yasmin/√Årea de Trabalho/Frontend/node_modules/plotly.js/src/components/drawing/index.js"],"sourcesContent":["/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n\n'use strict';\n\nvar d3 = require('d3');\nvar isNumeric = require('fast-isnumeric');\nvar tinycolor = require('tinycolor2');\n\nvar Registry = require('../../registry');\nvar Color = require('../color');\nvar Colorscale = require('../colorscale');\nvar Lib = require('../../lib');\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\nvar alignment = require('../../constants/alignment');\nvar LINE_SPACING = alignment.LINE_SPACING;\nvar DESELECTDIM = require('../../constants/interactions').DESELECTDIM;\n\nvar subTypes = require('../../traces/scatter/subtypes');\nvar makeBubbleSizeFn = require('../../traces/scatter/make_bubble_size_func');\n\nvar drawing = module.exports = {};\n\n// -----------------------------------------------------\n// styling functions for plot elements\n// -----------------------------------------------------\n\ndrawing.font = function(s, family, size, color) {\n    // also allow the form font(s, {family, size, color})\n    if(Lib.isPlainObject(family)) {\n        color = family.color;\n        size = family.size;\n        family = family.family;\n    }\n    if(family) s.style('font-family', family);\n    if(size + 1) s.style('font-size', size + 'px');\n    if(color) s.call(Color.fill, color);\n};\n\n/*\n * Positioning helpers\n * Note: do not use `setPosition` with <text> nodes modified by\n * `svgTextUtils.convertToTspans`. Use `svgTextUtils.positionText`\n * instead, so that <tspan.line> elements get updated to match.\n */\ndrawing.setPosition = function(s, x, y) { s.attr('x', x).attr('y', y); };\ndrawing.setSize = function(s, w, h) { s.attr('width', w).attr('height', h); };\ndrawing.setRect = function(s, x, y, w, h) {\n    s.call(drawing.setPosition, x, y).call(drawing.setSize, w, h);\n};\n\n/** Translate node\n *\n * @param {object} d : calcdata point item\n * @param {sel} sel : d3 selction of node to translate\n * @param {object} xa : corresponding full xaxis object\n * @param {object} ya : corresponding full yaxis object\n *\n * @return {boolean} :\n *  true if selection got translated\n *  false if selection could not get translated\n */\ndrawing.translatePoint = function(d, sel, xa, ya) {\n    var x = xa.c2p(d.x);\n    var y = ya.c2p(d.y);\n\n    if(isNumeric(x) && isNumeric(y) && sel.node()) {\n        // for multiline text this works better\n        if(sel.node().nodeName === 'text') {\n            sel.attr('x', x).attr('y', y);\n        } else {\n            sel.attr('transform', 'translate(' + x + ',' + y + ')');\n        }\n    } else {\n        return false;\n    }\n\n    return true;\n};\n\ndrawing.translatePoints = function(s, xa, ya) {\n    s.each(function(d) {\n        var sel = d3.select(this);\n        drawing.translatePoint(d, sel, xa, ya);\n    });\n};\n\ndrawing.hideOutsideRangePoint = function(d, sel, xa, ya, xcalendar, ycalendar) {\n    sel.attr(\n        'display',\n        (xa.isPtWithinRange(d, xcalendar) && ya.isPtWithinRange(d, ycalendar)) ? null : 'none'\n    );\n};\n\ndrawing.hideOutsideRangePoints = function(traceGroups, subplot) {\n    if(!subplot._hasClipOnAxisFalse) return;\n\n    var xa = subplot.xaxis;\n    var ya = subplot.yaxis;\n\n    traceGroups.each(function(d) {\n        var trace = d[0].trace;\n        var xcalendar = trace.xcalendar;\n        var ycalendar = trace.ycalendar;\n        var selector = trace.type === 'bar' ? '.bartext' : '.point,.textpoint';\n\n        traceGroups.selectAll(selector).each(function(d) {\n            drawing.hideOutsideRangePoint(d, d3.select(this), xa, ya, xcalendar, ycalendar);\n        });\n    });\n};\n\ndrawing.crispRound = function(gd, lineWidth, dflt) {\n    // for lines that disable antialiasing we want to\n    // make sure the width is an integer, and at least 1 if it's nonzero\n\n    if(!lineWidth || !isNumeric(lineWidth)) return dflt || 0;\n\n    // but not for static plots - these don't get antialiased anyway.\n    if(gd._context.staticPlot) return lineWidth;\n\n    if(lineWidth < 1) return 1;\n    return Math.round(lineWidth);\n};\n\ndrawing.singleLineStyle = function(d, s, lw, lc, ld) {\n    s.style('fill', 'none');\n    var line = (((d || [])[0] || {}).trace || {}).line || {};\n    var lw1 = lw || line.width||0;\n    var dash = ld || line.dash || '';\n\n    Color.stroke(s, lc || line.color);\n    drawing.dashLine(s, dash, lw1);\n};\n\ndrawing.lineGroupStyle = function(s, lw, lc, ld) {\n    s.style('fill', 'none')\n    .each(function(d) {\n        var line = (((d || [])[0] || {}).trace || {}).line || {};\n        var lw1 = lw || line.width||0;\n        var dash = ld || line.dash || '';\n\n        d3.select(this)\n            .call(Color.stroke, lc || line.color)\n            .call(drawing.dashLine, dash, lw1);\n    });\n};\n\ndrawing.dashLine = function(s, dash, lineWidth) {\n    lineWidth = +lineWidth || 0;\n\n    dash = drawing.dashStyle(dash, lineWidth);\n\n    s.style({\n        'stroke-dasharray': dash,\n        'stroke-width': lineWidth + 'px'\n    });\n};\n\ndrawing.dashStyle = function(dash, lineWidth) {\n    lineWidth = +lineWidth || 1;\n    var dlw = Math.max(lineWidth, 3);\n\n    if(dash === 'solid') dash = '';\n    else if(dash === 'dot') dash = dlw + 'px,' + dlw + 'px';\n    else if(dash === 'dash') dash = (3 * dlw) + 'px,' + (3 * dlw) + 'px';\n    else if(dash === 'longdash') dash = (5 * dlw) + 'px,' + (5 * dlw) + 'px';\n    else if(dash === 'dashdot') {\n        dash = (3 * dlw) + 'px,' + dlw + 'px,' + dlw + 'px,' + dlw + 'px';\n    }\n    else if(dash === 'longdashdot') {\n        dash = (5 * dlw) + 'px,' + (2 * dlw) + 'px,' + dlw + 'px,' + (2 * dlw) + 'px';\n    }\n    // otherwise user wrote the dasharray themselves - leave it be\n\n    return dash;\n};\n\n// Same as fillGroupStyle, except in this case the selection may be a transition\ndrawing.singleFillStyle = function(sel) {\n    var node = d3.select(sel.node());\n    var data = node.data();\n    var fillcolor = (((data[0] || [])[0] || {}).trace || {}).fillcolor;\n    if(fillcolor) {\n        sel.call(Color.fill, fillcolor);\n    }\n};\n\ndrawing.fillGroupStyle = function(s) {\n    s.style('stroke-width', 0)\n    .each(function(d) {\n        var shape = d3.select(this);\n        // N.B. 'd' won't be a calcdata item when\n        // fill !== 'none' on a segment-less and marker-less trace\n        if(d[0].trace) {\n            shape.call(Color.fill, d[0].trace.fillcolor);\n        }\n    });\n};\n\nvar SYMBOLDEFS = require('./symbol_defs');\n\ndrawing.symbolNames = [];\ndrawing.symbolFuncs = [];\ndrawing.symbolNeedLines = {};\ndrawing.symbolNoDot = {};\ndrawing.symbolNoFill = {};\ndrawing.symbolList = [];\n\nObject.keys(SYMBOLDEFS).forEach(function(k) {\n    var symDef = SYMBOLDEFS[k];\n    drawing.symbolList = drawing.symbolList.concat(\n        [symDef.n, k, symDef.n + 100, k + '-open']);\n    drawing.symbolNames[symDef.n] = k;\n    drawing.symbolFuncs[symDef.n] = symDef.f;\n    if(symDef.needLine) {\n        drawing.symbolNeedLines[symDef.n] = true;\n    }\n    if(symDef.noDot) {\n        drawing.symbolNoDot[symDef.n] = true;\n    }\n    else {\n        drawing.symbolList = drawing.symbolList.concat(\n            [symDef.n + 200, k + '-dot', symDef.n + 300, k + '-open-dot']);\n    }\n    if(symDef.noFill) {\n        drawing.symbolNoFill[symDef.n] = true;\n    }\n});\n\nvar MAXSYMBOL = drawing.symbolNames.length;\n// add a dot in the middle of the symbol\nvar DOTPATH = 'M0,0.5L0.5,0L0,-0.5L-0.5,0Z';\n\ndrawing.symbolNumber = function(v) {\n    if(typeof v === 'string') {\n        var vbase = 0;\n        if(v.indexOf('-open') > 0) {\n            vbase = 100;\n            v = v.replace('-open', '');\n        }\n        if(v.indexOf('-dot') > 0) {\n            vbase += 200;\n            v = v.replace('-dot', '');\n        }\n        v = drawing.symbolNames.indexOf(v);\n        if(v >= 0) { v += vbase; }\n    }\n    if((v % 100 >= MAXSYMBOL) || v >= 400) { return 0; }\n    return Math.floor(Math.max(v, 0));\n};\n\nfunction makePointPath(symbolNumber, r) {\n    var base = symbolNumber % 100;\n    return drawing.symbolFuncs[base](r) + (symbolNumber >= 200 ? DOTPATH : '');\n}\n\nvar HORZGRADIENT = {x1: 1, x2: 0, y1: 0, y2: 0};\nvar VERTGRADIENT = {x1: 0, x2: 0, y1: 1, y2: 0};\nvar stopFormatter = d3.format('~.1f');\nvar gradientInfo = {\n    radial: {node: 'radialGradient'},\n    radialreversed: {node: 'radialGradient', reversed: true},\n    horizontal: {node: 'linearGradient', attrs: HORZGRADIENT},\n    horizontalreversed: {node: 'linearGradient', attrs: HORZGRADIENT, reversed: true},\n    vertical: {node: 'linearGradient', attrs: VERTGRADIENT},\n    verticalreversed: {node: 'linearGradient', attrs: VERTGRADIENT, reversed: true}\n};\n\n/**\n * gradient: create and apply a gradient fill\n *\n * @param {object} sel: d3 selection to apply this gradient to\n *     You can use `selection.call(Drawing.gradient, ...)`\n * @param {DOM element} gd: the graph div `sel` is part of\n * @param {string} gradientID: a unique (within this plot) identifier\n *     for this gradient, so that we don't create unnecessary definitions\n * @param {string} type: 'radial', 'horizontal', or 'vertical', optionally with\n *     'reversed' at the end. Normally radial goes center to edge,\n *     horizontal goes right to left, and vertical goes bottom to top\n * @param {array} colorscale: as in attribute values, [[fraction, color], ...]\n * @param {string} prop: the property to apply to, 'fill' or 'stroke'\n */\ndrawing.gradient = function(sel, gd, gradientID, type, colorscale, prop) {\n    var len = colorscale.length;\n    var info = gradientInfo[type];\n    var colorStops = new Array(len);\n    for(var i = 0; i < len; i++) {\n        if(info.reversed) {\n            colorStops[len - 1 - i] = [stopFormatter((1 - colorscale[i][0]) * 100), colorscale[i][1]];\n        }\n        else {\n            colorStops[i] = [stopFormatter(colorscale[i][0] * 100), colorscale[i][1]];\n        }\n    }\n\n    var fullID = 'g' + gd._fullLayout._uid + '-' + gradientID;\n\n    var gradient = gd._fullLayout._defs.select('.gradients')\n        .selectAll('#' + fullID)\n        .data([type + colorStops.join(';')], Lib.identity);\n\n    gradient.exit().remove();\n\n    gradient.enter()\n        .append(info.node)\n        .each(function() {\n            var el = d3.select(this);\n            if(info.attrs) el.attr(info.attrs);\n\n            el.attr('id', fullID);\n\n            var stops = el.selectAll('stop')\n                .data(colorStops);\n            stops.exit().remove();\n            stops.enter().append('stop');\n\n            stops.each(function(d) {\n                var tc = tinycolor(d[1]);\n                d3.select(this).attr({\n                    offset: d[0] + '%',\n                    'stop-color': Color.tinyRGB(tc),\n                    'stop-opacity': tc.getAlpha()\n                });\n            });\n        });\n\n    sel.style(prop, 'url(#' + fullID + ')')\n        .style(prop + '-opacity', null);\n};\n\n/*\n * Make the gradients container and clear out any previous gradients.\n * We never collect all the gradients we need in one place,\n * so we can't ever remove gradients that have stopped being useful,\n * except all at once before a full redraw.\n * The upside of this is arbitrary points can share gradient defs\n */\ndrawing.initGradients = function(gd) {\n    var gradientsGroup = Lib.ensureSingle(gd._fullLayout._defs, 'g', 'gradients');\n    gradientsGroup.selectAll('linearGradient,radialGradient').remove();\n};\n\n\ndrawing.pointStyle = function(s, trace, gd) {\n    if(!s.size()) return;\n\n    var fns = drawing.makePointStyleFns(trace);\n\n    s.each(function(d) {\n        drawing.singlePointStyle(d, d3.select(this), trace, fns, gd);\n    });\n};\n\ndrawing.singlePointStyle = function(d, sel, trace, fns, gd) {\n    var marker = trace.marker;\n    var markerLine = marker.line;\n\n    sel.style('opacity',\n        fns.selectedOpacityFn ? fns.selectedOpacityFn(d) :\n            (d.mo === undefined ? marker.opacity : d.mo)\n    );\n\n    if(fns.ms2mrc) {\n        var r;\n\n        // handle multi-trace graph edit case\n        if(d.ms === 'various' || marker.size === 'various') {\n            r = 3;\n        } else {\n            r = fns.ms2mrc(d.ms);\n        }\n\n        // store the calculated size so hover can use it\n        d.mrc = r;\n\n        if(fns.selectedSizeFn) {\n            r = d.mrc = fns.selectedSizeFn(d);\n        }\n\n        // turn the symbol into a sanitized number\n        var x = drawing.symbolNumber(d.mx || marker.symbol) || 0;\n\n        // save if this marker is open\n        // because that impacts how to handle colors\n        d.om = x % 200 >= 100;\n\n        sel.attr('d', makePointPath(x, r));\n    }\n\n    var perPointGradient = false;\n    var fillColor, lineColor, lineWidth;\n\n    // 'so' is suspected outliers, for box plots\n    if(d.so) {\n        lineWidth = markerLine.outlierwidth;\n        lineColor = markerLine.outliercolor;\n        fillColor = marker.outliercolor;\n    } else {\n        var markerLineWidth = (markerLine || {}).width;\n\n        lineWidth = (\n            d.mlw + 1 ||\n            markerLineWidth + 1 ||\n            // TODO: we need the latter for legends... can we get rid of it?\n            (d.trace ? (d.trace.marker.line || {}).width : 0) + 1\n        ) - 1 || 0;\n\n        if('mlc' in d) lineColor = d.mlcc = fns.lineScale(d.mlc);\n        // weird case: array wasn't long enough to apply to every point\n        else if(Lib.isArrayOrTypedArray(markerLine.color)) lineColor = Color.defaultLine;\n        else lineColor = markerLine.color;\n\n        if(Lib.isArrayOrTypedArray(marker.color)) {\n            fillColor = Color.defaultLine;\n            perPointGradient = true;\n        }\n\n        if('mc' in d) {\n            fillColor = d.mcc = fns.markerScale(d.mc);\n        } else {\n            fillColor = marker.color || 'rgba(0,0,0,0)';\n        }\n\n        if(fns.selectedColorFn) {\n            fillColor = fns.selectedColorFn(d);\n        }\n    }\n\n    if(d.om) {\n        // open markers can't have zero linewidth, default to 1px,\n        // and use fill color as stroke color\n        sel.call(Color.stroke, fillColor)\n            .style({\n                'stroke-width': (lineWidth || 1) + 'px',\n                fill: 'none'\n            });\n    } else {\n        sel.style('stroke-width', lineWidth + 'px');\n\n        var markerGradient = marker.gradient;\n\n        var gradientType = d.mgt;\n        if(gradientType) perPointGradient = true;\n        else gradientType = markerGradient && markerGradient.type;\n\n        // for legend - arrays will propagate through here, but we don't need\n        // to treat it as per-point.\n        if(Array.isArray(gradientType)) {\n            gradientType = gradientType[0];\n            if(!gradientInfo[gradientType]) gradientType = 0;\n        }\n\n        if(gradientType && gradientType !== 'none') {\n            var gradientColor = d.mgc;\n            if(gradientColor) perPointGradient = true;\n            else gradientColor = markerGradient.color;\n\n            var gradientID = trace.uid;\n            if(perPointGradient) gradientID += '-' + d.i;\n\n            drawing.gradient(sel, gd, gradientID, gradientType,\n                [[0, gradientColor], [1, fillColor]], 'fill');\n        } else {\n            Color.fill(sel, fillColor);\n        }\n\n        if(lineWidth) {\n            Color.stroke(sel, lineColor);\n        }\n    }\n};\n\ndrawing.makePointStyleFns = function(trace) {\n    var out = {};\n    var marker = trace.marker;\n\n    // allow array marker and marker line colors to be\n    // scaled by given max and min to colorscales\n    out.markerScale = drawing.tryColorscale(marker, '');\n    out.lineScale = drawing.tryColorscale(marker, 'line');\n\n    if(Registry.traceIs(trace, 'symbols')) {\n        out.ms2mrc = subTypes.isBubble(trace) ?\n            makeBubbleSizeFn(trace) :\n            function() { return (marker.size || 6) / 2; };\n    }\n\n    if(trace.selectedpoints) {\n        Lib.extendFlat(out, drawing.makeSelectedPointStyleFns(trace));\n    }\n\n    return out;\n};\n\ndrawing.makeSelectedPointStyleFns = function(trace) {\n    var out = {};\n\n    var selectedAttrs = trace.selected || {};\n    var unselectedAttrs = trace.unselected || {};\n\n    var marker = trace.marker || {};\n    var selectedMarker = selectedAttrs.marker || {};\n    var unselectedMarker = unselectedAttrs.marker || {};\n\n    var mo = marker.opacity;\n    var smo = selectedMarker.opacity;\n    var usmo = unselectedMarker.opacity;\n    var smoIsDefined = smo !== undefined;\n    var usmoIsDefined = usmo !== undefined;\n\n    if(Lib.isArrayOrTypedArray(mo) || smoIsDefined || usmoIsDefined) {\n        out.selectedOpacityFn = function(d) {\n            var base = d.mo === undefined ? marker.opacity : d.mo;\n\n            if(d.selected) {\n                return smoIsDefined ? smo : base;\n            } else {\n                return usmoIsDefined ? usmo : DESELECTDIM * base;\n            }\n        };\n    }\n\n    var mc = marker.color;\n    var smc = selectedMarker.color;\n    var usmc = unselectedMarker.color;\n\n    if(smc || usmc) {\n        out.selectedColorFn = function(d) {\n            var base = d.mcc || mc;\n\n            if(d.selected) {\n                return smc || base;\n            } else {\n                return usmc || base;\n            }\n        };\n    }\n\n    var ms = marker.size;\n    var sms = selectedMarker.size;\n    var usms = unselectedMarker.size;\n    var smsIsDefined = sms !== undefined;\n    var usmsIsDefined = usms !== undefined;\n\n    if(Registry.traceIs(trace, 'symbols') && (smsIsDefined || usmsIsDefined)) {\n        out.selectedSizeFn = function(d) {\n            var base = d.mrc || ms / 2;\n\n            if(d.selected) {\n                return smsIsDefined ? sms / 2 : base;\n            } else {\n                return usmsIsDefined ? usms / 2 : base;\n            }\n        };\n    }\n\n    return out;\n};\n\ndrawing.makeSelectedTextStyleFns = function(trace) {\n    var out = {};\n\n    var selectedAttrs = trace.selected || {};\n    var unselectedAttrs = trace.unselected || {};\n\n    var textFont = trace.textfont || {};\n    var selectedTextFont = selectedAttrs.textfont || {};\n    var unselectedTextFont = unselectedAttrs.textfont || {};\n\n    var tc = textFont.color;\n    var stc = selectedTextFont.color;\n    var utc = unselectedTextFont.color;\n\n    out.selectedTextColorFn = function(d) {\n        var base = d.tc || tc;\n\n        if(d.selected) {\n            return stc || base;\n        } else {\n            if(utc) return utc;\n            else return stc ? base : Color.addOpacity(base, DESELECTDIM);\n        }\n    };\n\n    return out;\n};\n\ndrawing.selectedPointStyle = function(s, trace) {\n    if(!s.size() || !trace.selectedpoints) return;\n\n    var fns = drawing.makeSelectedPointStyleFns(trace);\n    var marker = trace.marker || {};\n    var seq = [];\n\n    if(fns.selectedOpacityFn) {\n        seq.push(function(pt, d) {\n            pt.style('opacity', fns.selectedOpacityFn(d));\n        });\n    }\n\n    if(fns.selectedColorFn) {\n        seq.push(function(pt, d) {\n            Color.fill(pt, fns.selectedColorFn(d));\n        });\n    }\n\n    if(fns.selectedSizeFn) {\n        seq.push(function(pt, d) {\n            var mx = d.mx || marker.symbol || 0;\n            var mrc2 = fns.selectedSizeFn(d);\n\n            pt.attr('d', makePointPath(drawing.symbolNumber(mx), mrc2));\n\n            // save for Drawing.selectedTextStyle\n            d.mrc2 = mrc2;\n        });\n    }\n\n    if(seq.length) {\n        s.each(function(d) {\n            var pt = d3.select(this);\n            for(var i = 0; i < seq.length; i++) {\n                seq[i](pt, d);\n            }\n        });\n    }\n};\n\ndrawing.tryColorscale = function(marker, prefix) {\n    var cont = prefix ? Lib.nestedProperty(marker, prefix).get() : marker;\n\n    if(cont) {\n        var scl = cont.colorscale;\n        var colorArray = cont.color;\n\n        if(scl && Lib.isArrayOrTypedArray(colorArray)) {\n            return Colorscale.makeColorScaleFunc(\n                Colorscale.extractScale(cont, {cLetter: 'c'})\n            );\n        }\n    }\n    return Lib.identity;\n};\n\nvar TEXTOFFSETSIGN = {\n    start: 1, end: -1, middle: 0, bottom: 1, top: -1\n};\n\nfunction textPointPosition(s, textPosition, fontSize, markerRadius) {\n    var group = d3.select(s.node().parentNode);\n\n    var v = textPosition.indexOf('top') !== -1 ?\n        'top' :\n        textPosition.indexOf('bottom') !== -1 ? 'bottom' : 'middle';\n    var h = textPosition.indexOf('left') !== -1 ?\n        'end' :\n        textPosition.indexOf('right') !== -1 ? 'start' : 'middle';\n\n    // if markers are shown, offset a little more than\n    // the nominal marker size\n    // ie 2/1.6 * nominal, bcs some markers are a bit bigger\n    var r = markerRadius ? markerRadius / 0.8 + 1 : 0;\n\n    var numLines = (svgTextUtils.lineCount(s) - 1) * LINE_SPACING + 1;\n    var dx = TEXTOFFSETSIGN[h] * r;\n    var dy = fontSize * 0.75 + TEXTOFFSETSIGN[v] * r +\n        (TEXTOFFSETSIGN[v] - 1) * numLines * fontSize / 2;\n\n    // fix the overall text group position\n    s.attr('text-anchor', h);\n    group.attr('transform', 'translate(' + dx + ',' + dy + ')');\n}\n\nfunction extracTextFontSize(d, trace) {\n    var fontSize = d.ts || trace.textfont.size;\n    return (isNumeric(fontSize) && fontSize > 0) ? fontSize : 0;\n}\n\n// draw text at points\ndrawing.textPointStyle = function(s, trace, gd) {\n    if(!s.size()) return;\n\n    var selectedTextColorFn;\n\n    if(trace.selectedpoints) {\n        var fns = drawing.makeSelectedTextStyleFns(trace);\n        selectedTextColorFn = fns.selectedTextColorFn;\n    }\n\n    s.each(function(d) {\n        var p = d3.select(this);\n        var text = Lib.extractOption(d, trace, 'tx', 'text');\n\n        if(!text && text !== 0) {\n            p.remove();\n            return;\n        }\n\n        var pos = d.tp || trace.textposition;\n        var fontSize = extracTextFontSize(d, trace);\n        var fontColor = selectedTextColorFn ?\n            selectedTextColorFn(d) :\n            (d.tc || trace.textfont.color);\n\n        p.call(drawing.font,\n                d.tf || trace.textfont.family,\n                fontSize,\n                fontColor)\n            .text(text)\n            .call(svgTextUtils.convertToTspans, gd)\n            .call(textPointPosition, pos, fontSize, d.mrc);\n    });\n};\n\ndrawing.selectedTextStyle = function(s, trace) {\n    if(!s.size() || !trace.selectedpoints) return;\n\n    var fns = drawing.makeSelectedTextStyleFns(trace);\n\n    s.each(function(d) {\n        var tx = d3.select(this);\n        var tc = fns.selectedTextColorFn(d);\n        var tp = d.tp || trace.textposition;\n        var fontSize = extracTextFontSize(d, trace);\n\n        Color.fill(tx, tc);\n        textPointPosition(tx, tp, fontSize, d.mrc2 || d.mrc);\n    });\n};\n\n// generalized Catmull-Rom splines, per\n// http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf\nvar CatmullRomExp = 0.5;\ndrawing.smoothopen = function(pts, smoothness) {\n    if(pts.length < 3) { return 'M' + pts.join('L');}\n    var path = 'M' + pts[0];\n    var tangents = [];\n    var i;\n    for(i = 1; i < pts.length - 1; i++) {\n        tangents.push(makeTangent(pts[i - 1], pts[i], pts[i + 1], smoothness));\n    }\n    path += 'Q' + tangents[0][0] + ' ' + pts[1];\n    for(i = 2; i < pts.length - 1; i++) {\n        path += 'C' + tangents[i - 2][1] + ' ' + tangents[i - 1][0] + ' ' + pts[i];\n    }\n    path += 'Q' + tangents[pts.length - 3][1] + ' ' + pts[pts.length - 1];\n    return path;\n};\n\ndrawing.smoothclosed = function(pts, smoothness) {\n    if(pts.length < 3) { return 'M' + pts.join('L') + 'Z'; }\n    var path = 'M' + pts[0];\n    var pLast = pts.length - 1;\n    var tangents = [makeTangent(pts[pLast], pts[0], pts[1], smoothness)];\n    var i;\n    for(i = 1; i < pLast; i++) {\n        tangents.push(makeTangent(pts[i - 1], pts[i], pts[i + 1], smoothness));\n    }\n    tangents.push(\n        makeTangent(pts[pLast - 1], pts[pLast], pts[0], smoothness)\n    );\n\n    for(i = 1; i <= pLast; i++) {\n        path += 'C' + tangents[i - 1][1] + ' ' + tangents[i][0] + ' ' + pts[i];\n    }\n    path += 'C' + tangents[pLast][1] + ' ' + tangents[0][0] + ' ' + pts[0] + 'Z';\n    return path;\n};\n\nfunction makeTangent(prevpt, thispt, nextpt, smoothness) {\n    var d1x = prevpt[0] - thispt[0];\n    var d1y = prevpt[1] - thispt[1];\n    var d2x = nextpt[0] - thispt[0];\n    var d2y = nextpt[1] - thispt[1];\n    var d1a = Math.pow(d1x * d1x + d1y * d1y, CatmullRomExp / 2);\n    var d2a = Math.pow(d2x * d2x + d2y * d2y, CatmullRomExp / 2);\n    var numx = (d2a * d2a * d1x - d1a * d1a * d2x) * smoothness;\n    var numy = (d2a * d2a * d1y - d1a * d1a * d2y) * smoothness;\n    var denom1 = 3 * d2a * (d1a + d2a);\n    var denom2 = 3 * d1a * (d1a + d2a);\n    return [\n        [\n            d3.round(thispt[0] + (denom1 && numx / denom1), 2),\n            d3.round(thispt[1] + (denom1 && numy / denom1), 2)\n        ], [\n            d3.round(thispt[0] - (denom2 && numx / denom2), 2),\n            d3.round(thispt[1] - (denom2 && numy / denom2), 2)\n        ]\n    ];\n}\n\n// step paths - returns a generator function for paths\n// with the given step shape\nvar STEPPATH = {\n    hv: function(p0, p1) {\n        return 'H' + d3.round(p1[0], 2) + 'V' + d3.round(p1[1], 2);\n    },\n    vh: function(p0, p1) {\n        return 'V' + d3.round(p1[1], 2) + 'H' + d3.round(p1[0], 2);\n    },\n    hvh: function(p0, p1) {\n        return 'H' + d3.round((p0[0] + p1[0]) / 2, 2) + 'V' +\n            d3.round(p1[1], 2) + 'H' + d3.round(p1[0], 2);\n    },\n    vhv: function(p0, p1) {\n        return 'V' + d3.round((p0[1] + p1[1]) / 2, 2) + 'H' +\n            d3.round(p1[0], 2) + 'V' + d3.round(p1[1], 2);\n    }\n};\nvar STEPLINEAR = function(p0, p1) {\n    return 'L' + d3.round(p1[0], 2) + ',' + d3.round(p1[1], 2);\n};\ndrawing.steps = function(shape) {\n    var onestep = STEPPATH[shape] || STEPLINEAR;\n    return function(pts) {\n        var path = 'M' + d3.round(pts[0][0], 2) + ',' + d3.round(pts[0][1], 2);\n        for(var i = 1; i < pts.length; i++) {\n            path += onestep(pts[i - 1], pts[i]);\n        }\n        return path;\n    };\n};\n\n// off-screen svg render testing element, shared by the whole page\n// uses the id 'js-plotly-tester' and stores it in drawing.tester\ndrawing.makeTester = function() {\n    var tester = Lib.ensureSingleById(d3.select('body'), 'svg', 'js-plotly-tester', function(s) {\n        s.attr(xmlnsNamespaces.svgAttrs)\n            .style({\n                position: 'absolute',\n                left: '-10000px',\n                top: '-10000px',\n                width: '9000px',\n                height: '9000px',\n                'z-index': '1'\n            });\n    });\n\n    // browsers differ on how they describe the bounding rect of\n    // the svg if its contents spill over... so make a 1x1px\n    // reference point we can measure off of.\n    var testref = Lib.ensureSingle(tester, 'path', 'js-reference-point', function(s) {\n        s.attr('d', 'M0,0H1V1H0Z')\n            .style({\n                'stroke-width': 0,\n                fill: 'black'\n            });\n    });\n\n    drawing.tester = tester;\n    drawing.testref = testref;\n};\n\n/*\n * use our offscreen tester to get a clientRect for an element,\n * in a reference frame where it isn't translated (or transformed) and\n * its anchor point is at (0,0)\n * always returns a copy of the bbox, so the caller can modify it safely\n *\n * @param {SVGElement} node: the element to measure. If possible this should be\n *   a <text> or MathJax <g> element that's already passed through\n *   `convertToTspans` because in that case we can cache the results, but it's\n *   possible to pass in any svg element.\n *\n * @param {boolean} inTester: is this element already in `drawing.tester`?\n *   If you are measuring a dummy element, rather than one you really intend\n *   to use on the plot, making it in `drawing.tester` in the first place\n *   allows us to test faster because it cuts out cloning and appending it.\n *\n * @param {string} hash: for internal use only, if we already know the cache key\n *   for this element beforehand.\n *\n * @return {object}: a plain object containing the width, height, left, right,\n *   top, and bottom of `node`\n */\ndrawing.savedBBoxes = {};\nvar savedBBoxesCount = 0;\nvar maxSavedBBoxes = 10000;\n\ndrawing.bBox = function(node, inTester, hash) {\n    /*\n     * Cache elements we've already measured so we don't have to\n     * remeasure the same thing many times\n     * We have a few bBox callers though who pass a node larger than\n     * a <text> or a MathJax <g>, such as an axis group containing many labels.\n     * These will not generate a hash (unless we figure out an appropriate\n     * hash key for them) and thus we will not hash them.\n     */\n    if(!hash) hash = nodeHash(node);\n    var out;\n    if(hash) {\n        out = drawing.savedBBoxes[hash];\n        if(out) return Lib.extendFlat({}, out);\n    }\n    else if(node.childNodes.length === 1) {\n        /*\n         * If we have only one child element, which is itself hashable, make\n         * a new hash from this element plus its x,y,transform\n         * These bounding boxes *include* x,y,transform - mostly for use by\n         * callers trying to avoid overlaps (ie titles)\n         */\n        var innerNode = node.childNodes[0];\n\n        hash = nodeHash(innerNode);\n        if(hash) {\n            var x = +innerNode.getAttribute('x') || 0;\n            var y = +innerNode.getAttribute('y') || 0;\n            var transform = innerNode.getAttribute('transform');\n\n            if(!transform) {\n                // in this case, just varying x and y, don't bother caching\n                // the final bBox because the alteration is quick.\n                var innerBB = drawing.bBox(innerNode, false, hash);\n                if(x) {\n                    innerBB.left += x;\n                    innerBB.right += x;\n                }\n                if(y) {\n                    innerBB.top += y;\n                    innerBB.bottom += y;\n                }\n                return innerBB;\n            }\n            /*\n             * else we have a transform - rather than make a complicated\n             * (and error-prone and probably slow) transform parser/calculator,\n             * just continue on calculating the boundingClientRect of the group\n             * and use the new composite hash to cache it.\n             * That said, `innerNode.transform.baseVal` is an array of\n             * `SVGTransform` objects, that *do* seem to have a nice matrix\n             * multiplication interface that we could use to avoid making\n             * another getBoundingClientRect call...\n             */\n            hash += '~' + x + '~' + y + '~' + transform;\n\n            out = drawing.savedBBoxes[hash];\n            if(out) return Lib.extendFlat({}, out);\n        }\n    }\n    var testNode, tester;\n    if(inTester) {\n        testNode = node;\n    }\n    else {\n        tester = drawing.tester.node();\n\n        // copy the node to test into the tester\n        testNode = node.cloneNode(true);\n        tester.appendChild(testNode);\n    }\n\n    // standardize its position (and newline tspans if any)\n    d3.select(testNode)\n        .attr('transform', null)\n        .call(svgTextUtils.positionText, 0, 0);\n\n    var testRect = testNode.getBoundingClientRect();\n    var refRect = drawing.testref\n        .node()\n        .getBoundingClientRect();\n\n    if(!inTester) tester.removeChild(testNode);\n\n    var bb = {\n        height: testRect.height,\n        width: testRect.width,\n        left: testRect.left - refRect.left,\n        top: testRect.top - refRect.top,\n        right: testRect.right - refRect.left,\n        bottom: testRect.bottom - refRect.top\n    };\n\n    // make sure we don't have too many saved boxes,\n    // or a long session could overload on memory\n    // by saving boxes for long-gone elements\n    if(savedBBoxesCount >= maxSavedBBoxes) {\n        drawing.savedBBoxes = {};\n        savedBBoxesCount = 0;\n    }\n\n    // cache this bbox\n    if(hash) drawing.savedBBoxes[hash] = bb;\n    savedBBoxesCount++;\n\n    return Lib.extendFlat({}, bb);\n};\n\n// capture everything about a node (at least in our usage) that\n// impacts its bounding box, given that bBox clears x, y, and transform\nfunction nodeHash(node) {\n    var inputText = node.getAttribute('data-unformatted');\n    if(inputText === null) return;\n    return inputText +\n        node.getAttribute('data-math') +\n        node.getAttribute('text-anchor') +\n        node.getAttribute('style');\n}\n\n/**\n * Set clipPath URL in a way that work for all situations.\n *\n * In details, graphs on pages with <base> HTML tags need to prepend\n * the clip path ids with the page's base url EXCEPT during toImage exports.\n *\n * @param {d3 selection} s : node to add clip-path attribute\n * @param {string} localId : local clip-path (w/o base url) id\n * @param {DOM element || object} gd\n * - context._baseUrl {string}\n * - context._exportedPlot {boolean}\n */\ndrawing.setClipUrl = function(s, localId, gd) {\n    if(!localId) {\n        s.attr('clip-path', null);\n        return;\n    }\n\n    var context = gd._context;\n    var baseUrl = context._exportedPlot ? '' : (context._baseUrl || '');\n\n    s.attr('clip-path', 'url(' + baseUrl + '#' + localId + ')');\n};\n\ndrawing.getTranslate = function(element) {\n    // Note the separator [^\\d] between x and y in this regex\n    // We generally use ',' but IE will convert it to ' '\n    var re = /.*\\btranslate\\((-?\\d*\\.?\\d*)[^-\\d]*(-?\\d*\\.?\\d*)[^\\d].*/;\n    var getter = element.attr ? 'attr' : 'getAttribute';\n    var transform = element[getter]('transform') || '';\n\n    var translate = transform.replace(re, function(match, p1, p2) {\n        return [p1, p2].join(' ');\n    })\n    .split(' ');\n\n    return {\n        x: +translate[0] || 0,\n        y: +translate[1] || 0\n    };\n};\n\ndrawing.setTranslate = function(element, x, y) {\n    var re = /(\\btranslate\\(.*?\\);?)/;\n    var getter = element.attr ? 'attr' : 'getAttribute';\n    var setter = element.attr ? 'attr' : 'setAttribute';\n    var transform = element[getter]('transform') || '';\n\n    x = x || 0;\n    y = y || 0;\n\n    transform = transform.replace(re, '').trim();\n    transform += ' translate(' + x + ', ' + y + ')';\n    transform = transform.trim();\n\n    element[setter]('transform', transform);\n\n    return transform;\n};\n\ndrawing.getScale = function(element) {\n    var re = /.*\\bscale\\((\\d*\\.?\\d*)[^\\d]*(\\d*\\.?\\d*)[^\\d].*/;\n    var getter = element.attr ? 'attr' : 'getAttribute';\n    var transform = element[getter]('transform') || '';\n\n    var translate = transform.replace(re, function(match, p1, p2) {\n        return [p1, p2].join(' ');\n    })\n    .split(' ');\n\n    return {\n        x: +translate[0] || 1,\n        y: +translate[1] || 1\n    };\n};\n\ndrawing.setScale = function(element, x, y) {\n    var re = /(\\bscale\\(.*?\\);?)/;\n    var getter = element.attr ? 'attr' : 'getAttribute';\n    var setter = element.attr ? 'attr' : 'setAttribute';\n    var transform = element[getter]('transform') || '';\n\n    x = x || 1;\n    y = y || 1;\n\n    transform = transform.replace(re, '').trim();\n    transform += ' scale(' + x + ', ' + y + ')';\n    transform = transform.trim();\n\n    element[setter]('transform', transform);\n\n    return transform;\n};\n\nvar SCALE_RE = /\\s*sc.*/;\n\ndrawing.setPointGroupScale = function(selection, xScale, yScale) {\n    xScale = xScale || 1;\n    yScale = yScale || 1;\n\n    if(!selection) return;\n\n    // The same scale transform for every point:\n    var scale = (xScale === 1 && yScale === 1) ?\n        '' :\n        ' scale(' + xScale + ',' + yScale + ')';\n\n    selection.each(function() {\n        var t = (this.getAttribute('transform') || '').replace(SCALE_RE, '');\n        t += scale;\n        t = t.trim();\n        this.setAttribute('transform', t);\n    });\n};\n\nvar TEXT_POINT_LAST_TRANSLATION_RE = /translate\\([^)]*\\)\\s*$/;\n\ndrawing.setTextPointsScale = function(selection, xScale, yScale) {\n    if(!selection) return;\n\n    selection.each(function() {\n        var transforms;\n        var el = d3.select(this);\n        var text = el.select('text');\n\n        if(!text.node()) return;\n\n        var x = parseFloat(text.attr('x') || 0);\n        var y = parseFloat(text.attr('y') || 0);\n\n        var existingTransform = (el.attr('transform') || '').match(TEXT_POINT_LAST_TRANSLATION_RE);\n\n        if(xScale === 1 && yScale === 1) {\n            transforms = [];\n        } else {\n            transforms = [\n                'translate(' + x + ',' + y + ')',\n                'scale(' + xScale + ',' + yScale + ')',\n                'translate(' + (-x) + ',' + (-y) + ')',\n            ];\n        }\n\n        if(existingTransform) {\n            transforms.push(existingTransform);\n        }\n\n        el.attr('transform', transforms.join(' '));\n    });\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}