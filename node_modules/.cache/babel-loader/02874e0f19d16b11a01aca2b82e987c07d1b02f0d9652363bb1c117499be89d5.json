{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar createSurface = require('gl-surface3d');\nvar ndarray = require('ndarray');\nvar homography = require('ndarray-homography');\nvar fill = require('ndarray-fill');\nvar isArrayOrTypedArray = require('../../lib').isArrayOrTypedArray;\nvar parseColorScale = require('../../lib/gl_format_color').parseColorScale;\nvar str2RgbaArray = require('../../lib/str2rgbarray');\nfunction SurfaceTrace(scene, surface, uid) {\n  this.scene = scene;\n  this.uid = uid;\n  this.surface = surface;\n  this.data = null;\n  this.showContour = [false, false, false];\n  this.minValues = [Infinity, Infinity, Infinity];\n  this.maxValues = [-Infinity, -Infinity, -Infinity];\n  this.dataScaleX = 1.0;\n  this.dataScaleY = 1.0;\n  this.refineData = true;\n}\nvar proto = SurfaceTrace.prototype;\nproto.getXat = function (a, b, calendar, axis) {\n  var v = !isArrayOrTypedArray(this.data.x) ? a : isArrayOrTypedArray(this.data.x[0]) ? this.data.x[b][a] : this.data.x[a];\n  return calendar === undefined ? v : axis.d2l(v, 0, calendar);\n};\nproto.getYat = function (a, b, calendar, axis) {\n  var v = !isArrayOrTypedArray(this.data.y) ? b : isArrayOrTypedArray(this.data.y[0]) ? this.data.y[b][a] : this.data.y[b];\n  return calendar === undefined ? v : axis.d2l(v, 0, calendar);\n};\nproto.getZat = function (a, b, calendar, axis) {\n  var v = this.data.z[b][a];\n  return calendar === undefined ? v : axis.d2l(v, 0, calendar);\n};\nproto.handlePick = function (selection) {\n  if (selection.object === this.surface) {\n    var xRatio = (selection.data.index[0] - 1) / this.dataScaleX - 1;\n    var yRatio = (selection.data.index[1] - 1) / this.dataScaleY - 1;\n    var j = Math.max(Math.min(Math.round(xRatio), this.data.z[0].length - 1), 0);\n    var k = Math.max(Math.min(Math.round(yRatio), this.data._ylength - 1), 0);\n    selection.index = [j, k];\n    selection.traceCoordinate = [this.getXat(j, k), this.getYat(j, k), this.getZat(j, k)];\n    selection.dataCoordinate = [this.getXat(j, k, this.data.xcalendar, this.scene.fullSceneLayout.xaxis), this.getYat(j, k, this.data.ycalendar, this.scene.fullSceneLayout.yaxis), this.getZat(j, k, this.data.zcalendar, this.scene.fullSceneLayout.zaxis)];\n    for (var i = 0; i < 3; i++) {\n      var v = selection.dataCoordinate[i];\n      if (v !== null && v !== undefined) {\n        selection.dataCoordinate[i] *= this.scene.dataScale[i];\n      }\n    }\n    var text = this.data.text;\n    if (Array.isArray(text) && text[k] && text[k][j] !== undefined) {\n      selection.textLabel = text[k][j];\n    } else if (text) {\n      selection.textLabel = text;\n    } else {\n      selection.textLabel = '';\n    }\n    selection.data.dataCoordinate = selection.dataCoordinate.slice();\n    this.surface.highlight(selection.data);\n\n    // Snap spikes to data coordinate\n    this.scene.glplot.spikes.position = selection.dataCoordinate;\n    return true;\n  }\n};\nfunction isColormapCircular(colormap) {\n  var first = colormap[0].rgb;\n  var last = colormap[colormap.length - 1].rgb;\n  return first[0] === last[0] && first[1] === last[1] && first[2] === last[2] && first[3] === last[3];\n}\nvar shortPrimes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 541, 547, 557, 563, 569, 571, 577, 587, 593, 599, 601, 607, 613, 617, 619, 631, 641, 643, 647, 653, 659, 661, 673, 677, 683, 691, 701, 709, 719, 727, 733, 739, 743, 751, 757, 761, 769, 773, 787, 797, 809, 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 877, 881, 883, 887, 907, 911, 919, 929, 937, 941, 947, 953, 967, 971, 977, 983, 991, 997, 1009, 1013, 1019, 1021, 1031, 1033, 1039, 1049, 1051, 1061, 1063, 1069, 1087, 1091, 1093, 1097, 1103, 1109, 1117, 1123, 1129, 1151, 1153, 1163, 1171, 1181, 1187, 1193, 1201, 1213, 1217, 1223, 1229, 1231, 1237, 1249, 1259, 1277, 1279, 1283, 1289, 1291, 1297, 1301, 1303, 1307, 1319, 1321, 1327, 1361, 1367, 1373, 1381, 1399, 1409, 1423, 1427, 1429, 1433, 1439, 1447, 1451, 1453, 1459, 1471, 1481, 1483, 1487, 1489, 1493, 1499, 1511, 1523, 1531, 1543, 1549, 1553, 1559, 1567, 1571, 1579, 1583, 1597, 1601, 1607, 1609, 1613, 1619, 1621, 1627, 1637, 1657, 1663, 1667, 1669, 1693, 1697, 1699, 1709, 1721, 1723, 1733, 1741, 1747, 1753, 1759, 1777, 1783, 1787, 1789, 1801, 1811, 1823, 1831, 1847, 1861, 1867, 1871, 1873, 1877, 1879, 1889, 1901, 1907, 1913, 1931, 1933, 1949, 1951, 1973, 1979, 1987, 1993, 1997, 1999, 2003, 2011, 2017, 2027, 2029, 2039, 2053, 2063, 2069, 2081, 2083, 2087, 2089, 2099, 2111, 2113, 2129, 2131, 2137, 2141, 2143, 2153, 2161, 2179, 2203, 2207, 2213, 2221, 2237, 2239, 2243, 2251, 2267, 2269, 2273, 2281, 2287, 2293, 2297, 2309, 2311, 2333, 2339, 2341, 2347, 2351, 2357, 2371, 2377, 2381, 2383, 2389, 2393, 2399, 2411, 2417, 2423, 2437, 2441, 2447, 2459, 2467, 2473, 2477, 2503, 2521, 2531, 2539, 2543, 2549, 2551, 2557, 2579, 2591, 2593, 2609, 2617, 2621, 2633, 2647, 2657, 2659, 2663, 2671, 2677, 2683, 2687, 2689, 2693, 2699, 2707, 2711, 2713, 2719, 2729, 2731, 2741, 2749, 2753, 2767, 2777, 2789, 2791, 2797, 2801, 2803, 2819, 2833, 2837, 2843, 2851, 2857, 2861, 2879, 2887, 2897, 2903, 2909, 2917, 2927, 2939, 2953, 2957, 2963, 2969, 2971, 2999];\nfunction getPow(a, b) {\n  if (a < b) return 0;\n  var n = 0;\n  while (Math.floor(a % b) === 0) {\n    a /= b;\n    n++;\n  }\n  return n;\n}\nfunction getFactors(a) {\n  var powers = [];\n  for (var i = 0; i < shortPrimes.length; i++) {\n    var b = shortPrimes[i];\n    powers.push(getPow(a, b));\n  }\n  return powers;\n}\nfunction smallestDivisor(a) {\n  var A = getFactors(a);\n  var result = a;\n  for (var i = 0; i < shortPrimes.length; i++) {\n    if (A[i] > 0) {\n      result = shortPrimes[i];\n      break;\n    }\n  }\n  return result;\n}\nfunction leastCommonMultiple(a, b) {\n  if (a < 1 || b < 1) return undefined;\n  var A = getFactors(a);\n  var B = getFactors(b);\n  var n = 1;\n  for (var i = 0; i < shortPrimes.length; i++) {\n    n *= Math.pow(shortPrimes[i], Math.max(A[i], B[i]));\n  }\n  return n;\n}\nfunction arrayLCM(A) {\n  if (A.length === 0) return undefined;\n  var n = 1;\n  for (var i = 0; i < A.length; i++) {\n    n = leastCommonMultiple(n, A[i]);\n  }\n  return n;\n}\nproto.calcXnums = function (xlen) {\n  var i;\n  var nums = [];\n  for (i = 1; i < xlen; i++) {\n    var a = this.getXat(i - 1, 0);\n    var b = this.getXat(i, 0);\n    if (b !== a && a !== undefined && a !== null && b !== undefined && b !== null) {\n      nums[i - 1] = Math.abs(b - a);\n    } else {\n      nums[i - 1] = 0;\n    }\n  }\n  var totalDist = 0;\n  for (i = 1; i < xlen; i++) {\n    totalDist += nums[i - 1];\n  }\n  for (i = 1; i < xlen; i++) {\n    if (nums[i - 1] === 0) {\n      nums[i - 1] = 1;\n    } else {\n      nums[i - 1] = Math.round(totalDist / nums[i - 1]);\n    }\n  }\n  return nums;\n};\nproto.calcYnums = function (ylen) {\n  var i;\n  var nums = [];\n  for (i = 1; i < ylen; i++) {\n    var a = this.getYat(0, i - 1);\n    var b = this.getYat(0, i);\n    if (b !== a && a !== undefined && a !== null && b !== undefined && b !== null) {\n      nums[i - 1] = Math.abs(b - a);\n    } else {\n      nums[i - 1] = 0;\n    }\n  }\n  var totalDist = 0;\n  for (i = 1; i < ylen; i++) {\n    totalDist += nums[i - 1];\n  }\n  for (i = 1; i < ylen; i++) {\n    if (nums[i - 1] === 0) {\n      nums[i - 1] = 1;\n    } else {\n      nums[i - 1] = Math.round(totalDist / nums[i - 1]);\n    }\n  }\n  return nums;\n};\nvar highlyComposites = [1, 2, 4, 6, 12, 24, 36, 48, 60, 120, 180, 240, 360, 720, 840, 1260];\nvar MIN_RESOLUTION = highlyComposites[9];\nvar MAX_RESOLUTION = highlyComposites[13];\nproto.estimateScale = function (resSrc, axis) {\n  var nums = axis === 0 ? this.calcXnums(resSrc) : this.calcYnums(resSrc);\n  var resDst = 1 + arrayLCM(nums);\n  while (resDst < MIN_RESOLUTION) {\n    resDst *= 2;\n  }\n  while (resDst > MAX_RESOLUTION) {\n    resDst--;\n    resDst /= smallestDivisor(resDst);\n    resDst++;\n    if (resDst < MIN_RESOLUTION) {\n      // resDst = MIN_RESOLUTION; // option 1: use min resolution\n      resDst = MAX_RESOLUTION; // option 2: use max resolution\n    }\n  }\n\n  var scale = Math.round(resDst / resSrc);\n  return scale > 1 ? scale : 1;\n};\nproto.refineCoords = function (coords) {\n  var scaleW = this.dataScaleX;\n  var scaleH = this.dataScaleY;\n  var width = coords[0].shape[0];\n  var height = coords[0].shape[1];\n  var newWidth = Math.floor(coords[0].shape[0] * scaleW + 1) | 0;\n  var newHeight = Math.floor(coords[0].shape[1] * scaleH + 1) | 0;\n\n  // Pad coords by +1\n  var padWidth = 1 + width + 1;\n  var padHeight = 1 + height + 1;\n  var padImg = ndarray(new Float32Array(padWidth * padHeight), [padWidth, padHeight]);\n  for (var i = 0; i < coords.length; ++i) {\n    this.surface.padField(padImg, coords[i]);\n    var scaledImg = ndarray(new Float32Array(newWidth * newHeight), [newWidth, newHeight]);\n    homography(scaledImg, padImg, [scaleW, 0, 0, 0, scaleH, 0, 0, 0, 1]);\n    coords[i] = scaledImg;\n  }\n};\nproto.setContourLevels = function () {\n  var nlevels = [[], [], []];\n  var needsUpdate = false;\n  for (var i = 0; i < 3; ++i) {\n    if (this.showContour[i]) {\n      needsUpdate = true;\n      nlevels[i] = this.scene.contourLevels[i];\n    }\n  }\n  if (needsUpdate) {\n    this.surface.update({\n      levels: nlevels\n    });\n  }\n};\nproto.update = function (data) {\n  var scene = this.scene;\n  var sceneLayout = scene.fullSceneLayout;\n  var surface = this.surface;\n  var alpha = data.opacity;\n  var colormap = parseColorScale(data, alpha);\n  var scaleFactor = scene.dataScale;\n  var xlen = data.z[0].length;\n  var ylen = data._ylength;\n  var contourLevels = scene.contourLevels;\n\n  // Save data\n  this.data = data;\n\n  /*\n   * Fill and transpose zdata.\n   * Consistent with 'heatmap' and 'contour', plotly 'surface'\n   * 'z' are such that sub-arrays correspond to y-coords\n   * and that the sub-array entries correspond to a x-coords,\n   * which is the transpose of 'gl-surface-plot'.\n   */\n\n  var i, j, k, v;\n  var rawCoords = [];\n  for (i = 0; i < 3; i++) {\n    rawCoords[i] = [];\n    for (j = 0; j < xlen; j++) {\n      rawCoords[i][j] = [];\n      /*\n      for(k = 0; k < ylen; k++) {\n          rawCoords[i][j][k] = undefined;\n      }\n      */\n    }\n  }\n\n  // coords x, y & z\n  for (j = 0; j < xlen; j++) {\n    for (k = 0; k < ylen; k++) {\n      rawCoords[0][j][k] = this.getXat(j, k, data.xcalendar, sceneLayout.xaxis);\n      rawCoords[1][j][k] = this.getYat(j, k, data.ycalendar, sceneLayout.yaxis);\n      rawCoords[2][j][k] = this.getZat(j, k, data.zcalendar, sceneLayout.zaxis);\n    }\n  }\n\n  // Note: log axes are not defined in surfaces yet.\n  // but they could be defined here...\n\n  for (i = 0; i < 3; i++) {\n    for (j = 0; j < xlen; j++) {\n      for (k = 0; k < ylen; k++) {\n        v = rawCoords[i][j][k];\n        if (v === null || v === undefined) {\n          rawCoords[i][j][k] = NaN;\n        } else {\n          v = rawCoords[i][j][k] *= scaleFactor[i];\n        }\n      }\n    }\n  }\n  for (i = 0; i < 3; i++) {\n    for (j = 0; j < xlen; j++) {\n      for (k = 0; k < ylen; k++) {\n        v = rawCoords[i][j][k];\n        if (v !== null && v !== undefined) {\n          if (this.minValues[i] > v) {\n            this.minValues[i] = v;\n          }\n          if (this.maxValues[i] < v) {\n            this.maxValues[i] = v;\n          }\n        }\n      }\n    }\n  }\n  for (i = 0; i < 3; i++) {\n    data._objectOffset[i] = 0.5 * (this.minValues[i] + this.maxValues[i]);\n  }\n  for (i = 0; i < 3; i++) {\n    for (j = 0; j < xlen; j++) {\n      for (k = 0; k < ylen; k++) {\n        v = rawCoords[i][j][k];\n        if (v !== null && v !== undefined) {\n          rawCoords[i][j][k] -= data._objectOffset[i];\n        }\n      }\n    }\n  }\n\n  // convert processed raw data to Float32 matrices\n  var coords = [ndarray(new Float32Array(xlen * ylen), [xlen, ylen]), ndarray(new Float32Array(xlen * ylen), [xlen, ylen]), ndarray(new Float32Array(xlen * ylen), [xlen, ylen])];\n  fill(coords[0], function (row, col) {\n    return rawCoords[0][row][col];\n  });\n  fill(coords[1], function (row, col) {\n    return rawCoords[1][row][col];\n  });\n  fill(coords[2], function (row, col) {\n    return rawCoords[2][row][col];\n  });\n  rawCoords = []; // free memory\n\n  var params = {\n    colormap: colormap,\n    levels: [[], [], []],\n    showContour: [true, true, true],\n    showSurface: !data.hidesurface,\n    contourProject: [[false, false, false], [false, false, false], [false, false, false]],\n    contourWidth: [1, 1, 1],\n    contourColor: [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]],\n    contourTint: [1, 1, 1],\n    dynamicColor: [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]],\n    dynamicWidth: [1, 1, 1],\n    dynamicTint: [1, 1, 1],\n    opacity: data.opacity\n  };\n  params.intensityBounds = [data.cmin, data.cmax];\n\n  // Refine surface color if necessary\n  if (data.surfacecolor) {\n    var intensity = ndarray(new Float32Array(xlen * ylen), [xlen, ylen]);\n    fill(intensity, function (row, col) {\n      return data.surfacecolor[col][row];\n    });\n    coords.push(intensity);\n  } else {\n    // when 'z' is used as 'intensity',\n    // we must scale its value\n    params.intensityBounds[0] *= scaleFactor[2];\n    params.intensityBounds[1] *= scaleFactor[2];\n  }\n  if (MAX_RESOLUTION < coords[0].shape[0] || MAX_RESOLUTION < coords[0].shape[1]) {\n    this.refineData = false;\n  }\n  if (this.refineData === true) {\n    this.dataScaleX = this.estimateScale(coords[0].shape[0], 0);\n    this.dataScaleY = this.estimateScale(coords[0].shape[1], 1);\n    if (this.dataScaleX !== 1 || this.dataScaleY !== 1) {\n      this.refineCoords(coords);\n    }\n  }\n  if (data.surfacecolor) {\n    params.intensity = coords.pop();\n  }\n  var highlightEnable = [true, true, true];\n  var axis = ['x', 'y', 'z'];\n  for (i = 0; i < 3; ++i) {\n    var contourParams = data.contours[axis[i]];\n    highlightEnable[i] = contourParams.highlight;\n    params.showContour[i] = contourParams.show || contourParams.highlight;\n    if (!params.showContour[i]) continue;\n    params.contourProject[i] = [contourParams.project.x, contourParams.project.y, contourParams.project.z];\n    if (contourParams.show) {\n      this.showContour[i] = true;\n      params.levels[i] = contourLevels[i];\n      surface.highlightColor[i] = params.contourColor[i] = str2RgbaArray(contourParams.color);\n      if (contourParams.usecolormap) {\n        surface.highlightTint[i] = params.contourTint[i] = 0;\n      } else {\n        surface.highlightTint[i] = params.contourTint[i] = 1;\n      }\n      params.contourWidth[i] = contourParams.width;\n    } else {\n      this.showContour[i] = false;\n    }\n    if (contourParams.highlight) {\n      params.dynamicColor[i] = str2RgbaArray(contourParams.highlightcolor);\n      params.dynamicWidth[i] = contourParams.highlightwidth;\n    }\n  }\n\n  // see https://github.com/plotly/plotly.js/issues/940\n  if (isColormapCircular(colormap)) {\n    params.vertexColor = true;\n  }\n  params.objectOffset = [data._objectOffset[0], data._objectOffset[1], data._objectOffset[2]];\n  params.coords = coords;\n  surface.update(params);\n  surface.visible = data.visible;\n  surface.enableDynamic = highlightEnable;\n  surface.enableHighlight = highlightEnable;\n  surface.snapToData = true;\n  if ('lighting' in data) {\n    surface.ambientLight = data.lighting.ambient;\n    surface.diffuseLight = data.lighting.diffuse;\n    surface.specularLight = data.lighting.specular;\n    surface.roughness = data.lighting.roughness;\n    surface.fresnel = data.lighting.fresnel;\n  }\n  if ('lightposition' in data) {\n    surface.lightPosition = [data.lightposition.x, data.lightposition.y, data.lightposition.z];\n  }\n  if (alpha && alpha < 1) {\n    surface.supportsTransparency = true;\n  }\n};\nproto.dispose = function () {\n  this.scene.glplot.remove(this.surface);\n  this.surface.dispose();\n};\nfunction createSurfaceTrace(scene, data) {\n  var gl = scene.glplot.gl;\n  var surface = createSurface({\n    gl: gl\n  });\n  var result = new SurfaceTrace(scene, surface, data.uid);\n  surface._trace = result;\n  result.update(data);\n  scene.glplot.add(surface);\n  return result;\n}\nmodule.exports = createSurfaceTrace;","map":{"version":3,"names":["createSurface","require","ndarray","homography","fill","isArrayOrTypedArray","parseColorScale","str2RgbaArray","SurfaceTrace","scene","surface","uid","data","showContour","minValues","Infinity","maxValues","dataScaleX","dataScaleY","refineData","proto","prototype","getXat","a","b","calendar","axis","v","x","undefined","d2l","getYat","y","getZat","z","handlePick","selection","object","xRatio","index","yRatio","j","Math","max","min","round","length","k","_ylength","traceCoordinate","dataCoordinate","xcalendar","fullSceneLayout","xaxis","ycalendar","yaxis","zcalendar","zaxis","i","dataScale","text","Array","isArray","textLabel","slice","highlight","glplot","spikes","position","isColormapCircular","colormap","first","rgb","last","shortPrimes","getPow","n","floor","getFactors","powers","push","smallestDivisor","A","result","leastCommonMultiple","B","pow","arrayLCM","calcXnums","xlen","nums","abs","totalDist","calcYnums","ylen","highlyComposites","MIN_RESOLUTION","MAX_RESOLUTION","estimateScale","resSrc","resDst","scale","refineCoords","coords","scaleW","scaleH","width","shape","height","newWidth","newHeight","padWidth","padHeight","padImg","Float32Array","padField","scaledImg","setContourLevels","nlevels","needsUpdate","contourLevels","update","levels","sceneLayout","alpha","opacity","scaleFactor","rawCoords","NaN","_objectOffset","row","col","params","showSurface","hidesurface","contourProject","contourWidth","contourColor","contourTint","dynamicColor","dynamicWidth","dynamicTint","intensityBounds","cmin","cmax","surfacecolor","intensity","pop","highlightEnable","contourParams","contours","show","project","highlightColor","color","usecolormap","highlightTint","highlightcolor","highlightwidth","vertexColor","objectOffset","visible","enableDynamic","enableHighlight","snapToData","ambientLight","lighting","ambient","diffuseLight","diffuse","specularLight","specular","roughness","fresnel","lightPosition","lightposition","supportsTransparency","dispose","remove","createSurfaceTrace","gl","_trace","add","module","exports"],"sources":["/home/yasmin/Área de Trabalho/Frontend/node_modules/plotly.js/src/traces/surface/convert.js"],"sourcesContent":["/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n\n'use strict';\n\nvar createSurface = require('gl-surface3d');\n\nvar ndarray = require('ndarray');\nvar homography = require('ndarray-homography');\nvar fill = require('ndarray-fill');\n\nvar isArrayOrTypedArray = require('../../lib').isArrayOrTypedArray;\nvar parseColorScale = require('../../lib/gl_format_color').parseColorScale;\nvar str2RgbaArray = require('../../lib/str2rgbarray');\n\nfunction SurfaceTrace(scene, surface, uid) {\n    this.scene = scene;\n    this.uid = uid;\n    this.surface = surface;\n    this.data = null;\n    this.showContour = [false, false, false];\n    this.minValues = [Infinity, Infinity, Infinity];\n    this.maxValues = [-Infinity, -Infinity, -Infinity];\n    this.dataScaleX = 1.0;\n    this.dataScaleY = 1.0;\n    this.refineData = true;\n}\n\nvar proto = SurfaceTrace.prototype;\n\nproto.getXat = function(a, b, calendar, axis) {\n    var v = (\n       (!isArrayOrTypedArray(this.data.x)) ?\n            a :\n       (isArrayOrTypedArray(this.data.x[0])) ?\n            this.data.x[b][a] :\n            this.data.x[a]\n    );\n\n    return (calendar === undefined) ? v : axis.d2l(v, 0, calendar);\n};\n\nproto.getYat = function(a, b, calendar, axis) {\n    var v = (\n       (!isArrayOrTypedArray(this.data.y)) ?\n            b :\n       (isArrayOrTypedArray(this.data.y[0])) ?\n            this.data.y[b][a] :\n            this.data.y[b]\n    );\n\n    return (calendar === undefined) ? v : axis.d2l(v, 0, calendar);\n};\n\nproto.getZat = function(a, b, calendar, axis) {\n    var v = (\n        this.data.z[b][a]\n    );\n\n    return (calendar === undefined) ? v : axis.d2l(v, 0, calendar);\n};\n\nproto.handlePick = function(selection) {\n    if(selection.object === this.surface) {\n\n        var xRatio = (selection.data.index[0] - 1) / this.dataScaleX - 1;\n        var yRatio = (selection.data.index[1] - 1) / this.dataScaleY - 1;\n\n        var j = Math.max(Math.min(Math.round(xRatio), this.data.z[0].length - 1), 0);\n        var k = Math.max(Math.min(Math.round(yRatio), this.data._ylength - 1), 0);\n\n        selection.index = [j, k];\n\n        selection.traceCoordinate = [\n            this.getXat(j, k),\n            this.getYat(j, k),\n            this.getZat(j, k)\n        ];\n\n        selection.dataCoordinate = [\n            this.getXat(j, k, this.data.xcalendar, this.scene.fullSceneLayout.xaxis),\n            this.getYat(j, k, this.data.ycalendar, this.scene.fullSceneLayout.yaxis),\n            this.getZat(j, k, this.data.zcalendar, this.scene.fullSceneLayout.zaxis)\n        ];\n\n        for(var i = 0; i < 3; i++) {\n            var v = selection.dataCoordinate[i];\n            if(v !== null && v !== undefined) {\n                selection.dataCoordinate[i] *= this.scene.dataScale[i];\n            }\n        }\n\n        var text = this.data.text;\n        if(Array.isArray(text) && text[k] && text[k][j] !== undefined) {\n            selection.textLabel = text[k][j];\n        } else if(text) {\n            selection.textLabel = text;\n        } else {\n            selection.textLabel = '';\n        }\n\n        selection.data.dataCoordinate = selection.dataCoordinate.slice();\n\n        this.surface.highlight(selection.data);\n\n        // Snap spikes to data coordinate\n        this.scene.glplot.spikes.position = selection.dataCoordinate;\n\n        return true;\n    }\n};\n\nfunction isColormapCircular(colormap) {\n    var first = colormap[0].rgb;\n    var last = colormap[colormap.length - 1].rgb;\n\n    return (\n        first[0] === last[0] &&\n        first[1] === last[1] &&\n        first[2] === last[2] &&\n        first[3] === last[3]\n    );\n}\n\nvar shortPrimes = [\n    2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97,\n    101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199,\n    211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293,\n    307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397,\n    401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499,\n    503, 509, 521, 523, 541, 547, 557, 563, 569, 571, 577, 587, 593, 599,\n    601, 607, 613, 617, 619, 631, 641, 643, 647, 653, 659, 661, 673, 677, 683, 691,\n    701, 709, 719, 727, 733, 739, 743, 751, 757, 761, 769, 773, 787, 797,\n    809, 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 877, 881, 883, 887,\n    907, 911, 919, 929, 937, 941, 947, 953, 967, 971, 977, 983, 991, 997,\n    1009, 1013, 1019, 1021, 1031, 1033, 1039, 1049, 1051, 1061, 1063, 1069, 1087, 1091, 1093, 1097,\n    1103, 1109, 1117, 1123, 1129, 1151, 1153, 1163, 1171, 1181, 1187, 1193,\n    1201, 1213, 1217, 1223, 1229, 1231, 1237, 1249, 1259, 1277, 1279, 1283, 1289, 1291, 1297,\n    1301, 1303, 1307, 1319, 1321, 1327, 1361, 1367, 1373, 1381, 1399,\n    1409, 1423, 1427, 1429, 1433, 1439, 1447, 1451, 1453, 1459, 1471, 1481, 1483, 1487, 1489, 1493, 1499,\n    1511, 1523, 1531, 1543, 1549, 1553, 1559, 1567, 1571, 1579, 1583, 1597,\n    1601, 1607, 1609, 1613, 1619, 1621, 1627, 1637, 1657, 1663, 1667, 1669, 1693, 1697, 1699,\n    1709, 1721, 1723, 1733, 1741, 1747, 1753, 1759, 1777, 1783, 1787, 1789,\n    1801, 1811, 1823, 1831, 1847, 1861, 1867, 1871, 1873, 1877, 1879, 1889,\n    1901, 1907, 1913, 1931, 1933, 1949, 1951, 1973, 1979, 1987, 1993, 1997, 1999,\n    2003, 2011, 2017, 2027, 2029, 2039, 2053, 2063, 2069, 2081, 2083, 2087, 2089, 2099,\n    2111, 2113, 2129, 2131, 2137, 2141, 2143, 2153, 2161, 2179,\n    2203, 2207, 2213, 2221, 2237, 2239, 2243, 2251, 2267, 2269, 2273, 2281, 2287, 2293, 2297,\n    2309, 2311, 2333, 2339, 2341, 2347, 2351, 2357, 2371, 2377, 2381, 2383, 2389, 2393, 2399,\n    2411, 2417, 2423, 2437, 2441, 2447, 2459, 2467, 2473, 2477,\n    2503, 2521, 2531, 2539, 2543, 2549, 2551, 2557, 2579, 2591, 2593,\n    2609, 2617, 2621, 2633, 2647, 2657, 2659, 2663, 2671, 2677, 2683, 2687, 2689, 2693, 2699,\n    2707, 2711, 2713, 2719, 2729, 2731, 2741, 2749, 2753, 2767, 2777, 2789, 2791, 2797,\n    2801, 2803, 2819, 2833, 2837, 2843, 2851, 2857, 2861, 2879, 2887, 2897,\n    2903, 2909, 2917, 2927, 2939, 2953, 2957, 2963, 2969, 2971, 2999\n];\n\nfunction getPow(a, b) {\n    if(a < b) return 0;\n    var n = 0;\n    while(Math.floor(a % b) === 0) {\n        a /= b;\n        n++;\n    }\n    return n;\n}\n\nfunction getFactors(a) {\n    var powers = [];\n    for(var i = 0; i < shortPrimes.length; i++) {\n        var b = shortPrimes[i];\n        powers.push(\n            getPow(a, b)\n        );\n    }\n    return powers;\n}\n\nfunction smallestDivisor(a) {\n    var A = getFactors(a);\n    var result = a;\n    for(var i = 0; i < shortPrimes.length; i++) {\n        if(A[i] > 0) {\n            result = shortPrimes[i];\n            break;\n        }\n    }\n    return result;\n}\n\nfunction leastCommonMultiple(a, b) {\n    if(a < 1 || b < 1) return undefined;\n    var A = getFactors(a);\n    var B = getFactors(b);\n    var n = 1;\n    for(var i = 0; i < shortPrimes.length; i++) {\n        n *= Math.pow(\n            shortPrimes[i], Math.max(A[i], B[i])\n        );\n    }\n    return n;\n}\n\nfunction arrayLCM(A) {\n    if(A.length === 0) return undefined;\n    var n = 1;\n    for(var i = 0; i < A.length; i++) {\n        n = leastCommonMultiple(n, A[i]);\n    }\n    return n;\n}\n\nproto.calcXnums = function(xlen) {\n    var i;\n    var nums = [];\n    for(i = 1; i < xlen; i++) {\n        var a = this.getXat(i - 1, 0);\n        var b = this.getXat(i, 0);\n\n        if(b !== a &&\n            a !== undefined && a !== null &&\n            b !== undefined && b !== null) {\n            nums[i - 1] = Math.abs(b - a);\n        } else {\n            nums[i - 1] = 0;\n        }\n    }\n\n    var totalDist = 0;\n    for(i = 1; i < xlen; i++) {\n        totalDist += nums[i - 1];\n    }\n\n    for(i = 1; i < xlen; i++) {\n        if(nums[i - 1] === 0) {\n            nums[i - 1] = 1;\n        } else {\n            nums[i - 1] = Math.round(totalDist / nums[i - 1]);\n        }\n    }\n\n    return nums;\n};\n\nproto.calcYnums = function(ylen) {\n    var i;\n    var nums = [];\n    for(i = 1; i < ylen; i++) {\n        var a = this.getYat(0, i - 1);\n        var b = this.getYat(0, i);\n\n        if(b !== a &&\n            a !== undefined && a !== null &&\n            b !== undefined && b !== null) {\n            nums[i - 1] = Math.abs(b - a);\n        } else {\n            nums[i - 1] = 0;\n        }\n    }\n\n    var totalDist = 0;\n    for(i = 1; i < ylen; i++) {\n        totalDist += nums[i - 1];\n    }\n\n    for(i = 1; i < ylen; i++) {\n        if(nums[i - 1] === 0) {\n            nums[i - 1] = 1;\n        } else {\n            nums[i - 1] = Math.round(totalDist / nums[i - 1]);\n        }\n    }\n\n    return nums;\n};\n\nvar highlyComposites = [1, 2, 4, 6, 12, 24, 36, 48, 60, 120, 180, 240, 360, 720, 840, 1260];\n\nvar MIN_RESOLUTION = highlyComposites[9];\nvar MAX_RESOLUTION = highlyComposites[13];\n\nproto.estimateScale = function(resSrc, axis) {\n    var nums = (axis === 0) ?\n        this.calcXnums(resSrc) :\n        this.calcYnums(resSrc);\n\n    var resDst = 1 + arrayLCM(nums);\n\n    while(resDst < MIN_RESOLUTION) {\n        resDst *= 2;\n    }\n\n    while(resDst > MAX_RESOLUTION) {\n        resDst--;\n        resDst /= smallestDivisor(resDst);\n        resDst++;\n\n        if(resDst < MIN_RESOLUTION) {\n         // resDst = MIN_RESOLUTION; // option 1: use min resolution\n            resDst = MAX_RESOLUTION; // option 2: use max resolution\n        }\n    }\n\n    var scale = Math.round(resDst / resSrc);\n    return (scale > 1) ? scale : 1;\n};\n\nproto.refineCoords = function(coords) {\n\n    var scaleW = this.dataScaleX;\n    var scaleH = this.dataScaleY;\n\n    var width = coords[0].shape[0];\n    var height = coords[0].shape[1];\n\n    var newWidth = Math.floor(coords[0].shape[0] * scaleW + 1) | 0;\n    var newHeight = Math.floor(coords[0].shape[1] * scaleH + 1) | 0;\n\n    // Pad coords by +1\n    var padWidth = 1 + width + 1;\n    var padHeight = 1 + height + 1;\n    var padImg = ndarray(new Float32Array(padWidth * padHeight), [padWidth, padHeight]);\n\n    for(var i = 0; i < coords.length; ++i) {\n\n        this.surface.padField(padImg, coords[i]);\n\n        var scaledImg = ndarray(new Float32Array(newWidth * newHeight), [newWidth, newHeight]);\n        homography(scaledImg, padImg,\n            [\n                scaleW, 0, 0,\n                0, scaleH, 0,\n                0, 0, 1\n            ]\n        );\n        coords[i] = scaledImg;\n    }\n};\n\nproto.setContourLevels = function() {\n    var nlevels = [[], [], []];\n    var needsUpdate = false;\n\n    for(var i = 0; i < 3; ++i) {\n        if(this.showContour[i]) {\n            needsUpdate = true;\n            nlevels[i] = this.scene.contourLevels[i];\n        }\n    }\n\n    if(needsUpdate) {\n        this.surface.update({ levels: nlevels });\n    }\n};\n\nproto.update = function(data) {\n    var scene = this.scene;\n    var sceneLayout = scene.fullSceneLayout;\n    var surface = this.surface;\n    var alpha = data.opacity;\n    var colormap = parseColorScale(data, alpha);\n    var scaleFactor = scene.dataScale;\n    var xlen = data.z[0].length;\n    var ylen = data._ylength;\n    var contourLevels = scene.contourLevels;\n\n    // Save data\n    this.data = data;\n\n    /*\n     * Fill and transpose zdata.\n     * Consistent with 'heatmap' and 'contour', plotly 'surface'\n     * 'z' are such that sub-arrays correspond to y-coords\n     * and that the sub-array entries correspond to a x-coords,\n     * which is the transpose of 'gl-surface-plot'.\n     */\n\n    var i, j, k, v;\n    var rawCoords = [];\n    for(i = 0; i < 3; i++) {\n        rawCoords[i] = [];\n        for(j = 0; j < xlen; j++) {\n            rawCoords[i][j] = [];\n            /*\n            for(k = 0; k < ylen; k++) {\n                rawCoords[i][j][k] = undefined;\n            }\n            */\n        }\n    }\n\n    // coords x, y & z\n    for(j = 0; j < xlen; j++) {\n        for(k = 0; k < ylen; k++) {\n            rawCoords[0][j][k] = this.getXat(j, k, data.xcalendar, sceneLayout.xaxis);\n            rawCoords[1][j][k] = this.getYat(j, k, data.ycalendar, sceneLayout.yaxis);\n            rawCoords[2][j][k] = this.getZat(j, k, data.zcalendar, sceneLayout.zaxis);\n        }\n    }\n\n    // Note: log axes are not defined in surfaces yet.\n    // but they could be defined here...\n\n    for(i = 0; i < 3; i++) {\n        for(j = 0; j < xlen; j++) {\n            for(k = 0; k < ylen; k++) {\n                v = rawCoords[i][j][k];\n                if(v === null || v === undefined) {\n                    rawCoords[i][j][k] = NaN;\n                } else {\n                    v = rawCoords[i][j][k] *= scaleFactor[i];\n                }\n            }\n        }\n    }\n\n    for(i = 0; i < 3; i++) {\n        for(j = 0; j < xlen; j++) {\n            for(k = 0; k < ylen; k++) {\n                v = rawCoords[i][j][k];\n                if(v !== null && v !== undefined) {\n                    if(this.minValues[i] > v) {\n                        this.minValues[i] = v;\n                    }\n                    if(this.maxValues[i] < v) {\n                        this.maxValues[i] = v;\n                    }\n                }\n            }\n        }\n    }\n\n    for(i = 0; i < 3; i++) {\n        data._objectOffset[i] = 0.5 * (this.minValues[i] + this.maxValues[i]);\n    }\n\n    for(i = 0; i < 3; i++) {\n        for(j = 0; j < xlen; j++) {\n            for(k = 0; k < ylen; k++) {\n                v = rawCoords[i][j][k];\n                if(v !== null && v !== undefined) {\n                    rawCoords[i][j][k] -= data._objectOffset[i];\n                }\n            }\n        }\n    }\n\n    // convert processed raw data to Float32 matrices\n    var coords = [\n        ndarray(new Float32Array(xlen * ylen), [xlen, ylen]),\n        ndarray(new Float32Array(xlen * ylen), [xlen, ylen]),\n        ndarray(new Float32Array(xlen * ylen), [xlen, ylen])\n    ];\n    fill(coords[0], function(row, col) { return rawCoords[0][row][col]; });\n    fill(coords[1], function(row, col) { return rawCoords[1][row][col]; });\n    fill(coords[2], function(row, col) { return rawCoords[2][row][col]; });\n    rawCoords = []; // free memory\n\n    var params = {\n        colormap: colormap,\n        levels: [[], [], []],\n        showContour: [true, true, true],\n        showSurface: !data.hidesurface,\n        contourProject: [\n            [false, false, false],\n            [false, false, false],\n            [false, false, false]\n        ],\n        contourWidth: [1, 1, 1],\n        contourColor: [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]],\n        contourTint: [1, 1, 1],\n        dynamicColor: [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]],\n        dynamicWidth: [1, 1, 1],\n        dynamicTint: [1, 1, 1],\n        opacity: data.opacity\n    };\n\n    params.intensityBounds = [data.cmin, data.cmax];\n\n    // Refine surface color if necessary\n    if(data.surfacecolor) {\n        var intensity = ndarray(new Float32Array(xlen * ylen), [xlen, ylen]);\n\n        fill(intensity, function(row, col) {\n            return data.surfacecolor[col][row];\n        });\n\n        coords.push(intensity);\n    }\n    else {\n        // when 'z' is used as 'intensity',\n        // we must scale its value\n        params.intensityBounds[0] *= scaleFactor[2];\n        params.intensityBounds[1] *= scaleFactor[2];\n    }\n\n    if(MAX_RESOLUTION < coords[0].shape[0] ||\n        MAX_RESOLUTION < coords[0].shape[1]) {\n        this.refineData = false;\n    }\n\n    if(this.refineData === true) {\n        this.dataScaleX = this.estimateScale(coords[0].shape[0], 0);\n        this.dataScaleY = this.estimateScale(coords[0].shape[1], 1);\n        if(this.dataScaleX !== 1 || this.dataScaleY !== 1) {\n            this.refineCoords(coords);\n        }\n    }\n\n    if(data.surfacecolor) {\n        params.intensity = coords.pop();\n    }\n\n    var highlightEnable = [true, true, true];\n    var axis = ['x', 'y', 'z'];\n\n    for(i = 0; i < 3; ++i) {\n        var contourParams = data.contours[axis[i]];\n        highlightEnable[i] = contourParams.highlight;\n\n        params.showContour[i] = contourParams.show || contourParams.highlight;\n        if(!params.showContour[i]) continue;\n\n        params.contourProject[i] = [\n            contourParams.project.x,\n            contourParams.project.y,\n            contourParams.project.z\n        ];\n\n        if(contourParams.show) {\n            this.showContour[i] = true;\n            params.levels[i] = contourLevels[i];\n            surface.highlightColor[i] = params.contourColor[i] = str2RgbaArray(contourParams.color);\n\n            if(contourParams.usecolormap) {\n                surface.highlightTint[i] = params.contourTint[i] = 0;\n            }\n            else {\n                surface.highlightTint[i] = params.contourTint[i] = 1;\n            }\n            params.contourWidth[i] = contourParams.width;\n        } else {\n            this.showContour[i] = false;\n        }\n\n        if(contourParams.highlight) {\n            params.dynamicColor[i] = str2RgbaArray(contourParams.highlightcolor);\n            params.dynamicWidth[i] = contourParams.highlightwidth;\n        }\n    }\n\n    // see https://github.com/plotly/plotly.js/issues/940\n    if(isColormapCircular(colormap)) {\n        params.vertexColor = true;\n    }\n\n    params.objectOffset = [\n        data._objectOffset[0],\n        data._objectOffset[1],\n        data._objectOffset[2]\n    ];\n\n    params.coords = coords;\n    surface.update(params);\n\n    surface.visible = data.visible;\n    surface.enableDynamic = highlightEnable;\n    surface.enableHighlight = highlightEnable;\n\n    surface.snapToData = true;\n\n    if('lighting' in data) {\n        surface.ambientLight = data.lighting.ambient;\n        surface.diffuseLight = data.lighting.diffuse;\n        surface.specularLight = data.lighting.specular;\n        surface.roughness = data.lighting.roughness;\n        surface.fresnel = data.lighting.fresnel;\n    }\n\n    if('lightposition' in data) {\n        surface.lightPosition = [data.lightposition.x, data.lightposition.y, data.lightposition.z];\n    }\n\n    if(alpha && alpha < 1) {\n        surface.supportsTransparency = true;\n    }\n};\n\nproto.dispose = function() {\n    this.scene.glplot.remove(this.surface);\n    this.surface.dispose();\n};\n\nfunction createSurfaceTrace(scene, data) {\n    var gl = scene.glplot.gl;\n    var surface = createSurface({ gl: gl });\n    var result = new SurfaceTrace(scene, surface, data.uid);\n    surface._trace = result;\n    result.update(data);\n    scene.glplot.add(surface);\n    return result;\n}\n\nmodule.exports = createSurfaceTrace;\n"],"mappings":"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EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAC9F,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EACvG,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAC9E,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAC9E,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EACnF,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EACpE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAC9E,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EACpE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EACzE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EACpE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAC9F,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACtE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACxF,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAChE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACpG,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACtE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACxF,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACtE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACtE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAC5E,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAClF,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAC1D,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACxF,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EACxF,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,I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"},"metadata":{},"sourceType":"script","externalDependencies":[]}