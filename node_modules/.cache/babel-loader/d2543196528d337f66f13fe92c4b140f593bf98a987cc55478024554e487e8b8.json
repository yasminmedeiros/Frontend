{"ast":null,"code":"'use strict';\n\nvar createTexture = require('gl-texture2d');\nmodule.exports = createFBO;\nvar colorAttachmentArrays = null;\nvar FRAMEBUFFER_UNSUPPORTED;\nvar FRAMEBUFFER_INCOMPLETE_ATTACHMENT;\nvar FRAMEBUFFER_INCOMPLETE_DIMENSIONS;\nvar FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT;\nfunction saveFBOState(gl) {\n  var fbo = gl.getParameter(gl.FRAMEBUFFER_BINDING);\n  var rbo = gl.getParameter(gl.RENDERBUFFER_BINDING);\n  var tex = gl.getParameter(gl.TEXTURE_BINDING_2D);\n  return [fbo, rbo, tex];\n}\nfunction restoreFBOState(gl, data) {\n  gl.bindFramebuffer(gl.FRAMEBUFFER, data[0]);\n  gl.bindRenderbuffer(gl.RENDERBUFFER, data[1]);\n  gl.bindTexture(gl.TEXTURE_2D, data[2]);\n}\nfunction lazyInitColorAttachments(gl, ext) {\n  var maxColorAttachments = gl.getParameter(ext.MAX_COLOR_ATTACHMENTS_WEBGL);\n  colorAttachmentArrays = new Array(maxColorAttachments + 1);\n  for (var i = 0; i <= maxColorAttachments; ++i) {\n    var x = new Array(maxColorAttachments);\n    for (var j = 0; j < i; ++j) {\n      x[j] = gl.COLOR_ATTACHMENT0 + j;\n    }\n    for (var j = i; j < maxColorAttachments; ++j) {\n      x[j] = gl.NONE;\n    }\n    colorAttachmentArrays[i] = x;\n  }\n}\n\n//Throw an appropriate error\nfunction throwFBOError(status) {\n  switch (status) {\n    case FRAMEBUFFER_UNSUPPORTED:\n      throw new Error('gl-fbo: Framebuffer unsupported');\n    case FRAMEBUFFER_INCOMPLETE_ATTACHMENT:\n      throw new Error('gl-fbo: Framebuffer incomplete attachment');\n    case FRAMEBUFFER_INCOMPLETE_DIMENSIONS:\n      throw new Error('gl-fbo: Framebuffer incomplete dimensions');\n    case FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:\n      throw new Error('gl-fbo: Framebuffer incomplete missing attachment');\n    default:\n      throw new Error('gl-fbo: Framebuffer failed for unspecified reason');\n  }\n}\n\n//Initialize a texture object\nfunction initTexture(gl, width, height, type, format, attachment) {\n  if (!type) {\n    return null;\n  }\n  var result = createTexture(gl, width, height, format, type);\n  result.magFilter = gl.NEAREST;\n  result.minFilter = gl.NEAREST;\n  result.mipSamples = 1;\n  result.bind();\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, result.handle, 0);\n  return result;\n}\n\n//Initialize a render buffer object\nfunction initRenderBuffer(gl, width, height, component, attachment) {\n  var result = gl.createRenderbuffer();\n  gl.bindRenderbuffer(gl.RENDERBUFFER, result);\n  gl.renderbufferStorage(gl.RENDERBUFFER, component, width, height);\n  gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, result);\n  return result;\n}\n\n//Rebuild the frame buffer\nfunction rebuildFBO(fbo) {\n  //Save FBO state\n  var state = saveFBOState(fbo.gl);\n  var gl = fbo.gl;\n  var handle = fbo.handle = gl.createFramebuffer();\n  var width = fbo._shape[0];\n  var height = fbo._shape[1];\n  var numColors = fbo.color.length;\n  var ext = fbo._ext;\n  var useStencil = fbo._useStencil;\n  var useDepth = fbo._useDepth;\n  var colorType = fbo._colorType;\n\n  //Bind the fbo\n  gl.bindFramebuffer(gl.FRAMEBUFFER, handle);\n\n  //Allocate color buffers\n  for (var i = 0; i < numColors; ++i) {\n    fbo.color[i] = initTexture(gl, width, height, colorType, gl.RGBA, gl.COLOR_ATTACHMENT0 + i);\n  }\n  if (numColors === 0) {\n    fbo._color_rb = initRenderBuffer(gl, width, height, gl.RGBA4, gl.COLOR_ATTACHMENT0);\n    if (ext) {\n      ext.drawBuffersWEBGL(colorAttachmentArrays[0]);\n    }\n  } else if (numColors > 1) {\n    ext.drawBuffersWEBGL(colorAttachmentArrays[numColors]);\n  }\n\n  //Allocate depth/stencil buffers\n  var WEBGL_depth_texture = gl.getExtension('WEBGL_depth_texture');\n  if (WEBGL_depth_texture) {\n    if (useStencil) {\n      fbo.depth = initTexture(gl, width, height, WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL, gl.DEPTH_STENCIL, gl.DEPTH_STENCIL_ATTACHMENT);\n    } else if (useDepth) {\n      fbo.depth = initTexture(gl, width, height, gl.UNSIGNED_SHORT, gl.DEPTH_COMPONENT, gl.DEPTH_ATTACHMENT);\n    }\n  } else {\n    if (useDepth && useStencil) {\n      fbo._depth_rb = initRenderBuffer(gl, width, height, gl.DEPTH_STENCIL, gl.DEPTH_STENCIL_ATTACHMENT);\n    } else if (useDepth) {\n      fbo._depth_rb = initRenderBuffer(gl, width, height, gl.DEPTH_COMPONENT16, gl.DEPTH_ATTACHMENT);\n    } else if (useStencil) {\n      fbo._depth_rb = initRenderBuffer(gl, width, height, gl.STENCIL_INDEX, gl.STENCIL_ATTACHMENT);\n    }\n  }\n\n  //Check frame buffer state\n  var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n  if (status !== gl.FRAMEBUFFER_COMPLETE) {\n    //Release all partially allocated resources\n    fbo._destroyed = true;\n\n    //Release all resources\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.deleteFramebuffer(fbo.handle);\n    fbo.handle = null;\n    if (fbo.depth) {\n      fbo.depth.dispose();\n      fbo.depth = null;\n    }\n    if (fbo._depth_rb) {\n      gl.deleteRenderbuffer(fbo._depth_rb);\n      fbo._depth_rb = null;\n    }\n    for (var i = 0; i < fbo.color.length; ++i) {\n      fbo.color[i].dispose();\n      fbo.color[i] = null;\n    }\n    if (fbo._color_rb) {\n      gl.deleteRenderbuffer(fbo._color_rb);\n      fbo._color_rb = null;\n    }\n    restoreFBOState(gl, state);\n\n    //Throw the frame buffer error\n    throwFBOError(status);\n  }\n\n  //Everything ok, let's get on with life\n  restoreFBOState(gl, state);\n}\nfunction Framebuffer(gl, width, height, colorType, numColors, useDepth, useStencil, ext) {\n  //Handle and set properties\n  this.gl = gl;\n  this._shape = [width | 0, height | 0];\n  this._destroyed = false;\n  this._ext = ext;\n\n  //Allocate buffers\n  this.color = new Array(numColors);\n  for (var i = 0; i < numColors; ++i) {\n    this.color[i] = null;\n  }\n  this._color_rb = null;\n  this.depth = null;\n  this._depth_rb = null;\n\n  //Save depth and stencil flags\n  this._colorType = colorType;\n  this._useDepth = useDepth;\n  this._useStencil = useStencil;\n\n  //Shape vector for resizing\n  var parent = this;\n  var shapeVector = [width | 0, height | 0];\n  Object.defineProperties(shapeVector, {\n    0: {\n      get: function get() {\n        return parent._shape[0];\n      },\n      set: function set(w) {\n        return parent.width = w;\n      }\n    },\n    1: {\n      get: function get() {\n        return parent._shape[1];\n      },\n      set: function set(h) {\n        return parent.height = h;\n      }\n    }\n  });\n  this._shapeVector = shapeVector;\n\n  //Initialize all attachments\n  rebuildFBO(this);\n}\nvar proto = Framebuffer.prototype;\nfunction reshapeFBO(fbo, w, h) {\n  //If fbo is invalid, just skip this\n  if (fbo._destroyed) {\n    throw new Error('gl-fbo: Can\\'t resize destroyed FBO');\n  }\n\n  //Don't resize if no change in shape\n  if (fbo._shape[0] === w && fbo._shape[1] === h) {\n    return;\n  }\n  var gl = fbo.gl;\n\n  //Check parameter ranges\n  var maxFBOSize = gl.getParameter(gl.MAX_RENDERBUFFER_SIZE);\n  if (w < 0 || w > maxFBOSize || h < 0 || h > maxFBOSize) {\n    throw new Error('gl-fbo: Can\\'t resize FBO, invalid dimensions');\n  }\n\n  //Update shape\n  fbo._shape[0] = w;\n  fbo._shape[1] = h;\n\n  //Save framebuffer state\n  var state = saveFBOState(gl);\n\n  //Resize framebuffer attachments\n  for (var i = 0; i < fbo.color.length; ++i) {\n    fbo.color[i].shape = fbo._shape;\n  }\n  if (fbo._color_rb) {\n    gl.bindRenderbuffer(gl.RENDERBUFFER, fbo._color_rb);\n    gl.renderbufferStorage(gl.RENDERBUFFER, gl.RGBA4, fbo._shape[0], fbo._shape[1]);\n  }\n  if (fbo.depth) {\n    fbo.depth.shape = fbo._shape;\n  }\n  if (fbo._depth_rb) {\n    gl.bindRenderbuffer(gl.RENDERBUFFER, fbo._depth_rb);\n    if (fbo._useDepth && fbo._useStencil) {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, fbo._shape[0], fbo._shape[1]);\n    } else if (fbo._useDepth) {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, fbo._shape[0], fbo._shape[1]);\n    } else if (fbo._useStencil) {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.STENCIL_INDEX, fbo._shape[0], fbo._shape[1]);\n    }\n  }\n\n  //Check FBO status after resize, if something broke then die in a fire\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fbo.handle);\n  var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n  if (status !== gl.FRAMEBUFFER_COMPLETE) {\n    fbo.dispose();\n    restoreFBOState(gl, state);\n    throwFBOError(status);\n  }\n\n  //Restore framebuffer state\n  restoreFBOState(gl, state);\n}\nObject.defineProperties(proto, {\n  'shape': {\n    get: function get() {\n      if (this._destroyed) {\n        return [0, 0];\n      }\n      return this._shapeVector;\n    },\n    set: function set(x) {\n      if (!Array.isArray(x)) {\n        x = [x | 0, x | 0];\n      }\n      if (x.length !== 2) {\n        throw new Error('gl-fbo: Shape vector must be length 2');\n      }\n      var w = x[0] | 0;\n      var h = x[1] | 0;\n      reshapeFBO(this, w, h);\n      return [w, h];\n    },\n    enumerable: false\n  },\n  'width': {\n    get: function get() {\n      if (this._destroyed) {\n        return 0;\n      }\n      return this._shape[0];\n    },\n    set: function set(w) {\n      w = w | 0;\n      reshapeFBO(this, w, this._shape[1]);\n      return w;\n    },\n    enumerable: false\n  },\n  'height': {\n    get: function get() {\n      if (this._destroyed) {\n        return 0;\n      }\n      return this._shape[1];\n    },\n    set: function set(h) {\n      h = h | 0;\n      reshapeFBO(this, this._shape[0], h);\n      return h;\n    },\n    enumerable: false\n  }\n});\nproto.bind = function () {\n  if (this._destroyed) {\n    return;\n  }\n  var gl = this.gl;\n  gl.bindFramebuffer(gl.FRAMEBUFFER, this.handle);\n  gl.viewport(0, 0, this._shape[0], this._shape[1]);\n};\nproto.dispose = function () {\n  if (this._destroyed) {\n    return;\n  }\n  this._destroyed = true;\n  var gl = this.gl;\n  gl.deleteFramebuffer(this.handle);\n  this.handle = null;\n  if (this.depth) {\n    this.depth.dispose();\n    this.depth = null;\n  }\n  if (this._depth_rb) {\n    gl.deleteRenderbuffer(this._depth_rb);\n    this._depth_rb = null;\n  }\n  for (var i = 0; i < this.color.length; ++i) {\n    this.color[i].dispose();\n    this.color[i] = null;\n  }\n  if (this._color_rb) {\n    gl.deleteRenderbuffer(this._color_rb);\n    this._color_rb = null;\n  }\n};\nfunction createFBO(gl, width, height, options) {\n  //Update frame buffer error code values\n  if (!FRAMEBUFFER_UNSUPPORTED) {\n    FRAMEBUFFER_UNSUPPORTED = gl.FRAMEBUFFER_UNSUPPORTED;\n    FRAMEBUFFER_INCOMPLETE_ATTACHMENT = gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT;\n    FRAMEBUFFER_INCOMPLETE_DIMENSIONS = gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS;\n    FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT = gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT;\n  }\n\n  //Lazily initialize color attachment arrays\n  var WEBGL_draw_buffers = gl.getExtension('WEBGL_draw_buffers');\n  if (!colorAttachmentArrays && WEBGL_draw_buffers) {\n    lazyInitColorAttachments(gl, WEBGL_draw_buffers);\n  }\n\n  //Special case: Can accept an array as argument\n  if (Array.isArray(width)) {\n    options = height;\n    height = width[1] | 0;\n    width = width[0] | 0;\n  }\n  if (typeof width !== 'number') {\n    throw new Error('gl-fbo: Missing shape parameter');\n  }\n\n  //Validate width/height properties\n  var maxFBOSize = gl.getParameter(gl.MAX_RENDERBUFFER_SIZE);\n  if (width < 0 || width > maxFBOSize || height < 0 || height > maxFBOSize) {\n    throw new Error('gl-fbo: Parameters are too large for FBO');\n  }\n\n  //Handle each option type\n  options = options || {};\n\n  //Figure out number of color buffers to use\n  var numColors = 1;\n  if ('color' in options) {\n    numColors = Math.max(options.color | 0, 0);\n    if (numColors < 0) {\n      throw new Error('gl-fbo: Must specify a nonnegative number of colors');\n    }\n    if (numColors > 1) {\n      //Check if multiple render targets supported\n      if (!WEBGL_draw_buffers) {\n        throw new Error('gl-fbo: Multiple draw buffer extension not supported');\n      } else if (numColors > gl.getParameter(WEBGL_draw_buffers.MAX_COLOR_ATTACHMENTS_WEBGL)) {\n        throw new Error('gl-fbo: Context does not support ' + numColors + ' draw buffers');\n      }\n    }\n  }\n\n  //Determine whether to use floating point textures\n  var colorType = gl.UNSIGNED_BYTE;\n  var OES_texture_float = gl.getExtension('OES_texture_float');\n  if (options.float && numColors > 0) {\n    if (!OES_texture_float) {\n      throw new Error('gl-fbo: Context does not support floating point textures');\n    }\n    colorType = gl.FLOAT;\n  } else if (options.preferFloat && numColors > 0) {\n    if (OES_texture_float) {\n      colorType = gl.FLOAT;\n    }\n  }\n\n  //Check if we should use depth buffer\n  var useDepth = true;\n  if ('depth' in options) {\n    useDepth = !!options.depth;\n  }\n\n  //Check if we should use a stencil buffer\n  var useStencil = false;\n  if ('stencil' in options) {\n    useStencil = !!options.stencil;\n  }\n  return new Framebuffer(gl, width, height, colorType, numColors, useDepth, useStencil, WEBGL_draw_buffers);\n}","map":{"version":3,"names":["createTexture","require","module","exports","createFBO","colorAttachmentArrays","FRAMEBUFFER_UNSUPPORTED","FRAMEBUFFER_INCOMPLETE_ATTACHMENT","FRAMEBUFFER_INCOMPLETE_DIMENSIONS","FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT","saveFBOState","gl","fbo","getParameter","FRAMEBUFFER_BINDING","rbo","RENDERBUFFER_BINDING","tex","TEXTURE_BINDING_2D","restoreFBOState","data","bindFramebuffer","FRAMEBUFFER","bindRenderbuffer","RENDERBUFFER","bindTexture","TEXTURE_2D","lazyInitColorAttachments","ext","maxColorAttachments","MAX_COLOR_ATTACHMENTS_WEBGL","Array","i","x","j","COLOR_ATTACHMENT0","NONE","throwFBOError","status","Error","initTexture","width","height","type","format","attachment","result","magFilter","NEAREST","minFilter","mipSamples","bind","framebufferTexture2D","handle","initRenderBuffer","component","createRenderbuffer","renderbufferStorage","framebufferRenderbuffer","rebuildFBO","state","createFramebuffer","_shape","numColors","color","length","_ext","useStencil","_useStencil","useDepth","_useDepth","colorType","_colorType","RGBA","_color_rb","RGBA4","drawBuffersWEBGL","WEBGL_depth_texture","getExtension","depth","UNSIGNED_INT_24_8_WEBGL","DEPTH_STENCIL","DEPTH_STENCIL_ATTACHMENT","UNSIGNED_SHORT","DEPTH_COMPONENT","DEPTH_ATTACHMENT","_depth_rb","DEPTH_COMPONENT16","STENCIL_INDEX","STENCIL_ATTACHMENT","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","_destroyed","deleteFramebuffer","dispose","deleteRenderbuffer","Framebuffer","parent","shapeVector","Object","defineProperties","get","set","w","h","_shapeVector","proto","prototype","reshapeFBO","maxFBOSize","MAX_RENDERBUFFER_SIZE","shape","isArray","enumerable","viewport","options","WEBGL_draw_buffers","Math","max","UNSIGNED_BYTE","OES_texture_float","float","FLOAT","preferFloat","stencil"],"sources":["/home/yasmin/√Årea de Trabalho/Frontend/node_modules/gl-fbo/fbo.js"],"sourcesContent":["'use strict'\n\nvar createTexture = require('gl-texture2d')\n\nmodule.exports = createFBO\n\nvar colorAttachmentArrays = null\nvar FRAMEBUFFER_UNSUPPORTED\nvar FRAMEBUFFER_INCOMPLETE_ATTACHMENT\nvar FRAMEBUFFER_INCOMPLETE_DIMENSIONS\nvar FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT\n\nfunction saveFBOState(gl) {\n  var fbo = gl.getParameter(gl.FRAMEBUFFER_BINDING)\n  var rbo = gl.getParameter(gl.RENDERBUFFER_BINDING)\n  var tex = gl.getParameter(gl.TEXTURE_BINDING_2D)\n  return [fbo, rbo, tex]\n}\n\nfunction restoreFBOState(gl, data) {\n  gl.bindFramebuffer(gl.FRAMEBUFFER, data[0])\n  gl.bindRenderbuffer(gl.RENDERBUFFER, data[1])\n  gl.bindTexture(gl.TEXTURE_2D, data[2])\n}\n\nfunction lazyInitColorAttachments(gl, ext) {\n  var maxColorAttachments = gl.getParameter(ext.MAX_COLOR_ATTACHMENTS_WEBGL)\n  colorAttachmentArrays = new Array(maxColorAttachments + 1)\n  for(var i=0; i<=maxColorAttachments; ++i) {\n    var x = new Array(maxColorAttachments)\n    for(var j=0; j<i; ++j) {\n      x[j] = gl.COLOR_ATTACHMENT0 + j\n    }\n    for(var j=i; j<maxColorAttachments; ++j) {\n      x[j] = gl.NONE\n    }\n    colorAttachmentArrays[i] = x\n  }\n}\n\n//Throw an appropriate error\nfunction throwFBOError(status) {\n  switch(status){\n    case FRAMEBUFFER_UNSUPPORTED:\n      throw new Error('gl-fbo: Framebuffer unsupported')\n    case FRAMEBUFFER_INCOMPLETE_ATTACHMENT:\n      throw new Error('gl-fbo: Framebuffer incomplete attachment')\n    case FRAMEBUFFER_INCOMPLETE_DIMENSIONS:\n      throw new Error('gl-fbo: Framebuffer incomplete dimensions')\n    case FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:\n      throw new Error('gl-fbo: Framebuffer incomplete missing attachment')\n    default:\n      throw new Error('gl-fbo: Framebuffer failed for unspecified reason')\n  }\n}\n\n//Initialize a texture object\nfunction initTexture(gl, width, height, type, format, attachment) {\n  if(!type) {\n    return null\n  }\n  var result = createTexture(gl, width, height, format, type)\n  result.magFilter = gl.NEAREST\n  result.minFilter = gl.NEAREST\n  result.mipSamples = 1\n  result.bind()\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, result.handle, 0)\n  return result\n}\n\n//Initialize a render buffer object\nfunction initRenderBuffer(gl, width, height, component, attachment) {\n  var result = gl.createRenderbuffer()\n  gl.bindRenderbuffer(gl.RENDERBUFFER, result)\n  gl.renderbufferStorage(gl.RENDERBUFFER, component, width, height)\n  gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, result)\n  return result\n}\n\n//Rebuild the frame buffer\nfunction rebuildFBO(fbo) {\n\n  //Save FBO state\n  var state = saveFBOState(fbo.gl)\n\n  var gl = fbo.gl\n  var handle = fbo.handle = gl.createFramebuffer()\n  var width = fbo._shape[0]\n  var height = fbo._shape[1]\n  var numColors = fbo.color.length\n  var ext = fbo._ext\n  var useStencil = fbo._useStencil\n  var useDepth = fbo._useDepth\n  var colorType = fbo._colorType\n\n  //Bind the fbo\n  gl.bindFramebuffer(gl.FRAMEBUFFER, handle)\n\n  //Allocate color buffers\n  for(var i=0; i<numColors; ++i) {\n    fbo.color[i] = initTexture(gl, width, height, colorType, gl.RGBA, gl.COLOR_ATTACHMENT0 + i)\n  }\n  if(numColors === 0) {\n    fbo._color_rb = initRenderBuffer(gl, width, height, gl.RGBA4, gl.COLOR_ATTACHMENT0)\n    if(ext) {\n      ext.drawBuffersWEBGL(colorAttachmentArrays[0])\n    }\n  } else if(numColors > 1) {\n    ext.drawBuffersWEBGL(colorAttachmentArrays[numColors])\n  }\n\n  //Allocate depth/stencil buffers\n  var WEBGL_depth_texture = gl.getExtension('WEBGL_depth_texture')\n  if(WEBGL_depth_texture) {\n    if(useStencil) {\n      fbo.depth = initTexture(gl, width, height,\n                          WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL,\n                          gl.DEPTH_STENCIL,\n                          gl.DEPTH_STENCIL_ATTACHMENT)\n    } else if(useDepth) {\n      fbo.depth = initTexture(gl, width, height,\n                          gl.UNSIGNED_SHORT,\n                          gl.DEPTH_COMPONENT,\n                          gl.DEPTH_ATTACHMENT)\n    }\n  } else {\n    if(useDepth && useStencil) {\n      fbo._depth_rb = initRenderBuffer(gl, width, height, gl.DEPTH_STENCIL, gl.DEPTH_STENCIL_ATTACHMENT)\n    } else if(useDepth) {\n      fbo._depth_rb = initRenderBuffer(gl, width, height, gl.DEPTH_COMPONENT16, gl.DEPTH_ATTACHMENT)\n    } else if(useStencil) {\n      fbo._depth_rb = initRenderBuffer(gl, width, height, gl.STENCIL_INDEX, gl.STENCIL_ATTACHMENT)\n    }\n  }\n\n  //Check frame buffer state\n  var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER)\n  if(status !== gl.FRAMEBUFFER_COMPLETE) {\n\n    //Release all partially allocated resources\n    fbo._destroyed = true\n\n    //Release all resources\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null)\n    gl.deleteFramebuffer(fbo.handle)\n    fbo.handle = null\n    if(fbo.depth) {\n      fbo.depth.dispose()\n      fbo.depth = null\n    }\n    if(fbo._depth_rb) {\n      gl.deleteRenderbuffer(fbo._depth_rb)\n      fbo._depth_rb = null\n    }\n    for(var i=0; i<fbo.color.length; ++i) {\n      fbo.color[i].dispose()\n      fbo.color[i] = null\n    }\n    if(fbo._color_rb) {\n      gl.deleteRenderbuffer(fbo._color_rb)\n      fbo._color_rb = null\n    }\n\n    restoreFBOState(gl, state)\n\n    //Throw the frame buffer error\n    throwFBOError(status)\n  }\n\n  //Everything ok, let's get on with life\n  restoreFBOState(gl, state)\n}\n\nfunction Framebuffer(gl, width, height, colorType, numColors, useDepth, useStencil, ext) {\n\n  //Handle and set properties\n  this.gl = gl\n  this._shape = [width|0, height|0]\n  this._destroyed = false\n  this._ext = ext\n\n  //Allocate buffers\n  this.color = new Array(numColors)\n  for(var i=0; i<numColors; ++i) {\n    this.color[i] = null\n  }\n  this._color_rb = null\n  this.depth = null\n  this._depth_rb = null\n\n  //Save depth and stencil flags\n  this._colorType = colorType\n  this._useDepth = useDepth\n  this._useStencil = useStencil\n\n  //Shape vector for resizing\n  var parent = this\n  var shapeVector = [width|0, height|0]\n  Object.defineProperties(shapeVector, {\n    0: {\n      get: function() {\n        return parent._shape[0]\n      },\n      set: function(w) {\n        return parent.width = w\n      }\n    },\n    1: {\n      get: function() {\n        return parent._shape[1]\n      },\n      set: function(h) {\n        return parent.height = h\n      }\n    }\n  })\n  this._shapeVector = shapeVector\n\n  //Initialize all attachments\n  rebuildFBO(this)\n}\n\nvar proto = Framebuffer.prototype\n\nfunction reshapeFBO(fbo, w, h) {\n  //If fbo is invalid, just skip this\n  if(fbo._destroyed) {\n    throw new Error('gl-fbo: Can\\'t resize destroyed FBO')\n  }\n\n  //Don't resize if no change in shape\n  if( (fbo._shape[0] === w) &&\n      (fbo._shape[1] === h) ) {\n    return\n  }\n\n  var gl = fbo.gl\n\n  //Check parameter ranges\n  var maxFBOSize = gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)\n  if( w < 0 || w > maxFBOSize ||\n      h < 0 || h > maxFBOSize) {\n    throw new Error('gl-fbo: Can\\'t resize FBO, invalid dimensions')\n  }\n\n  //Update shape\n  fbo._shape[0] = w\n  fbo._shape[1] = h\n\n  //Save framebuffer state\n  var state = saveFBOState(gl)\n\n  //Resize framebuffer attachments\n  for(var i=0; i<fbo.color.length; ++i) {\n    fbo.color[i].shape = fbo._shape\n  }\n  if(fbo._color_rb) {\n    gl.bindRenderbuffer(gl.RENDERBUFFER, fbo._color_rb)\n    gl.renderbufferStorage(gl.RENDERBUFFER, gl.RGBA4, fbo._shape[0], fbo._shape[1])\n  }\n  if(fbo.depth) {\n    fbo.depth.shape = fbo._shape\n  }\n  if(fbo._depth_rb) {\n    gl.bindRenderbuffer(gl.RENDERBUFFER, fbo._depth_rb)\n    if(fbo._useDepth && fbo._useStencil) {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, fbo._shape[0], fbo._shape[1])\n    } else if(fbo._useDepth) {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, fbo._shape[0], fbo._shape[1])\n    } else if(fbo._useStencil) {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.STENCIL_INDEX, fbo._shape[0], fbo._shape[1])\n    }\n  }\n\n  //Check FBO status after resize, if something broke then die in a fire\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fbo.handle)\n  var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER)\n  if(status !== gl.FRAMEBUFFER_COMPLETE) {\n    fbo.dispose()\n    restoreFBOState(gl, state)\n    throwFBOError(status)\n  }\n\n  //Restore framebuffer state\n  restoreFBOState(gl, state)\n}\n\nObject.defineProperties(proto, {\n  'shape': {\n    get: function() {\n      if(this._destroyed) {\n        return [0,0]\n      }\n      return this._shapeVector\n    },\n    set: function(x) {\n      if(!Array.isArray(x)) {\n        x = [x|0, x|0]\n      }\n      if(x.length !== 2) {\n        throw new Error('gl-fbo: Shape vector must be length 2')\n      }\n\n      var w = x[0]|0\n      var h = x[1]|0\n      reshapeFBO(this, w, h)\n\n      return [w, h]\n    },\n    enumerable: false\n  },\n  'width': {\n    get: function() {\n      if(this._destroyed) {\n        return 0\n      }\n      return this._shape[0]\n    },\n    set: function(w) {\n      w = w|0\n      reshapeFBO(this, w, this._shape[1])\n      return w\n    },\n    enumerable: false\n  },\n  'height': {\n    get: function() {\n      if(this._destroyed) {\n        return 0\n      }\n      return this._shape[1]\n    },\n    set: function(h) {\n      h = h|0\n      reshapeFBO(this, this._shape[0], h)\n      return h\n    },\n    enumerable: false\n  }\n})\n\nproto.bind = function() {\n  if(this._destroyed) {\n    return\n  }\n  var gl = this.gl\n  gl.bindFramebuffer(gl.FRAMEBUFFER, this.handle)\n  gl.viewport(0, 0, this._shape[0], this._shape[1])\n}\n\nproto.dispose = function() {\n  if(this._destroyed) {\n    return\n  }\n  this._destroyed = true\n  var gl = this.gl\n  gl.deleteFramebuffer(this.handle)\n  this.handle = null\n  if(this.depth) {\n    this.depth.dispose()\n    this.depth = null\n  }\n  if(this._depth_rb) {\n    gl.deleteRenderbuffer(this._depth_rb)\n    this._depth_rb = null\n  }\n  for(var i=0; i<this.color.length; ++i) {\n    this.color[i].dispose()\n    this.color[i] = null\n  }\n  if(this._color_rb) {\n    gl.deleteRenderbuffer(this._color_rb)\n    this._color_rb = null\n  }\n}\n\nfunction createFBO(gl, width, height, options) {\n\n  //Update frame buffer error code values\n  if(!FRAMEBUFFER_UNSUPPORTED) {\n    FRAMEBUFFER_UNSUPPORTED = gl.FRAMEBUFFER_UNSUPPORTED\n    FRAMEBUFFER_INCOMPLETE_ATTACHMENT = gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT\n    FRAMEBUFFER_INCOMPLETE_DIMENSIONS = gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS\n    FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT = gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT\n  }\n\n  //Lazily initialize color attachment arrays\n  var WEBGL_draw_buffers = gl.getExtension('WEBGL_draw_buffers')\n  if(!colorAttachmentArrays && WEBGL_draw_buffers) {\n    lazyInitColorAttachments(gl, WEBGL_draw_buffers)\n  }\n\n  //Special case: Can accept an array as argument\n  if(Array.isArray(width)) {\n    options = height\n    height = width[1]|0\n    width = width[0]|0\n  }\n\n  if(typeof width !== 'number') {\n    throw new Error('gl-fbo: Missing shape parameter')\n  }\n\n  //Validate width/height properties\n  var maxFBOSize = gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)\n  if(width < 0 || width > maxFBOSize || height < 0 || height > maxFBOSize) {\n    throw new Error('gl-fbo: Parameters are too large for FBO')\n  }\n\n  //Handle each option type\n  options = options || {}\n\n  //Figure out number of color buffers to use\n  var numColors = 1\n  if('color' in options) {\n    numColors = Math.max(options.color|0, 0)\n    if(numColors < 0) {\n      throw new Error('gl-fbo: Must specify a nonnegative number of colors')\n    }\n    if(numColors > 1) {\n      //Check if multiple render targets supported\n      if(!WEBGL_draw_buffers) {\n        throw new Error('gl-fbo: Multiple draw buffer extension not supported')\n      } else if(numColors > gl.getParameter(WEBGL_draw_buffers.MAX_COLOR_ATTACHMENTS_WEBGL)) {\n        throw new Error('gl-fbo: Context does not support ' + numColors + ' draw buffers')\n      }\n    }\n  }\n\n  //Determine whether to use floating point textures\n  var colorType = gl.UNSIGNED_BYTE\n  var OES_texture_float = gl.getExtension('OES_texture_float')\n  if(options.float && numColors > 0) {\n    if(!OES_texture_float) {\n      throw new Error('gl-fbo: Context does not support floating point textures')\n    }\n    colorType = gl.FLOAT\n  } else if(options.preferFloat && numColors > 0) {\n    if(OES_texture_float) {\n      colorType = gl.FLOAT\n    }\n  }\n\n  //Check if we should use depth buffer\n  var useDepth = true\n  if('depth' in options) {\n    useDepth = !!options.depth\n  }\n\n  //Check if we should use a stencil buffer\n  var useStencil = false\n  if('stencil' in options) {\n    useStencil = !!options.stencil\n  }\n\n  return new Framebuffer(\n    gl,\n    width,\n    height,\n    colorType,\n    numColors,\n    useDepth,\n    useStencil,\n    WEBGL_draw_buffers)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}