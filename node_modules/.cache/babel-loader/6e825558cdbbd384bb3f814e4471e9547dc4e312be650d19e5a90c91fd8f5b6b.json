{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\nvar tinycolor = require('tinycolor2');\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\nvar dragElement = require('../dragelement');\nvar Lib = require('../../lib');\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar setCursor = require('../../lib/setcursor');\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar Titles = require('../titles');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar alignmentConstants = require('../../constants/alignment');\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\nvar handleAxisDefaults = require('../../plots/cartesian/axis_defaults');\nvar handleAxisPositionDefaults = require('../../plots/cartesian/position_defaults');\nvar axisLayoutAttrs = require('../../plots/cartesian/layout_attributes');\nvar attributes = require('./attributes');\nvar cn = require('./constants').cn;\nmodule.exports = function draw(gd, id) {\n  // opts: options object, containing everything from attributes\n  // plus a few others that are the equivalent of the colorbar \"data\"\n  var opts = {};\n  for (var k in attributes) {\n    opts[k] = null;\n  }\n  // fillcolor can be a d3 scale, domain is z values, range is colors\n  // or leave it out for no fill,\n  // or set to a string constant for single-color fill\n  opts.fillcolor = null;\n  // line.color has the same options as fillcolor\n  opts.line = {\n    color: null,\n    width: null,\n    dash: null\n  };\n  // levels of lines to draw.\n  // note that this DOES NOT determine the extent of the bar\n  // that's given by the domain of fillcolor\n  // (or line.color if no fillcolor domain)\n  opts.levels = {\n    start: null,\n    end: null,\n    size: null\n  };\n  // separate fill levels (for example, heatmap coloring of a\n  // contour map) if this is omitted, fillcolors will be\n  // evaluated halfway between levels\n  opts.filllevels = null;\n  // for continuous colorscales: fill with a gradient instead of explicit levels\n  // value should be the colorscale [[0, c0], [v1, c1], ..., [1, cEnd]]\n  opts.fillgradient = null;\n  // when using a gradient, we need the data range specified separately\n  opts.zrange = null;\n  function component() {\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n    if (typeof opts.fillcolor !== 'function' && typeof opts.line.color !== 'function' && !opts.fillgradient) {\n      fullLayout._infolayer.selectAll('g.' + id).remove();\n      return;\n    }\n    var zrange = opts.zrange || d3.extent((typeof opts.fillcolor === 'function' ? opts.fillcolor : opts.line.color).domain());\n    var linelevels = [];\n    var filllevels = [];\n    var linecolormap = typeof opts.line.color === 'function' ? opts.line.color : function () {\n      return opts.line.color;\n    };\n    var fillcolormap = typeof opts.fillcolor === 'function' ? opts.fillcolor : function () {\n      return opts.fillcolor;\n    };\n    var l;\n    var i;\n    var l0 = opts.levels.end + opts.levels.size / 100;\n    var ls = opts.levels.size;\n    var zr0 = 1.001 * zrange[0] - 0.001 * zrange[1];\n    var zr1 = 1.001 * zrange[1] - 0.001 * zrange[0];\n    for (i = 0; i < 1e5; i++) {\n      l = opts.levels.start + i * ls;\n      if (ls > 0 ? l >= l0 : l <= l0) break;\n      if (l > zr0 && l < zr1) linelevels.push(l);\n    }\n    if (opts.fillgradient) {\n      filllevels = [0];\n    } else if (typeof opts.fillcolor === 'function') {\n      if (opts.filllevels) {\n        l0 = opts.filllevels.end + opts.filllevels.size / 100;\n        ls = opts.filllevels.size;\n        for (i = 0; i < 1e5; i++) {\n          l = opts.filllevels.start + i * ls;\n          if (ls > 0 ? l >= l0 : l <= l0) break;\n          if (l > zrange[0] && l < zrange[1]) filllevels.push(l);\n        }\n      } else {\n        filllevels = linelevels.map(function (v) {\n          return v - opts.levels.size / 2;\n        });\n        filllevels.push(filllevels[filllevels.length - 1] + opts.levels.size);\n      }\n    } else if (opts.fillcolor && typeof opts.fillcolor === 'string') {\n      // doesn't matter what this value is, with a single value\n      // we'll make a single fill rect covering the whole bar\n      filllevels = [0];\n    }\n    if (opts.levels.size < 0) {\n      linelevels.reverse();\n      filllevels.reverse();\n    }\n\n    // now make a Plotly Axes object to scale with and draw ticks\n    // TODO: does not support orientation other than right\n\n    // we calculate pixel sizes based on the specified graph size,\n    // not the actual (in case something pushed the margins around)\n    // which is a little odd but avoids an odd iterative effect\n    // when the colorbar itself is pushing the margins.\n    // but then the fractional size is calculated based on the\n    // actual graph size, so that the axes will size correctly.\n    var plotHeight = gs.h;\n    var plotWidth = gs.w;\n    var thickPx = Math.round(opts.thickness * (opts.thicknessmode === 'fraction' ? plotWidth : 1));\n    var thickFrac = thickPx / gs.w;\n    var lenPx = Math.round(opts.len * (opts.lenmode === 'fraction' ? plotHeight : 1));\n    var lenFrac = lenPx / gs.h;\n    var xpadFrac = opts.xpad / gs.w;\n    var yExtraPx = (opts.borderwidth + opts.outlinewidth) / 2;\n    var ypadFrac = opts.ypad / gs.h;\n\n    // x positioning: do it initially just for left anchor,\n    // then fix at the end (since we don't know the width yet)\n    var xLeft = Math.round(opts.x * gs.w + opts.xpad);\n    // for dragging... this is getting a little muddled...\n    var xLeftFrac = opts.x - thickFrac * ({\n      middle: 0.5,\n      right: 1\n    }[opts.xanchor] || 0);\n\n    // y positioning we can do correctly from the start\n    var yBottomFrac = opts.y + lenFrac * (({\n      top: -0.5,\n      bottom: 0.5\n    }[opts.yanchor] || 0) - 0.5);\n    var yBottomPx = Math.round(gs.h * (1 - yBottomFrac));\n    var yTopPx = yBottomPx - lenPx;\n    var titleEl;\n    var cbAxisIn = {\n      type: 'linear',\n      range: zrange,\n      tickmode: opts.tickmode,\n      nticks: opts.nticks,\n      tick0: opts.tick0,\n      dtick: opts.dtick,\n      tickvals: opts.tickvals,\n      ticktext: opts.ticktext,\n      ticks: opts.ticks,\n      ticklen: opts.ticklen,\n      tickwidth: opts.tickwidth,\n      tickcolor: opts.tickcolor,\n      showticklabels: opts.showticklabels,\n      tickfont: opts.tickfont,\n      tickangle: opts.tickangle,\n      tickformat: opts.tickformat,\n      exponentformat: opts.exponentformat,\n      separatethousands: opts.separatethousands,\n      showexponent: opts.showexponent,\n      showtickprefix: opts.showtickprefix,\n      tickprefix: opts.tickprefix,\n      showticksuffix: opts.showticksuffix,\n      ticksuffix: opts.ticksuffix,\n      title: opts.title,\n      showline: true,\n      anchor: 'free',\n      side: 'right',\n      position: 1\n    };\n    var cbAxisOut = {\n      type: 'linear',\n      _id: 'y' + id\n    };\n    var axisOptions = {\n      letter: 'y',\n      font: fullLayout.font,\n      noHover: true,\n      noTickson: true,\n      calendar: fullLayout.calendar // not really necessary (yet?)\n    };\n\n    // Coerce w.r.t. Axes layoutAttributes:\n    // re-use axes.js logic without updating _fullData\n    function coerce(attr, dflt) {\n      return Lib.coerce(cbAxisIn, cbAxisOut, axisLayoutAttrs, attr, dflt);\n    }\n\n    // Prepare the Plotly axis object\n    handleAxisDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions, fullLayout);\n    handleAxisPositionDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions);\n\n    // position can't go in through supplyDefaults\n    // because that restricts it to [0,1]\n    cbAxisOut.position = opts.x + xpadFrac + thickFrac;\n\n    // save for other callers to access this axis\n    component.axis = cbAxisOut;\n    if (['top', 'bottom'].indexOf(opts.title.side) !== -1) {\n      cbAxisOut.title.side = opts.title.side;\n      cbAxisOut.titlex = opts.x + xpadFrac;\n      cbAxisOut.titley = yBottomFrac + (opts.title.side === 'top' ? lenFrac - ypadFrac : ypadFrac);\n    }\n    if (opts.line.color && opts.tickmode === 'auto') {\n      cbAxisOut.tickmode = 'linear';\n      cbAxisOut.tick0 = opts.levels.start;\n      var dtick = opts.levels.size;\n      // expand if too many contours, so we don't get too many ticks\n      var autoNtick = Lib.constrain((yBottomPx - yTopPx) / 50, 4, 15) + 1;\n      var dtFactor = (zrange[1] - zrange[0]) / ((opts.nticks || autoNtick) * dtick);\n      if (dtFactor > 1) {\n        var dtexp = Math.pow(10, Math.floor(Math.log(dtFactor) / Math.LN10));\n        dtick *= dtexp * Lib.roundUp(dtFactor / dtexp, [2, 5, 10]);\n        // if the contours are at round multiples, reset tick0\n        // so they're still at round multiples. Otherwise,\n        // keep the first label on the first contour level\n        if ((Math.abs(opts.levels.start) / opts.levels.size + 1e-6) % 1 < 2e-6) {\n          cbAxisOut.tick0 = 0;\n        }\n      }\n      cbAxisOut.dtick = dtick;\n    }\n\n    // set domain after init, because we may want to\n    // allow it outside [0,1]\n    cbAxisOut.domain = [yBottomFrac + ypadFrac, yBottomFrac + lenFrac - ypadFrac];\n    cbAxisOut.setScale();\n\n    // now draw the elements\n    var container = Lib.ensureSingle(fullLayout._infolayer, 'g', id, function (s) {\n      s.classed(cn.colorbar, true).each(function () {\n        var s = d3.select(this);\n        s.append('rect').classed(cn.cbbg, true);\n        s.append('g').classed(cn.cbfills, true);\n        s.append('g').classed(cn.cblines, true);\n        s.append('g').classed(cn.cbaxis, true).classed(cn.crisp, true);\n        s.append('g').classed(cn.cbtitleunshift, true).append('g').classed(cn.cbtitle, true);\n        s.append('rect').classed(cn.cboutline, true);\n        s.select('.cbtitle').datum(0);\n      });\n    });\n    container.attr('transform', 'translate(' + Math.round(gs.l) + ',' + Math.round(gs.t) + ')');\n    // TODO: this opposite transform is a hack until we make it\n    // more rational which items get this offset\n    var titleCont = container.select('.cbtitleunshift').attr('transform', 'translate(-' + Math.round(gs.l) + ',-' + Math.round(gs.t) + ')');\n    var axisLayer = container.select('.cbaxis');\n    var titleHeight = 0;\n    if (['top', 'bottom'].indexOf(opts.title.side) !== -1) {\n      // draw the title so we know how much room it needs\n      // when we squish the axis. This one only applies to\n      // top or bottom titles, not right side.\n      var x = gs.l + (opts.x + xpadFrac) * gs.w;\n      var fontSize = cbAxisOut.title.font.size;\n      var y;\n      if (opts.title.side === 'top') {\n        y = (1 - (yBottomFrac + lenFrac - ypadFrac)) * gs.h + gs.t + 3 + fontSize * 0.75;\n      } else {\n        y = (1 - (yBottomFrac + ypadFrac)) * gs.h + gs.t - 3 - fontSize * 0.25;\n      }\n      drawTitle(cbAxisOut._id + 'title', {\n        attributes: {\n          x: x,\n          y: y,\n          'text-anchor': 'start'\n        }\n      });\n    }\n    function drawAxis() {\n      if (['top', 'bottom'].indexOf(opts.title.side) !== -1) {\n        // squish the axis top to make room for the title\n        var titleGroup = container.select('.cbtitle');\n        var titleText = titleGroup.select('text');\n        var titleTrans = [-opts.outlinewidth / 2, opts.outlinewidth / 2];\n        var mathJaxNode = titleGroup.select('.h' + cbAxisOut._id + 'title-math-group').node();\n        var lineSize = 15.6;\n        if (titleText.node()) {\n          lineSize = parseInt(titleText.node().style.fontSize, 10) * LINE_SPACING;\n        }\n        if (mathJaxNode) {\n          titleHeight = Drawing.bBox(mathJaxNode).height;\n          if (titleHeight > lineSize) {\n            // not entirely sure how mathjax is doing\n            // vertical alignment, but this seems to work.\n            titleTrans[1] -= (titleHeight - lineSize) / 2;\n          }\n        } else if (titleText.node() && !titleText.classed(cn.jsPlaceholder)) {\n          titleHeight = Drawing.bBox(titleText.node()).height;\n        }\n        if (titleHeight) {\n          // buffer btwn colorbar and title\n          // TODO: configurable\n          titleHeight += 5;\n          if (opts.title.side === 'top') {\n            cbAxisOut.domain[1] -= titleHeight / gs.h;\n            titleTrans[1] *= -1;\n          } else {\n            cbAxisOut.domain[0] += titleHeight / gs.h;\n            var nlines = svgTextUtils.lineCount(titleText);\n            titleTrans[1] += (1 - nlines) * lineSize;\n          }\n          titleGroup.attr('transform', 'translate(' + titleTrans + ')');\n          cbAxisOut.setScale();\n        }\n      }\n      container.selectAll('.cbfills,.cblines').attr('transform', 'translate(0,' + Math.round(gs.h * (1 - cbAxisOut.domain[1])) + ')');\n      axisLayer.attr('transform', 'translate(0,' + Math.round(-gs.t) + ')');\n      var fills = container.select('.cbfills').selectAll('rect.cbfill').data(filllevels);\n      fills.enter().append('rect').classed(cn.cbfill, true).style('stroke', 'none');\n      fills.exit().remove();\n      var zBounds = zrange.map(cbAxisOut.c2p).map(Math.round).sort(function (a, b) {\n        return a - b;\n      });\n      fills.each(function (d, i) {\n        var z = [i === 0 ? zrange[0] : (filllevels[i] + filllevels[i - 1]) / 2, i === filllevels.length - 1 ? zrange[1] : (filllevels[i] + filllevels[i + 1]) / 2].map(cbAxisOut.c2p).map(Math.round);\n\n        // offset the side adjoining the next rectangle so they\n        // overlap, to prevent antialiasing gaps\n        z[1] = Lib.constrain(z[1] + (z[1] > z[0]) ? 1 : -1, zBounds[0], zBounds[1]);\n\n        // Colorbar cannot currently support opacities so we\n        // use an opaque fill even when alpha channels present\n        var fillEl = d3.select(this).attr({\n          x: xLeft,\n          width: Math.max(thickPx, 2),\n          y: d3.min(z),\n          height: Math.max(d3.max(z) - d3.min(z), 2)\n        });\n        if (opts.fillgradient) {\n          Drawing.gradient(fillEl, gd, id, 'vertical', opts.fillgradient, 'fill');\n        } else {\n          // Tinycolor can't handle exponents and\n          // at this scale, removing it makes no difference.\n          var colorString = fillcolormap(d).replace('e-', '');\n          fillEl.attr('fill', tinycolor(colorString).toHexString());\n        }\n      });\n      var lines = container.select('.cblines').selectAll('path.cbline').data(opts.line.color && opts.line.width ? linelevels : []);\n      lines.enter().append('path').classed(cn.cbline, true);\n      lines.exit().remove();\n      lines.each(function (d) {\n        d3.select(this).attr('d', 'M' + xLeft + ',' + (Math.round(cbAxisOut.c2p(d)) + opts.line.width / 2 % 1) + 'h' + thickPx).call(Drawing.lineGroupStyle, opts.line.width, linecolormap(d), opts.line.dash);\n      });\n\n      // force full redraw of labels and ticks\n      axisLayer.selectAll('g.' + cbAxisOut._id + 'tick,path').remove();\n\n      // separate out axis and title drawing,\n      // so we don't need such complicated logic in Titles.draw\n      // if title is on the top or bottom, we've already drawn it\n      // this title call only handles side=right\n      return Lib.syncOrAsync([function () {\n        var shift = xLeft + thickPx + (opts.outlinewidth || 0) / 2 - (opts.ticks === 'outside' ? 1 : 0);\n        var vals = Axes.calcTicks(cbAxisOut);\n        var transFn = Axes.makeTransFn(cbAxisOut);\n        var labelFns = Axes.makeLabelFns(cbAxisOut, shift);\n        var tickSign = Axes.getTickSigns(cbAxisOut)[2];\n        Axes.drawTicks(gd, cbAxisOut, {\n          vals: cbAxisOut.ticks === 'inside' ? Axes.clipEnds(cbAxisOut, vals) : vals,\n          layer: axisLayer,\n          path: Axes.makeTickPath(cbAxisOut, shift, tickSign),\n          transFn: transFn\n        });\n        return Axes.drawLabels(gd, cbAxisOut, {\n          vals: vals,\n          layer: axisLayer,\n          transFn: transFn,\n          labelXFn: labelFns.labelXFn,\n          labelYFn: labelFns.labelYFn,\n          labelAnchorFn: labelFns.labelAnchorFn\n        });\n      }, function () {\n        if (['top', 'bottom'].indexOf(opts.title.side) === -1) {\n          var fontSize = cbAxisOut.title.font.size;\n          var y = cbAxisOut._offset + cbAxisOut._length / 2;\n          var x = gs.l + (cbAxisOut.position || 0) * gs.w + (cbAxisOut.side === 'right' ? 10 + fontSize * (cbAxisOut.showticklabels ? 1 : 0.5) : -10 - fontSize * (cbAxisOut.showticklabels ? 0.5 : 0));\n\n          // the 'h' + is a hack to get around the fact that\n          // convertToTspans rotates any 'y...' class by 90 degrees.\n          // TODO: find a better way to control this.\n          drawTitle('h' + cbAxisOut._id + 'title', {\n            avoid: {\n              selection: d3.select(gd).selectAll('g.' + cbAxisOut._id + 'tick'),\n              side: opts.title.side,\n              offsetLeft: gs.l,\n              offsetTop: 0,\n              maxShift: fullLayout.width\n            },\n            attributes: {\n              x: x,\n              y: y,\n              'text-anchor': 'middle'\n            },\n            transform: {\n              rotate: '-90',\n              offset: 0\n            }\n          });\n        }\n      }]);\n    }\n    function drawTitle(titleClass, titleOpts) {\n      var dfltTitleOpts = {\n        propContainer: cbAxisOut,\n        propName: getPropName('title'),\n        traceIndex: getTrace().index,\n        placeholder: fullLayout._dfltTitle.colorbar,\n        containerGroup: container.select('.cbtitle')\n      };\n\n      // this class-to-rotate thing with convertToTspans is\n      // getting hackier and hackier... delete groups with the\n      // wrong class (in case earlier the colorbar was drawn on\n      // a different side, I think?)\n      var otherClass = titleClass.charAt(0) === 'h' ? titleClass.substr(1) : 'h' + titleClass;\n      container.selectAll('.' + otherClass + ',.' + otherClass + '-math-group').remove();\n      Titles.draw(gd, titleClass, extendFlat(dfltTitleOpts, titleOpts || {}));\n    }\n    function positionCB() {\n      // wait for the axis & title to finish rendering before\n      // continuing positioning\n      // TODO: why are we redrawing multiple times now with this?\n      // I guess autoMargin doesn't like being post-promise?\n      var innerWidth = thickPx + opts.outlinewidth / 2 + Drawing.bBox(axisLayer.node()).width;\n      titleEl = titleCont.select('text');\n      if (titleEl.node() && !titleEl.classed(cn.jsPlaceholder)) {\n        var mathJaxNode = titleCont.select('.h' + cbAxisOut._id + 'title-math-group').node();\n        var titleWidth;\n        if (mathJaxNode && ['top', 'bottom'].indexOf(opts.title.side) !== -1) {\n          titleWidth = Drawing.bBox(mathJaxNode).width;\n        } else {\n          // note: the formula below works for all title sides,\n          // (except for top/bottom mathjax, above)\n          // but the weird gs.l is because the titleunshift\n          // transform gets removed by Drawing.bBox\n          titleWidth = Drawing.bBox(titleCont.node()).right - xLeft - gs.l;\n        }\n        innerWidth = Math.max(innerWidth, titleWidth);\n      }\n      var outerwidth = 2 * opts.xpad + innerWidth + opts.borderwidth + opts.outlinewidth / 2;\n      var outerheight = yBottomPx - yTopPx;\n      container.select('.cbbg').attr({\n        x: xLeft - opts.xpad - (opts.borderwidth + opts.outlinewidth) / 2,\n        y: yTopPx - yExtraPx,\n        width: Math.max(outerwidth, 2),\n        height: Math.max(outerheight + 2 * yExtraPx, 2)\n      }).call(Color.fill, opts.bgcolor).call(Color.stroke, opts.bordercolor).style({\n        'stroke-width': opts.borderwidth\n      });\n      container.selectAll('.cboutline').attr({\n        x: xLeft,\n        y: yTopPx + opts.ypad + (opts.title.side === 'top' ? titleHeight : 0),\n        width: Math.max(thickPx, 2),\n        height: Math.max(outerheight - 2 * opts.ypad - titleHeight, 2)\n      }).call(Color.stroke, opts.outlinecolor).style({\n        fill: 'None',\n        'stroke-width': opts.outlinewidth\n      });\n\n      // fix positioning for xanchor!='left'\n      var xoffset = ({\n        center: 0.5,\n        right: 1\n      }[opts.xanchor] || 0) * outerwidth;\n      container.attr('transform', 'translate(' + (gs.l - xoffset) + ',' + gs.t + ')');\n\n      // auto margin adjustment\n      var marginOpts = {};\n      var tFrac = FROM_TL[opts.yanchor];\n      var bFrac = FROM_BR[opts.yanchor];\n      if (opts.lenmode === 'pixels') {\n        marginOpts.y = opts.y;\n        marginOpts.t = outerheight * tFrac;\n        marginOpts.b = outerheight * bFrac;\n      } else {\n        marginOpts.t = marginOpts.b = 0;\n        marginOpts.yt = opts.y + opts.len * tFrac;\n        marginOpts.yb = opts.y - opts.len * bFrac;\n      }\n      var lFrac = FROM_TL[opts.xanchor];\n      var rFrac = FROM_BR[opts.xanchor];\n      if (opts.thicknessmode === 'pixels') {\n        marginOpts.x = opts.x;\n        marginOpts.l = outerwidth * lFrac;\n        marginOpts.r = outerwidth * rFrac;\n      } else {\n        var extraThickness = outerwidth - thickPx;\n        marginOpts.l = extraThickness * lFrac;\n        marginOpts.r = extraThickness * rFrac;\n        marginOpts.xl = opts.x - opts.thickness * lFrac;\n        marginOpts.xr = opts.x + opts.thickness * rFrac;\n      }\n      Plots.autoMargin(gd, id, marginOpts);\n    }\n    var cbDone = Lib.syncOrAsync([Plots.previousPromises, drawAxis, Plots.previousPromises, positionCB], gd);\n    if (cbDone && cbDone.then) (gd._promises || []).push(cbDone);\n\n    // dragging...\n    if (gd._context.edits.colorbarPosition) {\n      var t0, xf, yf;\n      dragElement.init({\n        element: container.node(),\n        gd: gd,\n        prepFn: function prepFn() {\n          t0 = container.attr('transform');\n          setCursor(container);\n        },\n        moveFn: function moveFn(dx, dy) {\n          container.attr('transform', t0 + ' ' + 'translate(' + dx + ',' + dy + ')');\n          xf = dragElement.align(xLeftFrac + dx / gs.w, thickFrac, 0, 1, opts.xanchor);\n          yf = dragElement.align(yBottomFrac - dy / gs.h, lenFrac, 0, 1, opts.yanchor);\n          var csr = dragElement.getCursor(xf, yf, opts.xanchor, opts.yanchor);\n          setCursor(container, csr);\n        },\n        doneFn: function doneFn() {\n          setCursor(container);\n          if (xf !== undefined && yf !== undefined) {\n            var update = {};\n            update[getPropName('x')] = xf;\n            update[getPropName('y')] = yf;\n            Registry.call('_guiRestyle', gd, update, getTrace().index);\n          }\n        }\n      });\n    }\n    return cbDone;\n  }\n  function getTrace() {\n    var idNum = id.substr(2);\n    for (var i = 0; i < gd._fullData.length; i++) {\n      var trace = gd._fullData[i];\n      if (trace.uid === idNum) return trace;\n    }\n  }\n  function getPropName(suffix) {\n    var trace = getTrace();\n    var propName = 'colorbar.';\n    var containerName = trace._module.colorbar.container;\n    if (containerName) propName = containerName + '.' + propName;\n    return propName + suffix;\n  }\n\n  // setter/getters for every item defined in opts\n  Object.keys(opts).forEach(function (name) {\n    component[name] = function (v) {\n      // getter\n      if (!arguments.length) return opts[name];\n\n      // setter - for multi-part properties,\n      // set only the parts that are provided\n      opts[name] = Lib.isPlainObject(opts[name]) ? Lib.extendFlat(opts[name], v) : v;\n      return component;\n    };\n  });\n\n  // or use .options to set multiple options at once via a dictionary\n  component.options = function (o) {\n    for (var name in o) {\n      // in case something random comes through\n      // that's not an option, ignore it\n      if (typeof component[name] === 'function') {\n        component[name](o[name]);\n      }\n    }\n    return component;\n  };\n  component._opts = opts;\n  return component;\n};","map":{"version":3,"names":["d3","require","tinycolor","Plots","Registry","Axes","dragElement","Lib","extendFlat","setCursor","Drawing","Color","Titles","svgTextUtils","alignmentConstants","LINE_SPACING","FROM_TL","FROM_BR","handleAxisDefaults","handleAxisPositionDefaults","axisLayoutAttrs","attributes","cn","module","exports","draw","gd","id","opts","k","fillcolor","line","color","width","dash","levels","start","end","size","filllevels","fillgradient","zrange","component","fullLayout","_fullLayout","gs","_size","_infolayer","selectAll","remove","extent","domain","linelevels","linecolormap","fillcolormap","l","i","l0","ls","zr0","zr1","push","map","v","length","reverse","plotHeight","h","plotWidth","w","thickPx","Math","round","thickness","thicknessmode","thickFrac","lenPx","len","lenmode","lenFrac","xpadFrac","xpad","yExtraPx","borderwidth","outlinewidth","ypadFrac","ypad","xLeft","x","xLeftFrac","middle","right","xanchor","yBottomFrac","y","top","bottom","yanchor","yBottomPx","yTopPx","titleEl","cbAxisIn","type","range","tickmode","nticks","tick0","dtick","tickvals","ticktext","ticks","ticklen","tickwidth","tickcolor","showticklabels","tickfont","tickangle","tickformat","exponentformat","separatethousands","showexponent","showtickprefix","tickprefix","showticksuffix","ticksuffix","title","showline","anchor","side","position","cbAxisOut","_id","axisOptions","letter","font","noHover","noTickson","calendar","coerce","attr","dflt","axis","indexOf","titlex","titley","autoNtick","constrain","dtFactor","dtexp","pow","floor","log","LN10","roundUp","abs","setScale","container","ensureSingle","s","classed","colorbar","each","select","append","cbbg","cbfills","cblines","cbaxis","crisp","cbtitleunshift","cbtitle","cboutline","datum","t","titleCont","axisLayer","titleHeight","fontSize","drawTitle","drawAxis","titleGroup","titleText","titleTrans","mathJaxNode","node","lineSize","parseInt","style","bBox","height","jsPlaceholder","nlines","lineCount","fills","data","enter","cbfill","exit","zBounds","c2p","sort","a","b","d","z","fillEl","max","min","gradient","colorString","replace","toHexString","lines","cbline","call","lineGroupStyle","syncOrAsync","shift","vals","calcTicks","transFn","makeTransFn","labelFns","makeLabelFns","tickSign","getTickSigns","drawTicks","clipEnds","layer","path","makeTickPath","drawLabels","labelXFn","labelYFn","labelAnchorFn","_offset","_length","avoid","selection","offsetLeft","offsetTop","maxShift","transform","rotate","offset","titleClass","titleOpts","dfltTitleOpts","propContainer","propName","getPropName","traceIndex","getTrace","index","placeholder","_dfltTitle","containerGroup","otherClass","charAt","substr","positionCB","innerWidth","titleWidth","outerwidth","outerheight","fill","bgcolor","stroke","bordercolor","outlinecolor","xoffset","center","marginOpts","tFrac","bFrac","yt","yb","lFrac","rFrac","r","extraThickness","xl","xr","autoMargin","cbDone","previousPromises","then","_promises","_context","edits","colorbarPosition","t0","xf","yf","init","element","prepFn","moveFn","dx","dy","align","csr","getCursor","doneFn","undefined","update","idNum","_fullData","trace","uid","suffix","containerName","_module","Object","keys","forEach","name","arguments","isPlainObject","options","o","_opts"],"sources":["/home/yasmin/Ãrea de Trabalho/Frontend/node_modules/plotly.js/src/components/colorbar/draw.js"],"sourcesContent":["/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n\n'use strict';\n\nvar d3 = require('d3');\nvar tinycolor = require('tinycolor2');\n\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\nvar dragElement = require('../dragelement');\nvar Lib = require('../../lib');\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar setCursor = require('../../lib/setcursor');\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar Titles = require('../titles');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar alignmentConstants = require('../../constants/alignment');\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nvar handleAxisDefaults = require('../../plots/cartesian/axis_defaults');\nvar handleAxisPositionDefaults = require('../../plots/cartesian/position_defaults');\nvar axisLayoutAttrs = require('../../plots/cartesian/layout_attributes');\n\nvar attributes = require('./attributes');\nvar cn = require('./constants').cn;\n\nmodule.exports = function draw(gd, id) {\n    // opts: options object, containing everything from attributes\n    // plus a few others that are the equivalent of the colorbar \"data\"\n    var opts = {};\n    for(var k in attributes) {\n        opts[k] = null;\n    }\n    // fillcolor can be a d3 scale, domain is z values, range is colors\n    // or leave it out for no fill,\n    // or set to a string constant for single-color fill\n    opts.fillcolor = null;\n    // line.color has the same options as fillcolor\n    opts.line = {color: null, width: null, dash: null};\n    // levels of lines to draw.\n    // note that this DOES NOT determine the extent of the bar\n    // that's given by the domain of fillcolor\n    // (or line.color if no fillcolor domain)\n    opts.levels = {start: null, end: null, size: null};\n    // separate fill levels (for example, heatmap coloring of a\n    // contour map) if this is omitted, fillcolors will be\n    // evaluated halfway between levels\n    opts.filllevels = null;\n    // for continuous colorscales: fill with a gradient instead of explicit levels\n    // value should be the colorscale [[0, c0], [v1, c1], ..., [1, cEnd]]\n    opts.fillgradient = null;\n    // when using a gradient, we need the data range specified separately\n    opts.zrange = null;\n\n    function component() {\n        var fullLayout = gd._fullLayout;\n        var gs = fullLayout._size;\n        if((typeof opts.fillcolor !== 'function') &&\n                (typeof opts.line.color !== 'function') &&\n                !opts.fillgradient) {\n            fullLayout._infolayer.selectAll('g.' + id).remove();\n            return;\n        }\n        var zrange = opts.zrange || (d3.extent(((typeof opts.fillcolor === 'function') ?\n            opts.fillcolor : opts.line.color).domain()));\n        var linelevels = [];\n        var filllevels = [];\n        var linecolormap = typeof opts.line.color === 'function' ?\n            opts.line.color : function() { return opts.line.color; };\n        var fillcolormap = typeof opts.fillcolor === 'function' ?\n            opts.fillcolor : function() { return opts.fillcolor; };\n        var l;\n        var i;\n\n        var l0 = opts.levels.end + opts.levels.size / 100;\n        var ls = opts.levels.size;\n        var zr0 = (1.001 * zrange[0] - 0.001 * zrange[1]);\n        var zr1 = (1.001 * zrange[1] - 0.001 * zrange[0]);\n        for(i = 0; i < 1e5; i++) {\n            l = opts.levels.start + i * ls;\n            if(ls > 0 ? (l >= l0) : (l <= l0)) break;\n            if(l > zr0 && l < zr1) linelevels.push(l);\n        }\n\n        if(opts.fillgradient) {\n            filllevels = [0];\n        }\n        else if(typeof opts.fillcolor === 'function') {\n            if(opts.filllevels) {\n                l0 = opts.filllevels.end + opts.filllevels.size / 100;\n                ls = opts.filllevels.size;\n                for(i = 0; i < 1e5; i++) {\n                    l = opts.filllevels.start + i * ls;\n                    if(ls > 0 ? (l >= l0) : (l <= l0)) break;\n                    if(l > zrange[0] && l < zrange[1]) filllevels.push(l);\n                }\n            }\n            else {\n                filllevels = linelevels.map(function(v) {\n                    return v - opts.levels.size / 2;\n                });\n                filllevels.push(filllevels[filllevels.length - 1] +\n                    opts.levels.size);\n            }\n        }\n        else if(opts.fillcolor && typeof opts.fillcolor === 'string') {\n            // doesn't matter what this value is, with a single value\n            // we'll make a single fill rect covering the whole bar\n            filllevels = [0];\n        }\n\n        if(opts.levels.size < 0) {\n            linelevels.reverse();\n            filllevels.reverse();\n        }\n\n        // now make a Plotly Axes object to scale with and draw ticks\n        // TODO: does not support orientation other than right\n\n        // we calculate pixel sizes based on the specified graph size,\n        // not the actual (in case something pushed the margins around)\n        // which is a little odd but avoids an odd iterative effect\n        // when the colorbar itself is pushing the margins.\n        // but then the fractional size is calculated based on the\n        // actual graph size, so that the axes will size correctly.\n        var plotHeight = gs.h;\n        var plotWidth = gs.w;\n        var thickPx = Math.round(opts.thickness * (opts.thicknessmode === 'fraction' ? plotWidth : 1));\n        var thickFrac = thickPx / gs.w;\n        var lenPx = Math.round(opts.len * (opts.lenmode === 'fraction' ? plotHeight : 1));\n        var lenFrac = lenPx / gs.h;\n        var xpadFrac = opts.xpad / gs.w;\n        var yExtraPx = (opts.borderwidth + opts.outlinewidth) / 2;\n        var ypadFrac = opts.ypad / gs.h;\n\n        // x positioning: do it initially just for left anchor,\n        // then fix at the end (since we don't know the width yet)\n        var xLeft = Math.round(opts.x * gs.w + opts.xpad);\n        // for dragging... this is getting a little muddled...\n        var xLeftFrac = opts.x - thickFrac * ({middle: 0.5, right: 1}[opts.xanchor]||0);\n\n        // y positioning we can do correctly from the start\n        var yBottomFrac = opts.y + lenFrac * (({top: -0.5, bottom: 0.5}[opts.yanchor] || 0) - 0.5);\n        var yBottomPx = Math.round(gs.h * (1 - yBottomFrac));\n        var yTopPx = yBottomPx - lenPx;\n\n        var titleEl;\n\n        var cbAxisIn = {\n            type: 'linear',\n            range: zrange,\n            tickmode: opts.tickmode,\n            nticks: opts.nticks,\n            tick0: opts.tick0,\n            dtick: opts.dtick,\n            tickvals: opts.tickvals,\n            ticktext: opts.ticktext,\n            ticks: opts.ticks,\n            ticklen: opts.ticklen,\n            tickwidth: opts.tickwidth,\n            tickcolor: opts.tickcolor,\n            showticklabels: opts.showticklabels,\n            tickfont: opts.tickfont,\n            tickangle: opts.tickangle,\n            tickformat: opts.tickformat,\n            exponentformat: opts.exponentformat,\n            separatethousands: opts.separatethousands,\n            showexponent: opts.showexponent,\n            showtickprefix: opts.showtickprefix,\n            tickprefix: opts.tickprefix,\n            showticksuffix: opts.showticksuffix,\n            ticksuffix: opts.ticksuffix,\n            title: opts.title,\n            showline: true,\n            anchor: 'free',\n            side: 'right',\n            position: 1\n        };\n        var cbAxisOut = {\n            type: 'linear',\n            _id: 'y' + id\n        };\n        var axisOptions = {\n            letter: 'y',\n            font: fullLayout.font,\n            noHover: true,\n            noTickson: true,\n            calendar: fullLayout.calendar  // not really necessary (yet?)\n        };\n\n        // Coerce w.r.t. Axes layoutAttributes:\n        // re-use axes.js logic without updating _fullData\n        function coerce(attr, dflt) {\n            return Lib.coerce(cbAxisIn, cbAxisOut, axisLayoutAttrs, attr, dflt);\n        }\n\n        // Prepare the Plotly axis object\n        handleAxisDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions, fullLayout);\n        handleAxisPositionDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions);\n\n        // position can't go in through supplyDefaults\n        // because that restricts it to [0,1]\n        cbAxisOut.position = opts.x + xpadFrac + thickFrac;\n\n        // save for other callers to access this axis\n        component.axis = cbAxisOut;\n\n        if(['top', 'bottom'].indexOf(opts.title.side) !== -1) {\n            cbAxisOut.title.side = opts.title.side;\n            cbAxisOut.titlex = opts.x + xpadFrac;\n            cbAxisOut.titley = yBottomFrac +\n                (opts.title.side === 'top' ? lenFrac - ypadFrac : ypadFrac);\n        }\n\n        if(opts.line.color && opts.tickmode === 'auto') {\n            cbAxisOut.tickmode = 'linear';\n            cbAxisOut.tick0 = opts.levels.start;\n            var dtick = opts.levels.size;\n            // expand if too many contours, so we don't get too many ticks\n            var autoNtick = Lib.constrain((yBottomPx - yTopPx) / 50, 4, 15) + 1;\n            var dtFactor = (zrange[1] - zrange[0]) / ((opts.nticks || autoNtick) * dtick);\n            if(dtFactor > 1) {\n                var dtexp = Math.pow(10, Math.floor(\n                    Math.log(dtFactor) / Math.LN10));\n                dtick *= dtexp * Lib.roundUp(dtFactor / dtexp, [2, 5, 10]);\n                // if the contours are at round multiples, reset tick0\n                // so they're still at round multiples. Otherwise,\n                // keep the first label on the first contour level\n                if((Math.abs(opts.levels.start) /\n                        opts.levels.size + 1e-6) % 1 < 2e-6) {\n                    cbAxisOut.tick0 = 0;\n                }\n            }\n            cbAxisOut.dtick = dtick;\n        }\n\n        // set domain after init, because we may want to\n        // allow it outside [0,1]\n        cbAxisOut.domain = [\n            yBottomFrac + ypadFrac,\n            yBottomFrac + lenFrac - ypadFrac\n        ];\n        cbAxisOut.setScale();\n\n        // now draw the elements\n        var container = Lib.ensureSingle(fullLayout._infolayer, 'g', id, function(s) {\n            s.classed(cn.colorbar, true)\n                .each(function() {\n                    var s = d3.select(this);\n                    s.append('rect').classed(cn.cbbg, true);\n                    s.append('g').classed(cn.cbfills, true);\n                    s.append('g').classed(cn.cblines, true);\n                    s.append('g').classed(cn.cbaxis, true).classed(cn.crisp, true);\n                    s.append('g').classed(cn.cbtitleunshift, true)\n                        .append('g').classed(cn.cbtitle, true);\n                    s.append('rect').classed(cn.cboutline, true);\n                    s.select('.cbtitle').datum(0);\n                });\n        });\n\n        container.attr('transform', 'translate(' + Math.round(gs.l) +\n            ',' + Math.round(gs.t) + ')');\n        // TODO: this opposite transform is a hack until we make it\n        // more rational which items get this offset\n        var titleCont = container.select('.cbtitleunshift')\n            .attr('transform', 'translate(-' +\n                Math.round(gs.l) + ',-' +\n                Math.round(gs.t) + ')');\n\n        var axisLayer = container.select('.cbaxis');\n\n        var titleHeight = 0;\n        if(['top', 'bottom'].indexOf(opts.title.side) !== -1) {\n            // draw the title so we know how much room it needs\n            // when we squish the axis. This one only applies to\n            // top or bottom titles, not right side.\n            var x = gs.l + (opts.x + xpadFrac) * gs.w;\n            var fontSize = cbAxisOut.title.font.size;\n            var y;\n\n            if(opts.title.side === 'top') {\n                y = (1 - (yBottomFrac + lenFrac - ypadFrac)) * gs.h +\n                    gs.t + 3 + fontSize * 0.75;\n            }\n            else {\n                y = (1 - (yBottomFrac + ypadFrac)) * gs.h +\n                    gs.t - 3 - fontSize * 0.25;\n            }\n            drawTitle(cbAxisOut._id + 'title', {\n                attributes: {x: x, y: y, 'text-anchor': 'start'}\n            });\n        }\n\n        function drawAxis() {\n            if(['top', 'bottom'].indexOf(opts.title.side) !== -1) {\n                // squish the axis top to make room for the title\n                var titleGroup = container.select('.cbtitle');\n                var titleText = titleGroup.select('text');\n                var titleTrans = [-opts.outlinewidth / 2, opts.outlinewidth / 2];\n                var mathJaxNode = titleGroup\n                    .select('.h' + cbAxisOut._id + 'title-math-group')\n                    .node();\n                var lineSize = 15.6;\n                if(titleText.node()) {\n                    lineSize =\n                        parseInt(titleText.node().style.fontSize, 10) * LINE_SPACING;\n                }\n                if(mathJaxNode) {\n                    titleHeight = Drawing.bBox(mathJaxNode).height;\n                    if(titleHeight > lineSize) {\n                        // not entirely sure how mathjax is doing\n                        // vertical alignment, but this seems to work.\n                        titleTrans[1] -= (titleHeight - lineSize) / 2;\n                    }\n                }\n                else if(titleText.node() &&\n                        !titleText.classed(cn.jsPlaceholder)) {\n                    titleHeight = Drawing.bBox(titleText.node()).height;\n                }\n                if(titleHeight) {\n                    // buffer btwn colorbar and title\n                    // TODO: configurable\n                    titleHeight += 5;\n\n                    if(opts.title.side === 'top') {\n                        cbAxisOut.domain[1] -= titleHeight / gs.h;\n                        titleTrans[1] *= -1;\n                    }\n                    else {\n                        cbAxisOut.domain[0] += titleHeight / gs.h;\n                        var nlines = svgTextUtils.lineCount(titleText);\n                        titleTrans[1] += (1 - nlines) * lineSize;\n                    }\n\n                    titleGroup.attr('transform',\n                        'translate(' + titleTrans + ')');\n\n                    cbAxisOut.setScale();\n                }\n            }\n\n            container.selectAll('.cbfills,.cblines')\n                .attr('transform', 'translate(0,' +\n                    Math.round(gs.h * (1 - cbAxisOut.domain[1])) + ')');\n\n            axisLayer.attr('transform', 'translate(0,' + Math.round(-gs.t) + ')');\n\n            var fills = container.select('.cbfills')\n                .selectAll('rect.cbfill')\n                    .data(filllevels);\n            fills.enter().append('rect')\n                .classed(cn.cbfill, true)\n                .style('stroke', 'none');\n            fills.exit().remove();\n\n            var zBounds = zrange\n                .map(cbAxisOut.c2p)\n                .map(Math.round)\n                .sort(function(a, b) { return a - b; });\n\n            fills.each(function(d, i) {\n                var z = [\n                    (i === 0) ? zrange[0] :\n                        (filllevels[i] + filllevels[i - 1]) / 2,\n                    (i === filllevels.length - 1) ? zrange[1] :\n                        (filllevels[i] + filllevels[i + 1]) / 2\n                ]\n                .map(cbAxisOut.c2p)\n                .map(Math.round);\n\n                // offset the side adjoining the next rectangle so they\n                // overlap, to prevent antialiasing gaps\n                z[1] = Lib.constrain(z[1] + (z[1] > z[0]) ? 1 : -1, zBounds[0], zBounds[1]);\n\n                // Colorbar cannot currently support opacities so we\n                // use an opaque fill even when alpha channels present\n                var fillEl = d3.select(this).attr({\n                    x: xLeft,\n                    width: Math.max(thickPx, 2),\n                    y: d3.min(z),\n                    height: Math.max(d3.max(z) - d3.min(z), 2),\n                });\n\n                if(opts.fillgradient) {\n                    Drawing.gradient(fillEl, gd, id, 'vertical',\n                        opts.fillgradient, 'fill');\n                }\n                else {\n                    // Tinycolor can't handle exponents and\n                    // at this scale, removing it makes no difference.\n                    var colorString = fillcolormap(d).replace('e-', '');\n                    fillEl.attr('fill', tinycolor(colorString).toHexString());\n                }\n            });\n\n            var lines = container.select('.cblines')\n                .selectAll('path.cbline')\n                    .data(opts.line.color && opts.line.width ?\n                        linelevels : []);\n            lines.enter().append('path')\n                .classed(cn.cbline, true);\n            lines.exit().remove();\n            lines.each(function(d) {\n                d3.select(this)\n                    .attr('d', 'M' + xLeft + ',' +\n                        (Math.round(cbAxisOut.c2p(d)) + (opts.line.width / 2) % 1) +\n                        'h' + thickPx)\n                    .call(Drawing.lineGroupStyle,\n                        opts.line.width, linecolormap(d), opts.line.dash);\n            });\n\n            // force full redraw of labels and ticks\n            axisLayer.selectAll('g.' + cbAxisOut._id + 'tick,path').remove();\n\n            // separate out axis and title drawing,\n            // so we don't need such complicated logic in Titles.draw\n            // if title is on the top or bottom, we've already drawn it\n            // this title call only handles side=right\n            return Lib.syncOrAsync([\n                function() {\n                    var shift = xLeft + thickPx +\n                        (opts.outlinewidth || 0) / 2 - (opts.ticks === 'outside' ? 1 : 0);\n\n                    var vals = Axes.calcTicks(cbAxisOut);\n                    var transFn = Axes.makeTransFn(cbAxisOut);\n                    var labelFns = Axes.makeLabelFns(cbAxisOut, shift);\n                    var tickSign = Axes.getTickSigns(cbAxisOut)[2];\n\n                    Axes.drawTicks(gd, cbAxisOut, {\n                        vals: cbAxisOut.ticks === 'inside' ? Axes.clipEnds(cbAxisOut, vals) : vals,\n                        layer: axisLayer,\n                        path: Axes.makeTickPath(cbAxisOut, shift, tickSign),\n                        transFn: transFn\n                    });\n\n                    return Axes.drawLabels(gd, cbAxisOut, {\n                        vals: vals,\n                        layer: axisLayer,\n                        transFn: transFn,\n                        labelXFn: labelFns.labelXFn,\n                        labelYFn: labelFns.labelYFn,\n                        labelAnchorFn: labelFns.labelAnchorFn\n                    });\n                },\n                function() {\n                    if(['top', 'bottom'].indexOf(opts.title.side) === -1) {\n                        var fontSize = cbAxisOut.title.font.size;\n                        var y = cbAxisOut._offset + cbAxisOut._length / 2;\n                        var x = gs.l + (cbAxisOut.position || 0) * gs.w + ((cbAxisOut.side === 'right') ?\n                            10 + fontSize * ((cbAxisOut.showticklabels ? 1 : 0.5)) :\n                            -10 - fontSize * ((cbAxisOut.showticklabels ? 0.5 : 0)));\n\n                        // the 'h' + is a hack to get around the fact that\n                        // convertToTspans rotates any 'y...' class by 90 degrees.\n                        // TODO: find a better way to control this.\n                        drawTitle('h' + cbAxisOut._id + 'title', {\n                            avoid: {\n                                selection: d3.select(gd).selectAll('g.' + cbAxisOut._id + 'tick'),\n                                side: opts.title.side,\n                                offsetLeft: gs.l,\n                                offsetTop: 0,\n                                maxShift: fullLayout.width\n                            },\n                            attributes: {x: x, y: y, 'text-anchor': 'middle'},\n                            transform: {rotate: '-90', offset: 0}\n                        });\n                    }\n                }]);\n        }\n\n        function drawTitle(titleClass, titleOpts) {\n            var dfltTitleOpts = {\n                propContainer: cbAxisOut,\n                propName: getPropName('title'),\n                traceIndex: getTrace().index,\n                placeholder: fullLayout._dfltTitle.colorbar,\n                containerGroup: container.select('.cbtitle')\n            };\n\n            // this class-to-rotate thing with convertToTspans is\n            // getting hackier and hackier... delete groups with the\n            // wrong class (in case earlier the colorbar was drawn on\n            // a different side, I think?)\n            var otherClass = titleClass.charAt(0) === 'h' ?\n                titleClass.substr(1) : ('h' + titleClass);\n            container.selectAll('.' + otherClass + ',.' + otherClass + '-math-group')\n                .remove();\n\n            Titles.draw(gd, titleClass,\n                extendFlat(dfltTitleOpts, titleOpts || {}));\n        }\n\n        function positionCB() {\n            // wait for the axis & title to finish rendering before\n            // continuing positioning\n            // TODO: why are we redrawing multiple times now with this?\n            // I guess autoMargin doesn't like being post-promise?\n            var innerWidth = thickPx + opts.outlinewidth / 2 +\n                    Drawing.bBox(axisLayer.node()).width;\n            titleEl = titleCont.select('text');\n            if(titleEl.node() && !titleEl.classed(cn.jsPlaceholder)) {\n                var mathJaxNode = titleCont\n                        .select('.h' + cbAxisOut._id + 'title-math-group')\n                        .node();\n                var titleWidth;\n                if(mathJaxNode &&\n                        ['top', 'bottom'].indexOf(opts.title.side) !== -1) {\n                    titleWidth = Drawing.bBox(mathJaxNode).width;\n                }\n                else {\n                    // note: the formula below works for all title sides,\n                    // (except for top/bottom mathjax, above)\n                    // but the weird gs.l is because the titleunshift\n                    // transform gets removed by Drawing.bBox\n                    titleWidth =\n                        Drawing.bBox(titleCont.node()).right -\n                        xLeft - gs.l;\n                }\n                innerWidth = Math.max(innerWidth, titleWidth);\n            }\n\n            var outerwidth = 2 * opts.xpad + innerWidth +\n                    opts.borderwidth + opts.outlinewidth / 2;\n            var outerheight = yBottomPx - yTopPx;\n\n            container.select('.cbbg').attr({\n                x: xLeft - opts.xpad -\n                    (opts.borderwidth + opts.outlinewidth) / 2,\n                y: yTopPx - yExtraPx,\n                width: Math.max(outerwidth, 2),\n                height: Math.max(outerheight + 2 * yExtraPx, 2)\n            })\n            .call(Color.fill, opts.bgcolor)\n            .call(Color.stroke, opts.bordercolor)\n            .style({'stroke-width': opts.borderwidth});\n\n            container.selectAll('.cboutline').attr({\n                x: xLeft,\n                y: yTopPx + opts.ypad +\n                    (opts.title.side === 'top' ? titleHeight : 0),\n                width: Math.max(thickPx, 2),\n                height: Math.max(outerheight - 2 * opts.ypad - titleHeight, 2)\n            })\n            .call(Color.stroke, opts.outlinecolor)\n            .style({\n                fill: 'None',\n                'stroke-width': opts.outlinewidth\n            });\n\n            // fix positioning for xanchor!='left'\n            var xoffset = ({center: 0.5, right: 1}[opts.xanchor] || 0) *\n                outerwidth;\n            container.attr('transform',\n                'translate(' + (gs.l - xoffset) + ',' + gs.t + ')');\n\n            // auto margin adjustment\n            var marginOpts = {};\n            var tFrac = FROM_TL[opts.yanchor];\n            var bFrac = FROM_BR[opts.yanchor];\n            if(opts.lenmode === 'pixels') {\n                marginOpts.y = opts.y;\n                marginOpts.t = outerheight * tFrac;\n                marginOpts.b = outerheight * bFrac;\n            }\n            else {\n                marginOpts.t = marginOpts.b = 0;\n                marginOpts.yt = opts.y + opts.len * tFrac;\n                marginOpts.yb = opts.y - opts.len * bFrac;\n            }\n\n            var lFrac = FROM_TL[opts.xanchor];\n            var rFrac = FROM_BR[opts.xanchor];\n            if(opts.thicknessmode === 'pixels') {\n                marginOpts.x = opts.x;\n                marginOpts.l = outerwidth * lFrac;\n                marginOpts.r = outerwidth * rFrac;\n            }\n            else {\n                var extraThickness = outerwidth - thickPx;\n                marginOpts.l = extraThickness * lFrac;\n                marginOpts.r = extraThickness * rFrac;\n                marginOpts.xl = opts.x - opts.thickness * lFrac;\n                marginOpts.xr = opts.x + opts.thickness * rFrac;\n            }\n            Plots.autoMargin(gd, id, marginOpts);\n        }\n\n        var cbDone = Lib.syncOrAsync([\n            Plots.previousPromises,\n            drawAxis,\n            Plots.previousPromises,\n            positionCB\n        ], gd);\n\n        if(cbDone && cbDone.then) (gd._promises || []).push(cbDone);\n\n        // dragging...\n        if(gd._context.edits.colorbarPosition) {\n            var t0,\n                xf,\n                yf;\n\n            dragElement.init({\n                element: container.node(),\n                gd: gd,\n                prepFn: function() {\n                    t0 = container.attr('transform');\n                    setCursor(container);\n                },\n                moveFn: function(dx, dy) {\n                    container.attr('transform',\n                        t0 + ' ' + 'translate(' + dx + ',' + dy + ')');\n\n                    xf = dragElement.align(xLeftFrac + (dx / gs.w), thickFrac,\n                        0, 1, opts.xanchor);\n                    yf = dragElement.align(yBottomFrac - (dy / gs.h), lenFrac,\n                        0, 1, opts.yanchor);\n\n                    var csr = dragElement.getCursor(xf, yf,\n                        opts.xanchor, opts.yanchor);\n                    setCursor(container, csr);\n                },\n                doneFn: function() {\n                    setCursor(container);\n\n                    if(xf !== undefined && yf !== undefined) {\n                        var update = {};\n                        update[getPropName('x')] = xf;\n                        update[getPropName('y')] = yf;\n                        Registry.call('_guiRestyle', gd, update, getTrace().index);\n                    }\n                }\n            });\n        }\n        return cbDone;\n    }\n\n    function getTrace() {\n        var idNum = id.substr(2);\n        for(var i = 0; i < gd._fullData.length; i++) {\n            var trace = gd._fullData[i];\n            if(trace.uid === idNum) return trace;\n        }\n    }\n\n    function getPropName(suffix) {\n        var trace = getTrace();\n        var propName = 'colorbar.';\n        var containerName = trace._module.colorbar.container;\n        if(containerName) propName = containerName + '.' + propName;\n        return propName + suffix;\n    }\n\n    // setter/getters for every item defined in opts\n    Object.keys(opts).forEach(function(name) {\n        component[name] = function(v) {\n            // getter\n            if(!arguments.length) return opts[name];\n\n            // setter - for multi-part properties,\n            // set only the parts that are provided\n            opts[name] = Lib.isPlainObject(opts[name]) ?\n                 Lib.extendFlat(opts[name], v) :\n                 v;\n\n            return component;\n        };\n    });\n\n    // or use .options to set multiple options at once via a dictionary\n    component.options = function(o) {\n        for(var name in o) {\n            // in case something random comes through\n            // that's not an option, ignore it\n            if(typeof component[name] === 'function') {\n                component[name](o[name]);\n            }\n        }\n        return component;\n    };\n\n    component._opts = opts;\n\n    return component;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}