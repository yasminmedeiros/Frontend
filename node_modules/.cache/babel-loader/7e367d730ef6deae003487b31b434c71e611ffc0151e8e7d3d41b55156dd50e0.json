{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\nvar Fx = require('../../components/fx');\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\nvar Lib = require('../../lib');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar helpers = require('./helpers');\nvar eventData = require('./event_data');\nmodule.exports = function plot(gd, cdpie) {\n  var fullLayout = gd._fullLayout;\n  prerenderTitles(cdpie, gd);\n  scalePies(cdpie, fullLayout._size);\n  var pieGroups = Lib.makeTraceGroups(fullLayout._pielayer, cdpie, 'trace').each(function (cd) {\n    var pieGroup = d3.select(this);\n    var cd0 = cd[0];\n    var trace = cd0.trace;\n    setCoords(cd);\n\n    // TODO: miter might look better but can sometimes cause problems\n    // maybe miter with a small-ish stroke-miterlimit?\n    pieGroup.attr('stroke-linejoin', 'round');\n    pieGroup.each(function () {\n      var slices = d3.select(this).selectAll('g.slice').data(cd);\n      slices.enter().append('g').classed('slice', true);\n      slices.exit().remove();\n      var quadrants = [[[], []],\n      // y<0: x<0, x>=0\n      [[], []] // y>=0: x<0, x>=0\n      ];\n\n      var hasOutsideText = false;\n      slices.each(function (pt) {\n        if (pt.hidden) {\n          d3.select(this).selectAll('path,g').remove();\n          return;\n        }\n\n        // to have consistent event data compared to other traces\n        pt.pointNumber = pt.i;\n        pt.curveNumber = trace.index;\n        quadrants[pt.pxmid[1] < 0 ? 0 : 1][pt.pxmid[0] < 0 ? 0 : 1].push(pt);\n        var cx = cd0.cx;\n        var cy = cd0.cy;\n        var sliceTop = d3.select(this);\n        var slicePath = sliceTop.selectAll('path.surface').data([pt]);\n\n        // hover state vars\n        // have we drawn a hover label, so it should be cleared later\n        var hasHoverLabel = false;\n        // have we emitted a hover event, so later an unhover event should be emitted\n        // note that click events do not depend on this - you can still get them\n        // with hovermode: false or if you were earlier dragging, then clicked\n        // in the same slice that you moused up in\n        var hasHoverEvent = false;\n        function handleMouseOver() {\n          // in case fullLayout or fullData has changed without a replot\n          var fullLayout2 = gd._fullLayout;\n          var trace2 = gd._fullData[trace.index];\n          if (gd._dragging || fullLayout2.hovermode === false) return;\n          var hoverinfo = trace2.hoverinfo;\n          if (Array.isArray(hoverinfo)) {\n            // super hacky: we need to pull out the *first* hoverinfo from\n            // pt.pts, then put it back into an array in a dummy trace\n            // and call castHoverinfo on that.\n            // TODO: do we want to have Fx.castHoverinfo somehow handle this?\n            // it already takes an array for index, for 2D, so this seems tricky.\n            hoverinfo = Fx.castHoverinfo({\n              hoverinfo: [helpers.castOption(hoverinfo, pt.pts)],\n              _module: trace._module\n            }, fullLayout2, 0);\n          }\n          if (hoverinfo === 'all') hoverinfo = 'label+text+value+percent+name';\n\n          // in case we dragged over the pie from another subplot,\n          // or if hover is turned off\n          if (trace2.hovertemplate || hoverinfo !== 'none' && hoverinfo !== 'skip' && hoverinfo) {\n            var rInscribed = getInscribedRadiusFraction(pt, cd0);\n            var hoverCenterX = cx + pt.pxmid[0] * (1 - rInscribed);\n            var hoverCenterY = cy + pt.pxmid[1] * (1 - rInscribed);\n            var separators = fullLayout.separators;\n            var thisText = [];\n            if (hoverinfo && hoverinfo.indexOf('label') !== -1) thisText.push(pt.label);\n            pt.text = helpers.castOption(trace2.hovertext || trace2.text, pt.pts);\n            if (hoverinfo && hoverinfo.indexOf('text') !== -1) {\n              var texti = pt.text;\n              if (texti) thisText.push(texti);\n            }\n            pt.value = pt.v;\n            pt.valueLabel = helpers.formatPieValue(pt.v, separators);\n            if (hoverinfo && hoverinfo.indexOf('value') !== -1) thisText.push(pt.valueLabel);\n            pt.percent = pt.v / cd0.vTotal;\n            pt.percentLabel = helpers.formatPiePercent(pt.percent, separators);\n            if (hoverinfo && hoverinfo.indexOf('percent') !== -1) thisText.push(pt.percentLabel);\n            var hoverLabel = trace.hoverlabel;\n            var hoverFont = hoverLabel.font;\n            Fx.loneHover({\n              x0: hoverCenterX - rInscribed * cd0.r,\n              x1: hoverCenterX + rInscribed * cd0.r,\n              y: hoverCenterY,\n              text: thisText.join('<br>'),\n              name: trace2.hovertemplate || hoverinfo.indexOf('name') !== -1 ? trace2.name : undefined,\n              idealAlign: pt.pxmid[0] < 0 ? 'left' : 'right',\n              color: helpers.castOption(hoverLabel.bgcolor, pt.pts) || pt.color,\n              borderColor: helpers.castOption(hoverLabel.bordercolor, pt.pts),\n              fontFamily: helpers.castOption(hoverFont.family, pt.pts),\n              fontSize: helpers.castOption(hoverFont.size, pt.pts),\n              fontColor: helpers.castOption(hoverFont.color, pt.pts),\n              trace: trace2,\n              hovertemplate: helpers.castOption(trace2.hovertemplate, pt.pts),\n              hovertemplateLabels: pt,\n              eventData: [eventData(pt, trace2)]\n            }, {\n              container: fullLayout2._hoverlayer.node(),\n              outerContainer: fullLayout2._paper.node(),\n              gd: gd\n            });\n            hasHoverLabel = true;\n          }\n          gd.emit('plotly_hover', {\n            points: [eventData(pt, trace2)],\n            event: d3.event\n          });\n          hasHoverEvent = true;\n        }\n        function handleMouseOut(evt) {\n          var fullLayout2 = gd._fullLayout;\n          var trace2 = gd._fullData[trace.index];\n          if (hasHoverEvent) {\n            evt.originalEvent = d3.event;\n            gd.emit('plotly_unhover', {\n              points: [eventData(pt, trace2)],\n              event: d3.event\n            });\n            hasHoverEvent = false;\n          }\n          if (hasHoverLabel) {\n            Fx.loneUnhover(fullLayout2._hoverlayer.node());\n            hasHoverLabel = false;\n          }\n        }\n        function handleClick() {\n          // TODO: this does not support right-click. If we want to support it, we\n          // would likely need to change pie to use dragElement instead of straight\n          // mapbox event binding. Or perhaps better, make a simple wrapper with the\n          // right mousedown, mousemove, and mouseup handlers just for a left/right click\n          // mapbox would use this too.\n          var fullLayout2 = gd._fullLayout;\n          var trace2 = gd._fullData[trace.index];\n          if (gd._dragging || fullLayout2.hovermode === false) return;\n          gd._hoverdata = [eventData(pt, trace2)];\n          Fx.click(gd, d3.event);\n        }\n        slicePath.enter().append('path').classed('surface', true).style({\n          'pointer-events': 'all'\n        });\n        sliceTop.select('path.textline').remove();\n        sliceTop.on('mouseover', handleMouseOver).on('mouseout', handleMouseOut).on('click', handleClick);\n        if (trace.pull) {\n          var pull = +helpers.castOption(trace.pull, pt.pts) || 0;\n          if (pull > 0) {\n            cx += pull * pt.pxmid[0];\n            cy += pull * pt.pxmid[1];\n          }\n        }\n        pt.cxFinal = cx;\n        pt.cyFinal = cy;\n        function arc(start, finish, cw, scale) {\n          return 'a' + scale * cd0.r + ',' + scale * cd0.r + ' 0 ' + pt.largeArc + (cw ? ' 1 ' : ' 0 ') + scale * (finish[0] - start[0]) + ',' + scale * (finish[1] - start[1]);\n        }\n        var hole = trace.hole;\n        if (pt.v === cd0.vTotal) {\n          // 100% fails bcs arc start and end are identical\n          var outerCircle = 'M' + (cx + pt.px0[0]) + ',' + (cy + pt.px0[1]) + arc(pt.px0, pt.pxmid, true, 1) + arc(pt.pxmid, pt.px0, true, 1) + 'Z';\n          if (hole) {\n            slicePath.attr('d', 'M' + (cx + hole * pt.px0[0]) + ',' + (cy + hole * pt.px0[1]) + arc(pt.px0, pt.pxmid, false, hole) + arc(pt.pxmid, pt.px0, false, hole) + 'Z' + outerCircle);\n          } else slicePath.attr('d', outerCircle);\n        } else {\n          var outerArc = arc(pt.px0, pt.px1, true, 1);\n          if (hole) {\n            var rim = 1 - hole;\n            slicePath.attr('d', 'M' + (cx + hole * pt.px1[0]) + ',' + (cy + hole * pt.px1[1]) + arc(pt.px1, pt.px0, false, hole) + 'l' + rim * pt.px0[0] + ',' + rim * pt.px0[1] + outerArc + 'Z');\n          } else {\n            slicePath.attr('d', 'M' + cx + ',' + cy + 'l' + pt.px0[0] + ',' + pt.px0[1] + outerArc + 'Z');\n          }\n        }\n\n        // add text\n        var textPosition = helpers.castOption(trace.textposition, pt.pts);\n        var sliceTextGroup = sliceTop.selectAll('g.slicetext').data(pt.text && textPosition !== 'none' ? [0] : []);\n        sliceTextGroup.enter().append('g').classed('slicetext', true);\n        sliceTextGroup.exit().remove();\n        sliceTextGroup.each(function () {\n          var sliceText = Lib.ensureSingle(d3.select(this), 'text', '', function (s) {\n            // prohibit tex interpretation until we can handle\n            // tex and regular text together\n            s.attr('data-notex', 1);\n          });\n          sliceText.text(pt.text).attr({\n            'class': 'slicetext',\n            transform: '',\n            'text-anchor': 'middle'\n          }).call(Drawing.font, textPosition === 'outside' ? determineOutsideTextFont(trace, pt, gd._fullLayout.font) : determineInsideTextFont(trace, pt, gd._fullLayout.font)).call(svgTextUtils.convertToTspans, gd);\n\n          // position the text relative to the slice\n          var textBB = Drawing.bBox(sliceText.node());\n          var transform;\n          if (textPosition === 'outside') {\n            transform = transformOutsideText(textBB, pt);\n          } else {\n            transform = transformInsideText(textBB, pt, cd0);\n            if (textPosition === 'auto' && transform.scale < 1) {\n              sliceText.call(Drawing.font, trace.outsidetextfont);\n              if (trace.outsidetextfont.family !== trace.insidetextfont.family || trace.outsidetextfont.size !== trace.insidetextfont.size) {\n                textBB = Drawing.bBox(sliceText.node());\n              }\n              transform = transformOutsideText(textBB, pt);\n            }\n          }\n          var translateX = cx + pt.pxmid[0] * transform.rCenter + (transform.x || 0);\n          var translateY = cy + pt.pxmid[1] * transform.rCenter + (transform.y || 0);\n\n          // save some stuff to use later ensure no labels overlap\n          if (transform.outside) {\n            pt.yLabelMin = translateY - textBB.height / 2;\n            pt.yLabelMid = translateY;\n            pt.yLabelMax = translateY + textBB.height / 2;\n            pt.labelExtraX = 0;\n            pt.labelExtraY = 0;\n            hasOutsideText = true;\n          }\n          sliceText.attr('transform', 'translate(' + translateX + ',' + translateY + ')' + (transform.scale < 1 ? 'scale(' + transform.scale + ')' : '') + (transform.rotate ? 'rotate(' + transform.rotate + ')' : '') + 'translate(' + -(textBB.left + textBB.right) / 2 + ',' + -(textBB.top + textBB.bottom) / 2 + ')');\n        });\n      });\n\n      // add the title\n      var titleTextGroup = d3.select(this).selectAll('g.titletext').data(trace.title.text ? [0] : []);\n      titleTextGroup.enter().append('g').classed('titletext', true);\n      titleTextGroup.exit().remove();\n      titleTextGroup.each(function () {\n        var titleText = Lib.ensureSingle(d3.select(this), 'text', '', function (s) {\n          // prohibit tex interpretation as above\n          s.attr('data-notex', 1);\n        });\n        var txt = fullLayout.meta ? Lib.templateString(trace.title.text, {\n          meta: fullLayout.meta\n        }) : trace.title.text;\n        titleText.text(txt).attr({\n          'class': 'titletext',\n          transform: '',\n          'text-anchor': 'middle'\n        }).call(Drawing.font, trace.title.font).call(svgTextUtils.convertToTspans, gd);\n        var transform;\n        if (trace.title.position === 'middle center') {\n          transform = positionTitleInside(cd0);\n        } else {\n          transform = positionTitleOutside(cd0, fullLayout._size);\n        }\n        titleText.attr('transform', 'translate(' + transform.x + ',' + transform.y + ')' + (transform.scale < 1 ? 'scale(' + transform.scale + ')' : '') + 'translate(' + transform.tx + ',' + transform.ty + ')');\n      });\n\n      // now make sure no labels overlap (at least within one pie)\n      if (hasOutsideText) scootLabels(quadrants, trace);\n      slices.each(function (pt) {\n        if (pt.labelExtraX || pt.labelExtraY) {\n          // first move the text to its new location\n          var sliceTop = d3.select(this);\n          var sliceText = sliceTop.select('g.slicetext text');\n          sliceText.attr('transform', 'translate(' + pt.labelExtraX + ',' + pt.labelExtraY + ')' + sliceText.attr('transform'));\n\n          // then add a line to the new location\n          var lineStartX = pt.cxFinal + pt.pxmid[0];\n          var lineStartY = pt.cyFinal + pt.pxmid[1];\n          var textLinePath = 'M' + lineStartX + ',' + lineStartY;\n          var finalX = (pt.yLabelMax - pt.yLabelMin) * (pt.pxmid[0] < 0 ? -1 : 1) / 4;\n          if (pt.labelExtraX) {\n            var yFromX = pt.labelExtraX * pt.pxmid[1] / pt.pxmid[0];\n            var yNet = pt.yLabelMid + pt.labelExtraY - (pt.cyFinal + pt.pxmid[1]);\n            if (Math.abs(yFromX) > Math.abs(yNet)) {\n              textLinePath += 'l' + yNet * pt.pxmid[0] / pt.pxmid[1] + ',' + yNet + 'H' + (lineStartX + pt.labelExtraX + finalX);\n            } else {\n              textLinePath += 'l' + pt.labelExtraX + ',' + yFromX + 'v' + (yNet - yFromX) + 'h' + finalX;\n            }\n          } else {\n            textLinePath += 'V' + (pt.yLabelMid + pt.labelExtraY) + 'h' + finalX;\n          }\n          sliceTop.append('path').classed('textline', true).call(Color.stroke, trace.outsidetextfont.color).attr({\n            'stroke-width': Math.min(2, trace.outsidetextfont.size / 8),\n            d: textLinePath,\n            fill: 'none'\n          });\n        }\n      });\n    });\n  });\n\n  // This is for a bug in Chrome (as of 2015-07-22, and does not affect FF)\n  // if insidetextfont and outsidetextfont are different sizes, sometimes the size\n  // of an \"em\" gets taken from the wrong element at first so lines are\n  // spaced wrong. You just have to tell it to try again later and it gets fixed.\n  // I have no idea why we haven't seen this in other contexts. Also, sometimes\n  // it gets the initial draw correct but on redraw it gets confused.\n  setTimeout(function () {\n    pieGroups.selectAll('tspan').each(function () {\n      var s = d3.select(this);\n      if (s.attr('dy')) s.attr('dy', s.attr('dy'));\n    });\n  }, 0);\n};\nfunction determineOutsideTextFont(trace, pt, layoutFont) {\n  var color = helpers.castOption(trace.outsidetextfont.color, pt.pts) || helpers.castOption(trace.textfont.color, pt.pts) || layoutFont.color;\n  var family = helpers.castOption(trace.outsidetextfont.family, pt.pts) || helpers.castOption(trace.textfont.family, pt.pts) || layoutFont.family;\n  var size = helpers.castOption(trace.outsidetextfont.size, pt.pts) || helpers.castOption(trace.textfont.size, pt.pts) || layoutFont.size;\n  return {\n    color: color,\n    family: family,\n    size: size\n  };\n}\nfunction determineInsideTextFont(trace, pt, layoutFont) {\n  var customColor = helpers.castOption(trace.insidetextfont.color, pt.pts);\n  if (!customColor && trace._input.textfont) {\n    // Why not simply using trace.textfont? Because if not set, it\n    // defaults to layout.font which has a default color. But if\n    // textfont.color and insidetextfont.color don't supply a value,\n    // a contrasting color shall be used.\n    customColor = helpers.castOption(trace._input.textfont.color, pt.pts);\n  }\n  var family = helpers.castOption(trace.insidetextfont.family, pt.pts) || helpers.castOption(trace.textfont.family, pt.pts) || layoutFont.family;\n  var size = helpers.castOption(trace.insidetextfont.size, pt.pts) || helpers.castOption(trace.textfont.size, pt.pts) || layoutFont.size;\n  return {\n    color: customColor || Color.contrast(pt.color),\n    family: family,\n    size: size\n  };\n}\nfunction prerenderTitles(cdpie, gd) {\n  var fullLayout = gd._fullLayout;\n  var cd0, trace;\n  // Determine the width and height of the title for each pie.\n  for (var i = 0; i < cdpie.length; i++) {\n    cd0 = cdpie[i][0];\n    trace = cd0.trace;\n    if (trace.title.text) {\n      var txt = fullLayout.meta ? Lib.templateString(trace.title.text, {\n        meta: fullLayout.meta\n      }) : trace.title.text;\n      var dummyTitle = Drawing.tester.append('text').attr('data-notex', 1).text(txt).call(Drawing.font, trace.title.font).call(svgTextUtils.convertToTspans, gd);\n      var bBox = Drawing.bBox(dummyTitle.node(), true);\n      cd0.titleBox = {\n        width: bBox.width,\n        height: bBox.height\n      };\n      dummyTitle.remove();\n    }\n  }\n}\nfunction transformInsideText(textBB, pt, cd0) {\n  var textDiameter = Math.sqrt(textBB.width * textBB.width + textBB.height * textBB.height);\n  var textAspect = textBB.width / textBB.height;\n  var halfAngle = Math.PI * Math.min(pt.v / cd0.vTotal, 0.5);\n  var ring = 1 - cd0.trace.hole;\n  var rInscribed = getInscribedRadiusFraction(pt, cd0);\n\n  // max size text can be inserted inside without rotating it\n  // this inscribes the text rectangle in a circle, which is then inscribed\n  // in the slice, so it will be an underestimate, which some day we may want\n  // to improve so this case can get more use\n  var transform = {\n    scale: rInscribed * cd0.r * 2 / textDiameter,\n    // and the center position and rotation in this case\n    rCenter: 1 - rInscribed,\n    rotate: 0\n  };\n  if (transform.scale >= 1) return transform;\n\n  // max size if text is rotated radially\n  var Qr = textAspect + 1 / (2 * Math.tan(halfAngle));\n  var maxHalfHeightRotRadial = cd0.r * Math.min(1 / (Math.sqrt(Qr * Qr + 0.5) + Qr), ring / (Math.sqrt(textAspect * textAspect + ring / 2) + textAspect));\n  var radialTransform = {\n    scale: maxHalfHeightRotRadial * 2 / textBB.height,\n    rCenter: Math.cos(maxHalfHeightRotRadial / cd0.r) - maxHalfHeightRotRadial * textAspect / cd0.r,\n    rotate: (180 / Math.PI * pt.midangle + 720) % 180 - 90\n  };\n\n  // max size if text is rotated tangentially\n  var aspectInv = 1 / textAspect;\n  var Qt = aspectInv + 1 / (2 * Math.tan(halfAngle));\n  var maxHalfWidthTangential = cd0.r * Math.min(1 / (Math.sqrt(Qt * Qt + 0.5) + Qt), ring / (Math.sqrt(aspectInv * aspectInv + ring / 2) + aspectInv));\n  var tangentialTransform = {\n    scale: maxHalfWidthTangential * 2 / textBB.width,\n    rCenter: Math.cos(maxHalfWidthTangential / cd0.r) - maxHalfWidthTangential / textAspect / cd0.r,\n    rotate: (180 / Math.PI * pt.midangle + 810) % 180 - 90\n  };\n  // if we need a rotated transform, pick the biggest one\n  // even if both are bigger than 1\n  var rotatedTransform = tangentialTransform.scale > radialTransform.scale ? tangentialTransform : radialTransform;\n  if (transform.scale < 1 && rotatedTransform.scale > transform.scale) return rotatedTransform;\n  return transform;\n}\nfunction getInscribedRadiusFraction(pt, cd0) {\n  if (pt.v === cd0.vTotal && !cd0.trace.hole) return 1; // special case of 100% with no hole\n\n  var halfAngle = Math.PI * Math.min(pt.v / cd0.vTotal, 0.5);\n  return Math.min(1 / (1 + 1 / Math.sin(halfAngle)), (1 - cd0.trace.hole) / 2);\n}\nfunction transformOutsideText(textBB, pt) {\n  var x = pt.pxmid[0];\n  var y = pt.pxmid[1];\n  var dx = textBB.width / 2;\n  var dy = textBB.height / 2;\n  if (x < 0) dx *= -1;\n  if (y < 0) dy *= -1;\n  return {\n    scale: 1,\n    rCenter: 1,\n    rotate: 0,\n    x: dx + Math.abs(dy) * (dx > 0 ? 1 : -1) / 2,\n    y: dy / (1 + x * x / (y * y)),\n    outside: true\n  };\n}\nfunction positionTitleInside(cd0) {\n  var textDiameter = Math.sqrt(cd0.titleBox.width * cd0.titleBox.width + cd0.titleBox.height * cd0.titleBox.height);\n  return {\n    x: cd0.cx,\n    y: cd0.cy,\n    scale: cd0.trace.hole * cd0.r * 2 / textDiameter,\n    tx: 0,\n    ty: -cd0.titleBox.height / 2 + cd0.trace.title.font.size\n  };\n}\nfunction positionTitleOutside(cd0, plotSize) {\n  var scaleX = 1;\n  var scaleY = 1;\n  var maxWidth, maxPull;\n  var trace = cd0.trace;\n  // position of the baseline point of the text box in the plot, before scaling.\n  // we anchored the text in the middle, so the baseline is on the bottom middle\n  // of the first line of text.\n  var topMiddle = {\n    x: cd0.cx,\n    y: cd0.cy\n  };\n  // relative translation of the text box after scaling\n  var translate = {\n    tx: 0,\n    ty: 0\n  };\n\n  // we reason below as if the baseline is the top middle point of the text box.\n  // so we must add the font size to approximate the y-coord. of the top.\n  // note that this correction must happen after scaling.\n  translate.ty += trace.title.font.size;\n  maxPull = getMaxPull(trace);\n  if (trace.title.position.indexOf('top') !== -1) {\n    topMiddle.y -= (1 + maxPull) * cd0.r;\n    translate.ty -= cd0.titleBox.height;\n  } else if (trace.title.position.indexOf('bottom') !== -1) {\n    topMiddle.y += (1 + maxPull) * cd0.r;\n  }\n  if (trace.title.position.indexOf('left') !== -1) {\n    // we start the text at the left edge of the pie\n    maxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]) / 2 + cd0.r;\n    topMiddle.x -= (1 + maxPull) * cd0.r;\n    translate.tx += cd0.titleBox.width / 2;\n  } else if (trace.title.position.indexOf('center') !== -1) {\n    maxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]);\n  } else if (trace.title.position.indexOf('right') !== -1) {\n    maxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]) / 2 + cd0.r;\n    topMiddle.x += (1 + maxPull) * cd0.r;\n    translate.tx -= cd0.titleBox.width / 2;\n  }\n  scaleX = maxWidth / cd0.titleBox.width;\n  scaleY = getTitleSpace(cd0, plotSize) / cd0.titleBox.height;\n  return {\n    x: topMiddle.x,\n    y: topMiddle.y,\n    scale: Math.min(scaleX, scaleY),\n    tx: translate.tx,\n    ty: translate.ty\n  };\n}\nfunction getTitleSpace(cd0, plotSize) {\n  var trace = cd0.trace;\n  var pieBoxHeight = plotSize.h * (trace.domain.y[1] - trace.domain.y[0]);\n  // use at most half of the plot for the title\n  return Math.min(cd0.titleBox.height, pieBoxHeight / 2);\n}\nfunction getMaxPull(trace) {\n  var maxPull = trace.pull;\n  var j;\n  if (Array.isArray(maxPull)) {\n    maxPull = 0;\n    for (j = 0; j < trace.pull.length; j++) {\n      if (trace.pull[j] > maxPull) maxPull = trace.pull[j];\n    }\n  }\n  return maxPull;\n}\nfunction scootLabels(quadrants, trace) {\n  var xHalf, yHalf, equatorFirst, farthestX, farthestY, xDiffSign, yDiffSign, thisQuad, oppositeQuad, wholeSide, i, thisQuadOutside, firstOppositeOutsidePt;\n  function topFirst(a, b) {\n    return a.pxmid[1] - b.pxmid[1];\n  }\n  function bottomFirst(a, b) {\n    return b.pxmid[1] - a.pxmid[1];\n  }\n  function scootOneLabel(thisPt, prevPt) {\n    if (!prevPt) prevPt = {};\n    var prevOuterY = prevPt.labelExtraY + (yHalf ? prevPt.yLabelMax : prevPt.yLabelMin);\n    var thisInnerY = yHalf ? thisPt.yLabelMin : thisPt.yLabelMax;\n    var thisOuterY = yHalf ? thisPt.yLabelMax : thisPt.yLabelMin;\n    var thisSliceOuterY = thisPt.cyFinal + farthestY(thisPt.px0[1], thisPt.px1[1]);\n    var newExtraY = prevOuterY - thisInnerY;\n    var xBuffer, i, otherPt, otherOuterY, otherOuterX, newExtraX;\n\n    // make sure this label doesn't overlap other labels\n    // this *only* has us move these labels vertically\n    if (newExtraY * yDiffSign > 0) thisPt.labelExtraY = newExtraY;\n\n    // make sure this label doesn't overlap any slices\n    if (!Array.isArray(trace.pull)) return; // this can only happen with array pulls\n\n    for (i = 0; i < wholeSide.length; i++) {\n      otherPt = wholeSide[i];\n\n      // overlap can only happen if the other point is pulled more than this one\n      if (otherPt === thisPt || (helpers.castOption(trace.pull, thisPt.pts) || 0) >= (helpers.castOption(trace.pull, otherPt.pts) || 0)) {\n        continue;\n      }\n      if ((thisPt.pxmid[1] - otherPt.pxmid[1]) * yDiffSign > 0) {\n        // closer to the equator - by construction all of these happen first\n        // move the text vertically to get away from these slices\n        otherOuterY = otherPt.cyFinal + farthestY(otherPt.px0[1], otherPt.px1[1]);\n        newExtraY = otherOuterY - thisInnerY - thisPt.labelExtraY;\n        if (newExtraY * yDiffSign > 0) thisPt.labelExtraY += newExtraY;\n      } else if ((thisOuterY + thisPt.labelExtraY - thisSliceOuterY) * yDiffSign > 0) {\n        // farther from the equator - happens after we've done all the\n        // vertical moving we're going to do\n        // move horizontally to get away from these more polar slices\n\n        // if we're moving horz. based on a slice that's several slices away from this one\n        // then we need some extra space for the lines to labels between them\n        xBuffer = 3 * xDiffSign * Math.abs(i - wholeSide.indexOf(thisPt));\n        otherOuterX = otherPt.cxFinal + farthestX(otherPt.px0[0], otherPt.px1[0]);\n        newExtraX = otherOuterX + xBuffer - (thisPt.cxFinal + thisPt.pxmid[0]) - thisPt.labelExtraX;\n        if (newExtraX * xDiffSign > 0) thisPt.labelExtraX += newExtraX;\n      }\n    }\n  }\n  for (yHalf = 0; yHalf < 2; yHalf++) {\n    equatorFirst = yHalf ? topFirst : bottomFirst;\n    farthestY = yHalf ? Math.max : Math.min;\n    yDiffSign = yHalf ? 1 : -1;\n    for (xHalf = 0; xHalf < 2; xHalf++) {\n      farthestX = xHalf ? Math.max : Math.min;\n      xDiffSign = xHalf ? 1 : -1;\n\n      // first sort the array\n      // note this is a copy of cd, so cd itself doesn't get sorted\n      // but we can still modify points in place.\n      thisQuad = quadrants[yHalf][xHalf];\n      thisQuad.sort(equatorFirst);\n      oppositeQuad = quadrants[1 - yHalf][xHalf];\n      wholeSide = oppositeQuad.concat(thisQuad);\n      thisQuadOutside = [];\n      for (i = 0; i < thisQuad.length; i++) {\n        if (thisQuad[i].yLabelMid !== undefined) thisQuadOutside.push(thisQuad[i]);\n      }\n      firstOppositeOutsidePt = false;\n      for (i = 0; yHalf && i < oppositeQuad.length; i++) {\n        if (oppositeQuad[i].yLabelMid !== undefined) {\n          firstOppositeOutsidePt = oppositeQuad[i];\n          break;\n        }\n      }\n\n      // each needs to avoid the previous\n      for (i = 0; i < thisQuadOutside.length; i++) {\n        var prevPt = i && thisQuadOutside[i - 1];\n        // bottom half needs to avoid the first label of the top half\n        // top half we still need to call scootOneLabel on the first slice\n        // so we can avoid other slices, but we don't pass a prevPt\n        if (firstOppositeOutsidePt && !i) prevPt = firstOppositeOutsidePt;\n        scootOneLabel(thisQuadOutside[i], prevPt);\n      }\n    }\n  }\n}\nfunction scalePies(cdpie, plotSize) {\n  var scaleGroups = [];\n  var pieBoxWidth, pieBoxHeight, i, j, cd0, trace, maxPull, scaleGroup, minPxPerValUnit;\n\n  // first figure out the center and maximum radius for each pie\n  for (i = 0; i < cdpie.length; i++) {\n    cd0 = cdpie[i][0];\n    trace = cd0.trace;\n    pieBoxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]);\n    pieBoxHeight = plotSize.h * (trace.domain.y[1] - trace.domain.y[0]);\n    // leave some space for the title, if it will be displayed outside\n    if (trace.title.text && trace.title.position !== 'middle center') {\n      pieBoxHeight -= getTitleSpace(cd0, plotSize);\n    }\n    maxPull = getMaxPull(trace);\n    cd0.r = Math.min(pieBoxWidth, pieBoxHeight) / (2 + 2 * maxPull);\n    cd0.cx = plotSize.l + plotSize.w * (trace.domain.x[1] + trace.domain.x[0]) / 2;\n    cd0.cy = plotSize.t + plotSize.h * (1 - trace.domain.y[0]) - pieBoxHeight / 2;\n    if (trace.title.text && trace.title.position.indexOf('bottom') !== -1) {\n      cd0.cy -= getTitleSpace(cd0, plotSize);\n    }\n    if (trace.scalegroup && scaleGroups.indexOf(trace.scalegroup) === -1) {\n      scaleGroups.push(trace.scalegroup);\n    }\n  }\n\n  // Then scale any pies that are grouped\n  for (j = 0; j < scaleGroups.length; j++) {\n    minPxPerValUnit = Infinity;\n    scaleGroup = scaleGroups[j];\n    for (i = 0; i < cdpie.length; i++) {\n      cd0 = cdpie[i][0];\n      if (cd0.trace.scalegroup === scaleGroup) {\n        minPxPerValUnit = Math.min(minPxPerValUnit, cd0.r * cd0.r / cd0.vTotal);\n      }\n    }\n    for (i = 0; i < cdpie.length; i++) {\n      cd0 = cdpie[i][0];\n      if (cd0.trace.scalegroup === scaleGroup) {\n        cd0.r = Math.sqrt(minPxPerValUnit * cd0.vTotal);\n      }\n    }\n  }\n}\nfunction setCoords(cd) {\n  var cd0 = cd[0];\n  var trace = cd0.trace;\n  var currentAngle = trace.rotation * Math.PI / 180;\n  var angleFactor = 2 * Math.PI / cd0.vTotal;\n  var firstPt = 'px0';\n  var lastPt = 'px1';\n  var i, cdi, currentCoords;\n  if (trace.direction === 'counterclockwise') {\n    for (i = 0; i < cd.length; i++) {\n      if (!cd[i].hidden) break; // find the first non-hidden slice\n    }\n\n    if (i === cd.length) return; // all slices hidden\n\n    currentAngle += angleFactor * cd[i].v;\n    angleFactor *= -1;\n    firstPt = 'px1';\n    lastPt = 'px0';\n  }\n  function getCoords(angle) {\n    return [cd0.r * Math.sin(angle), -cd0.r * Math.cos(angle)];\n  }\n  currentCoords = getCoords(currentAngle);\n  for (i = 0; i < cd.length; i++) {\n    cdi = cd[i];\n    if (cdi.hidden) continue;\n    cdi[firstPt] = currentCoords;\n    currentAngle += angleFactor * cdi.v / 2;\n    cdi.pxmid = getCoords(currentAngle);\n    cdi.midangle = currentAngle;\n    currentAngle += angleFactor * cdi.v / 2;\n    currentCoords = getCoords(currentAngle);\n    cdi[lastPt] = currentCoords;\n    cdi.largeArc = cdi.v > cd0.vTotal / 2 ? 1 : 0;\n  }\n}","map":{"version":3,"names":["d3","require","Fx","Color","Drawing","Lib","svgTextUtils","helpers","eventData","module","exports","plot","gd","cdpie","fullLayout","_fullLayout","prerenderTitles","scalePies","_size","pieGroups","makeTraceGroups","_pielayer","each","cd","pieGroup","select","cd0","trace","setCoords","attr","slices","selectAll","data","enter","append","classed","exit","remove","quadrants","hasOutsideText","pt","hidden","pointNumber","i","curveNumber","index","pxmid","push","cx","cy","sliceTop","slicePath","hasHoverLabel","hasHoverEvent","handleMouseOver","fullLayout2","trace2","_fullData","_dragging","hovermode","hoverinfo","Array","isArray","castHoverinfo","castOption","pts","_module","hovertemplate","rInscribed","getInscribedRadiusFraction","hoverCenterX","hoverCenterY","separators","thisText","indexOf","label","text","hovertext","texti","value","v","valueLabel","formatPieValue","percent","vTotal","percentLabel","formatPiePercent","hoverLabel","hoverlabel","hoverFont","font","loneHover","x0","r","x1","y","join","name","undefined","idealAlign","color","bgcolor","borderColor","bordercolor","fontFamily","family","fontSize","size","fontColor","hovertemplateLabels","container","_hoverlayer","node","outerContainer","_paper","emit","points","event","handleMouseOut","evt","originalEvent","loneUnhover","handleClick","_hoverdata","click","style","on","pull","cxFinal","cyFinal","arc","start","finish","cw","scale","largeArc","hole","outerCircle","px0","outerArc","px1","rim","textPosition","textposition","sliceTextGroup","sliceText","ensureSingle","s","transform","call","determineOutsideTextFont","determineInsideTextFont","convertToTspans","textBB","bBox","transformOutsideText","transformInsideText","outsidetextfont","insidetextfont","translateX","rCenter","x","translateY","outside","yLabelMin","height","yLabelMid","yLabelMax","labelExtraX","labelExtraY","rotate","left","right","top","bottom","titleTextGroup","title","titleText","txt","meta","templateString","position","positionTitleInside","positionTitleOutside","tx","ty","scootLabels","lineStartX","lineStartY","textLinePath","finalX","yFromX","yNet","Math","abs","stroke","min","d","fill","setTimeout","layoutFont","textfont","customColor","_input","contrast","length","dummyTitle","tester","titleBox","width","textDiameter","sqrt","textAspect","halfAngle","PI","ring","Qr","tan","maxHalfHeightRotRadial","radialTransform","cos","midangle","aspectInv","Qt","maxHalfWidthTangential","tangentialTransform","rotatedTransform","sin","dx","dy","plotSize","scaleX","scaleY","maxWidth","maxPull","topMiddle","translate","getMaxPull","w","domain","getTitleSpace","pieBoxHeight","h","j","xHalf","yHalf","equatorFirst","farthestX","farthestY","xDiffSign","yDiffSign","thisQuad","oppositeQuad","wholeSide","thisQuadOutside","firstOppositeOutsidePt","topFirst","a","b","bottomFirst","scootOneLabel","thisPt","prevPt","prevOuterY","thisInnerY","thisOuterY","thisSliceOuterY","newExtraY","xBuffer","otherPt","otherOuterY","otherOuterX","newExtraX","max","sort","concat","scaleGroups","pieBoxWidth","scaleGroup","minPxPerValUnit","l","t","scalegroup","Infinity","currentAngle","rotation","angleFactor","firstPt","lastPt","cdi","currentCoords","direction","getCoords","angle"],"sources":["/home/yasmin/√Årea de Trabalho/Frontend/node_modules/plotly.js/src/traces/pie/plot.js"],"sourcesContent":["/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\n\nvar Fx = require('../../components/fx');\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\nvar Lib = require('../../lib');\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar helpers = require('./helpers');\nvar eventData = require('./event_data');\n\nmodule.exports = function plot(gd, cdpie) {\n    var fullLayout = gd._fullLayout;\n\n    prerenderTitles(cdpie, gd);\n    scalePies(cdpie, fullLayout._size);\n\n    var pieGroups = Lib.makeTraceGroups(fullLayout._pielayer, cdpie, 'trace').each(function(cd) {\n        var pieGroup = d3.select(this);\n        var cd0 = cd[0];\n        var trace = cd0.trace;\n\n        setCoords(cd);\n\n        // TODO: miter might look better but can sometimes cause problems\n        // maybe miter with a small-ish stroke-miterlimit?\n        pieGroup.attr('stroke-linejoin', 'round');\n\n        pieGroup.each(function() {\n            var slices = d3.select(this).selectAll('g.slice').data(cd);\n\n            slices.enter().append('g')\n                .classed('slice', true);\n            slices.exit().remove();\n\n            var quadrants = [\n                [[], []], // y<0: x<0, x>=0\n                [[], []] // y>=0: x<0, x>=0\n            ];\n            var hasOutsideText = false;\n\n            slices.each(function(pt) {\n                if(pt.hidden) {\n                    d3.select(this).selectAll('path,g').remove();\n                    return;\n                }\n\n                // to have consistent event data compared to other traces\n                pt.pointNumber = pt.i;\n                pt.curveNumber = trace.index;\n\n                quadrants[pt.pxmid[1] < 0 ? 0 : 1][pt.pxmid[0] < 0 ? 0 : 1].push(pt);\n\n                var cx = cd0.cx;\n                var cy = cd0.cy;\n                var sliceTop = d3.select(this);\n                var slicePath = sliceTop.selectAll('path.surface').data([pt]);\n\n                // hover state vars\n                // have we drawn a hover label, so it should be cleared later\n                var hasHoverLabel = false;\n                // have we emitted a hover event, so later an unhover event should be emitted\n                // note that click events do not depend on this - you can still get them\n                // with hovermode: false or if you were earlier dragging, then clicked\n                // in the same slice that you moused up in\n                var hasHoverEvent = false;\n\n                function handleMouseOver() {\n                    // in case fullLayout or fullData has changed without a replot\n                    var fullLayout2 = gd._fullLayout;\n                    var trace2 = gd._fullData[trace.index];\n\n                    if(gd._dragging || fullLayout2.hovermode === false) return;\n\n                    var hoverinfo = trace2.hoverinfo;\n                    if(Array.isArray(hoverinfo)) {\n                        // super hacky: we need to pull out the *first* hoverinfo from\n                        // pt.pts, then put it back into an array in a dummy trace\n                        // and call castHoverinfo on that.\n                        // TODO: do we want to have Fx.castHoverinfo somehow handle this?\n                        // it already takes an array for index, for 2D, so this seems tricky.\n                        hoverinfo = Fx.castHoverinfo({\n                            hoverinfo: [helpers.castOption(hoverinfo, pt.pts)],\n                            _module: trace._module\n                        }, fullLayout2, 0);\n                    }\n\n                    if(hoverinfo === 'all') hoverinfo = 'label+text+value+percent+name';\n\n                    // in case we dragged over the pie from another subplot,\n                    // or if hover is turned off\n                    if(trace2.hovertemplate || (hoverinfo !== 'none' && hoverinfo !== 'skip' && hoverinfo)) {\n                        var rInscribed = getInscribedRadiusFraction(pt, cd0);\n                        var hoverCenterX = cx + pt.pxmid[0] * (1 - rInscribed);\n                        var hoverCenterY = cy + pt.pxmid[1] * (1 - rInscribed);\n                        var separators = fullLayout.separators;\n                        var thisText = [];\n\n                        if(hoverinfo && hoverinfo.indexOf('label') !== -1) thisText.push(pt.label);\n                        pt.text = helpers.castOption(trace2.hovertext || trace2.text, pt.pts);\n                        if(hoverinfo && hoverinfo.indexOf('text') !== -1) {\n                            var texti = pt.text;\n                            if(texti) thisText.push(texti);\n                        }\n                        pt.value = pt.v;\n                        pt.valueLabel = helpers.formatPieValue(pt.v, separators);\n                        if(hoverinfo && hoverinfo.indexOf('value') !== -1) thisText.push(pt.valueLabel);\n                        pt.percent = pt.v / cd0.vTotal;\n                        pt.percentLabel = helpers.formatPiePercent(pt.percent, separators);\n                        if(hoverinfo && hoverinfo.indexOf('percent') !== -1) thisText.push(pt.percentLabel);\n\n                        var hoverLabel = trace.hoverlabel;\n                        var hoverFont = hoverLabel.font;\n\n                        Fx.loneHover({\n                            x0: hoverCenterX - rInscribed * cd0.r,\n                            x1: hoverCenterX + rInscribed * cd0.r,\n                            y: hoverCenterY,\n                            text: thisText.join('<br>'),\n                            name: (trace2.hovertemplate || hoverinfo.indexOf('name') !== -1) ? trace2.name : undefined,\n                            idealAlign: pt.pxmid[0] < 0 ? 'left' : 'right',\n                            color: helpers.castOption(hoverLabel.bgcolor, pt.pts) || pt.color,\n                            borderColor: helpers.castOption(hoverLabel.bordercolor, pt.pts),\n                            fontFamily: helpers.castOption(hoverFont.family, pt.pts),\n                            fontSize: helpers.castOption(hoverFont.size, pt.pts),\n                            fontColor: helpers.castOption(hoverFont.color, pt.pts),\n\n                            trace: trace2,\n                            hovertemplate: helpers.castOption(trace2.hovertemplate, pt.pts),\n                            hovertemplateLabels: pt,\n                            eventData: [eventData(pt, trace2)]\n                        }, {\n                            container: fullLayout2._hoverlayer.node(),\n                            outerContainer: fullLayout2._paper.node(),\n                            gd: gd\n                        });\n\n                        hasHoverLabel = true;\n                    }\n\n                    gd.emit('plotly_hover', {\n                        points: [eventData(pt, trace2)],\n                        event: d3.event\n                    });\n                    hasHoverEvent = true;\n                }\n\n                function handleMouseOut(evt) {\n                    var fullLayout2 = gd._fullLayout;\n                    var trace2 = gd._fullData[trace.index];\n\n                    if(hasHoverEvent) {\n                        evt.originalEvent = d3.event;\n                        gd.emit('plotly_unhover', {\n                            points: [eventData(pt, trace2)],\n                            event: d3.event\n                        });\n                        hasHoverEvent = false;\n                    }\n\n                    if(hasHoverLabel) {\n                        Fx.loneUnhover(fullLayout2._hoverlayer.node());\n                        hasHoverLabel = false;\n                    }\n                }\n\n                function handleClick() {\n                    // TODO: this does not support right-click. If we want to support it, we\n                    // would likely need to change pie to use dragElement instead of straight\n                    // mapbox event binding. Or perhaps better, make a simple wrapper with the\n                    // right mousedown, mousemove, and mouseup handlers just for a left/right click\n                    // mapbox would use this too.\n                    var fullLayout2 = gd._fullLayout;\n                    var trace2 = gd._fullData[trace.index];\n\n                    if(gd._dragging || fullLayout2.hovermode === false) return;\n\n                    gd._hoverdata = [eventData(pt, trace2)];\n                    Fx.click(gd, d3.event);\n                }\n\n                slicePath.enter().append('path')\n                    .classed('surface', true)\n                    .style({'pointer-events': 'all'});\n\n                sliceTop.select('path.textline').remove();\n\n                sliceTop\n                    .on('mouseover', handleMouseOver)\n                    .on('mouseout', handleMouseOut)\n                    .on('click', handleClick);\n\n                if(trace.pull) {\n                    var pull = +helpers.castOption(trace.pull, pt.pts) || 0;\n                    if(pull > 0) {\n                        cx += pull * pt.pxmid[0];\n                        cy += pull * pt.pxmid[1];\n                    }\n                }\n\n                pt.cxFinal = cx;\n                pt.cyFinal = cy;\n\n                function arc(start, finish, cw, scale) {\n                    return 'a' + (scale * cd0.r) + ',' + (scale * cd0.r) + ' 0 ' +\n                        pt.largeArc + (cw ? ' 1 ' : ' 0 ') +\n                        (scale * (finish[0] - start[0])) + ',' + (scale * (finish[1] - start[1]));\n                }\n\n                var hole = trace.hole;\n                if(pt.v === cd0.vTotal) { // 100% fails bcs arc start and end are identical\n                    var outerCircle = 'M' + (cx + pt.px0[0]) + ',' + (cy + pt.px0[1]) +\n                        arc(pt.px0, pt.pxmid, true, 1) +\n                        arc(pt.pxmid, pt.px0, true, 1) + 'Z';\n                    if(hole) {\n                        slicePath.attr('d',\n                            'M' + (cx + hole * pt.px0[0]) + ',' + (cy + hole * pt.px0[1]) +\n                            arc(pt.px0, pt.pxmid, false, hole) +\n                            arc(pt.pxmid, pt.px0, false, hole) +\n                            'Z' + outerCircle);\n                    }\n                    else slicePath.attr('d', outerCircle);\n                } else {\n\n                    var outerArc = arc(pt.px0, pt.px1, true, 1);\n\n                    if(hole) {\n                        var rim = 1 - hole;\n                        slicePath.attr('d',\n                            'M' + (cx + hole * pt.px1[0]) + ',' + (cy + hole * pt.px1[1]) +\n                            arc(pt.px1, pt.px0, false, hole) +\n                            'l' + (rim * pt.px0[0]) + ',' + (rim * pt.px0[1]) +\n                            outerArc +\n                            'Z');\n                    } else {\n                        slicePath.attr('d',\n                            'M' + cx + ',' + cy +\n                            'l' + pt.px0[0] + ',' + pt.px0[1] +\n                            outerArc +\n                            'Z');\n                    }\n                }\n\n                // add text\n                var textPosition = helpers.castOption(trace.textposition, pt.pts);\n                var sliceTextGroup = sliceTop.selectAll('g.slicetext')\n                    .data(pt.text && (textPosition !== 'none') ? [0] : []);\n\n                sliceTextGroup.enter().append('g')\n                    .classed('slicetext', true);\n                sliceTextGroup.exit().remove();\n\n                sliceTextGroup.each(function() {\n                    var sliceText = Lib.ensureSingle(d3.select(this), 'text', '', function(s) {\n                        // prohibit tex interpretation until we can handle\n                        // tex and regular text together\n                        s.attr('data-notex', 1);\n                    });\n\n                    sliceText.text(pt.text)\n                        .attr({\n                            'class': 'slicetext',\n                            transform: '',\n                            'text-anchor': 'middle'\n                        })\n                        .call(Drawing.font, textPosition === 'outside' ?\n                          determineOutsideTextFont(trace, pt, gd._fullLayout.font) :\n                          determineInsideTextFont(trace, pt, gd._fullLayout.font))\n                        .call(svgTextUtils.convertToTspans, gd);\n\n                    // position the text relative to the slice\n                    var textBB = Drawing.bBox(sliceText.node());\n                    var transform;\n\n                    if(textPosition === 'outside') {\n                        transform = transformOutsideText(textBB, pt);\n                    } else {\n                        transform = transformInsideText(textBB, pt, cd0);\n                        if(textPosition === 'auto' && transform.scale < 1) {\n                            sliceText.call(Drawing.font, trace.outsidetextfont);\n                            if(trace.outsidetextfont.family !== trace.insidetextfont.family ||\n                                    trace.outsidetextfont.size !== trace.insidetextfont.size) {\n                                textBB = Drawing.bBox(sliceText.node());\n                            }\n                            transform = transformOutsideText(textBB, pt);\n                        }\n                    }\n\n                    var translateX = cx + pt.pxmid[0] * transform.rCenter + (transform.x || 0);\n                    var translateY = cy + pt.pxmid[1] * transform.rCenter + (transform.y || 0);\n\n                    // save some stuff to use later ensure no labels overlap\n                    if(transform.outside) {\n                        pt.yLabelMin = translateY - textBB.height / 2;\n                        pt.yLabelMid = translateY;\n                        pt.yLabelMax = translateY + textBB.height / 2;\n                        pt.labelExtraX = 0;\n                        pt.labelExtraY = 0;\n                        hasOutsideText = true;\n                    }\n\n                    sliceText.attr('transform',\n                        'translate(' + translateX + ',' + translateY + ')' +\n                        (transform.scale < 1 ? ('scale(' + transform.scale + ')') : '') +\n                        (transform.rotate ? ('rotate(' + transform.rotate + ')') : '') +\n                        'translate(' +\n                            (-(textBB.left + textBB.right) / 2) + ',' +\n                            (-(textBB.top + textBB.bottom) / 2) +\n                        ')');\n                });\n            });\n\n            // add the title\n            var titleTextGroup = d3.select(this).selectAll('g.titletext')\n                .data(trace.title.text ? [0] : []);\n\n            titleTextGroup.enter().append('g')\n                .classed('titletext', true);\n            titleTextGroup.exit().remove();\n\n            titleTextGroup.each(function() {\n                var titleText = Lib.ensureSingle(d3.select(this), 'text', '', function(s) {\n                    // prohibit tex interpretation as above\n                    s.attr('data-notex', 1);\n                });\n\n                var txt = fullLayout.meta ?\n                    Lib.templateString(trace.title.text, {meta: fullLayout.meta}) :\n                    trace.title.text;\n\n                titleText.text(txt)\n                    .attr({\n                        'class': 'titletext',\n                        transform: '',\n                        'text-anchor': 'middle',\n                    })\n                .call(Drawing.font, trace.title.font)\n                .call(svgTextUtils.convertToTspans, gd);\n\n                var transform;\n\n                if(trace.title.position === 'middle center') {\n                    transform = positionTitleInside(cd0);\n                } else {\n                    transform = positionTitleOutside(cd0, fullLayout._size);\n                }\n\n                titleText.attr('transform',\n                    'translate(' + transform.x + ',' + transform.y + ')' +\n                    (transform.scale < 1 ? ('scale(' + transform.scale + ')') : '') +\n                    'translate(' + transform.tx + ',' + transform.ty + ')');\n            });\n\n            // now make sure no labels overlap (at least within one pie)\n            if(hasOutsideText) scootLabels(quadrants, trace);\n            slices.each(function(pt) {\n                if(pt.labelExtraX || pt.labelExtraY) {\n                    // first move the text to its new location\n                    var sliceTop = d3.select(this);\n                    var sliceText = sliceTop.select('g.slicetext text');\n\n                    sliceText.attr('transform', 'translate(' + pt.labelExtraX + ',' + pt.labelExtraY + ')' +\n                        sliceText.attr('transform'));\n\n                    // then add a line to the new location\n                    var lineStartX = pt.cxFinal + pt.pxmid[0];\n                    var lineStartY = pt.cyFinal + pt.pxmid[1];\n                    var textLinePath = 'M' + lineStartX + ',' + lineStartY;\n                    var finalX = (pt.yLabelMax - pt.yLabelMin) * (pt.pxmid[0] < 0 ? -1 : 1) / 4;\n\n                    if(pt.labelExtraX) {\n                        var yFromX = pt.labelExtraX * pt.pxmid[1] / pt.pxmid[0];\n                        var yNet = pt.yLabelMid + pt.labelExtraY - (pt.cyFinal + pt.pxmid[1]);\n\n                        if(Math.abs(yFromX) > Math.abs(yNet)) {\n                            textLinePath +=\n                                'l' + (yNet * pt.pxmid[0] / pt.pxmid[1]) + ',' + yNet +\n                                'H' + (lineStartX + pt.labelExtraX + finalX);\n                        } else {\n                            textLinePath += 'l' + pt.labelExtraX + ',' + yFromX +\n                                'v' + (yNet - yFromX) +\n                                'h' + finalX;\n                        }\n                    } else {\n                        textLinePath +=\n                            'V' + (pt.yLabelMid + pt.labelExtraY) +\n                            'h' + finalX;\n                    }\n\n                    sliceTop.append('path')\n                        .classed('textline', true)\n                        .call(Color.stroke, trace.outsidetextfont.color)\n                        .attr({\n                            'stroke-width': Math.min(2, trace.outsidetextfont.size / 8),\n                            d: textLinePath,\n                            fill: 'none'\n                        });\n                }\n            });\n        });\n    });\n\n    // This is for a bug in Chrome (as of 2015-07-22, and does not affect FF)\n    // if insidetextfont and outsidetextfont are different sizes, sometimes the size\n    // of an \"em\" gets taken from the wrong element at first so lines are\n    // spaced wrong. You just have to tell it to try again later and it gets fixed.\n    // I have no idea why we haven't seen this in other contexts. Also, sometimes\n    // it gets the initial draw correct but on redraw it gets confused.\n    setTimeout(function() {\n        pieGroups.selectAll('tspan').each(function() {\n            var s = d3.select(this);\n            if(s.attr('dy')) s.attr('dy', s.attr('dy'));\n        });\n    }, 0);\n};\n\nfunction determineOutsideTextFont(trace, pt, layoutFont) {\n    var color = helpers.castOption(trace.outsidetextfont.color, pt.pts) ||\n      helpers.castOption(trace.textfont.color, pt.pts) ||\n      layoutFont.color;\n\n    var family = helpers.castOption(trace.outsidetextfont.family, pt.pts) ||\n      helpers.castOption(trace.textfont.family, pt.pts) ||\n      layoutFont.family;\n\n    var size = helpers.castOption(trace.outsidetextfont.size, pt.pts) ||\n      helpers.castOption(trace.textfont.size, pt.pts) ||\n      layoutFont.size;\n\n    return {\n        color: color,\n        family: family,\n        size: size\n    };\n}\n\nfunction determineInsideTextFont(trace, pt, layoutFont) {\n    var customColor = helpers.castOption(trace.insidetextfont.color, pt.pts);\n    if(!customColor && trace._input.textfont) {\n\n        // Why not simply using trace.textfont? Because if not set, it\n        // defaults to layout.font which has a default color. But if\n        // textfont.color and insidetextfont.color don't supply a value,\n        // a contrasting color shall be used.\n        customColor = helpers.castOption(trace._input.textfont.color, pt.pts);\n    }\n\n    var family = helpers.castOption(trace.insidetextfont.family, pt.pts) ||\n      helpers.castOption(trace.textfont.family, pt.pts) ||\n      layoutFont.family;\n\n    var size = helpers.castOption(trace.insidetextfont.size, pt.pts) ||\n      helpers.castOption(trace.textfont.size, pt.pts) ||\n      layoutFont.size;\n\n    return {\n        color: customColor || Color.contrast(pt.color),\n        family: family,\n        size: size\n    };\n}\n\nfunction prerenderTitles(cdpie, gd) {\n    var fullLayout = gd._fullLayout;\n\n    var cd0, trace;\n    // Determine the width and height of the title for each pie.\n    for(var i = 0; i < cdpie.length; i++) {\n        cd0 = cdpie[i][0];\n        trace = cd0.trace;\n\n        if(trace.title.text) {\n            var txt = fullLayout.meta ?\n                Lib.templateString(trace.title.text, {meta: fullLayout.meta}) :\n                trace.title.text;\n\n            var dummyTitle = Drawing.tester.append('text')\n              .attr('data-notex', 1)\n              .text(txt)\n              .call(Drawing.font, trace.title.font)\n              .call(svgTextUtils.convertToTspans, gd);\n            var bBox = Drawing.bBox(dummyTitle.node(), true);\n            cd0.titleBox = {\n                width: bBox.width,\n                height: bBox.height,\n            };\n            dummyTitle.remove();\n        }\n    }\n}\n\nfunction transformInsideText(textBB, pt, cd0) {\n    var textDiameter = Math.sqrt(textBB.width * textBB.width + textBB.height * textBB.height);\n    var textAspect = textBB.width / textBB.height;\n    var halfAngle = Math.PI * Math.min(pt.v / cd0.vTotal, 0.5);\n    var ring = 1 - cd0.trace.hole;\n    var rInscribed = getInscribedRadiusFraction(pt, cd0);\n\n    // max size text can be inserted inside without rotating it\n    // this inscribes the text rectangle in a circle, which is then inscribed\n    // in the slice, so it will be an underestimate, which some day we may want\n    // to improve so this case can get more use\n    var transform = {\n        scale: rInscribed * cd0.r * 2 / textDiameter,\n\n        // and the center position and rotation in this case\n        rCenter: 1 - rInscribed,\n        rotate: 0\n    };\n\n    if(transform.scale >= 1) return transform;\n\n        // max size if text is rotated radially\n    var Qr = textAspect + 1 / (2 * Math.tan(halfAngle));\n    var maxHalfHeightRotRadial = cd0.r * Math.min(\n        1 / (Math.sqrt(Qr * Qr + 0.5) + Qr),\n        ring / (Math.sqrt(textAspect * textAspect + ring / 2) + textAspect)\n    );\n    var radialTransform = {\n        scale: maxHalfHeightRotRadial * 2 / textBB.height,\n        rCenter: Math.cos(maxHalfHeightRotRadial / cd0.r) -\n            maxHalfHeightRotRadial * textAspect / cd0.r,\n        rotate: (180 / Math.PI * pt.midangle + 720) % 180 - 90\n    };\n\n        // max size if text is rotated tangentially\n    var aspectInv = 1 / textAspect;\n    var Qt = aspectInv + 1 / (2 * Math.tan(halfAngle));\n    var maxHalfWidthTangential = cd0.r * Math.min(\n        1 / (Math.sqrt(Qt * Qt + 0.5) + Qt),\n        ring / (Math.sqrt(aspectInv * aspectInv + ring / 2) + aspectInv)\n    );\n    var tangentialTransform = {\n        scale: maxHalfWidthTangential * 2 / textBB.width,\n        rCenter: Math.cos(maxHalfWidthTangential / cd0.r) -\n            maxHalfWidthTangential / textAspect / cd0.r,\n        rotate: (180 / Math.PI * pt.midangle + 810) % 180 - 90\n    };\n    // if we need a rotated transform, pick the biggest one\n    // even if both are bigger than 1\n    var rotatedTransform = tangentialTransform.scale > radialTransform.scale ?\n            tangentialTransform : radialTransform;\n\n    if(transform.scale < 1 && rotatedTransform.scale > transform.scale) return rotatedTransform;\n    return transform;\n}\n\nfunction getInscribedRadiusFraction(pt, cd0) {\n    if(pt.v === cd0.vTotal && !cd0.trace.hole) return 1;// special case of 100% with no hole\n\n    var halfAngle = Math.PI * Math.min(pt.v / cd0.vTotal, 0.5);\n    return Math.min(1 / (1 + 1 / Math.sin(halfAngle)), (1 - cd0.trace.hole) / 2);\n}\n\nfunction transformOutsideText(textBB, pt) {\n    var x = pt.pxmid[0];\n    var y = pt.pxmid[1];\n    var dx = textBB.width / 2;\n    var dy = textBB.height / 2;\n\n    if(x < 0) dx *= -1;\n    if(y < 0) dy *= -1;\n\n    return {\n        scale: 1,\n        rCenter: 1,\n        rotate: 0,\n        x: dx + Math.abs(dy) * (dx > 0 ? 1 : -1) / 2,\n        y: dy / (1 + x * x / (y * y)),\n        outside: true\n    };\n}\n\nfunction positionTitleInside(cd0) {\n    var textDiameter =\n        Math.sqrt(cd0.titleBox.width * cd0.titleBox.width + cd0.titleBox.height * cd0.titleBox.height);\n    return {\n        x: cd0.cx,\n        y: cd0.cy,\n        scale: cd0.trace.hole * cd0.r * 2 / textDiameter,\n        tx: 0,\n        ty: - cd0.titleBox.height / 2 + cd0.trace.title.font.size\n    };\n}\n\nfunction positionTitleOutside(cd0, plotSize) {\n    var scaleX = 1;\n    var scaleY = 1;\n    var maxWidth, maxPull;\n\n    var trace = cd0.trace;\n    // position of the baseline point of the text box in the plot, before scaling.\n    // we anchored the text in the middle, so the baseline is on the bottom middle\n    // of the first line of text.\n    var topMiddle = {\n        x: cd0.cx,\n        y: cd0.cy\n    };\n    // relative translation of the text box after scaling\n    var translate = {\n        tx: 0,\n        ty: 0\n    };\n\n    // we reason below as if the baseline is the top middle point of the text box.\n    // so we must add the font size to approximate the y-coord. of the top.\n    // note that this correction must happen after scaling.\n    translate.ty += trace.title.font.size;\n    maxPull = getMaxPull(trace);\n\n    if(trace.title.position.indexOf('top') !== -1) {\n        topMiddle.y -= (1 + maxPull) * cd0.r;\n        translate.ty -= cd0.titleBox.height;\n    }\n    else if(trace.title.position.indexOf('bottom') !== -1) {\n        topMiddle.y += (1 + maxPull) * cd0.r;\n    }\n\n    if(trace.title.position.indexOf('left') !== -1) {\n        // we start the text at the left edge of the pie\n        maxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]) / 2 + cd0.r;\n        topMiddle.x -= (1 + maxPull) * cd0.r;\n        translate.tx += cd0.titleBox.width / 2;\n    } else if(trace.title.position.indexOf('center') !== -1) {\n        maxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]);\n    } else if(trace.title.position.indexOf('right') !== -1) {\n        maxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]) / 2 + cd0.r;\n        topMiddle.x += (1 + maxPull) * cd0.r;\n        translate.tx -= cd0.titleBox.width / 2;\n    }\n    scaleX = maxWidth / cd0.titleBox.width;\n    scaleY = getTitleSpace(cd0, plotSize) / cd0.titleBox.height;\n    return {\n        x: topMiddle.x,\n        y: topMiddle.y,\n        scale: Math.min(scaleX, scaleY),\n        tx: translate.tx,\n        ty: translate.ty\n    };\n}\n\nfunction getTitleSpace(cd0, plotSize) {\n    var trace = cd0.trace;\n    var pieBoxHeight = plotSize.h * (trace.domain.y[1] - trace.domain.y[0]);\n    // use at most half of the plot for the title\n    return Math.min(cd0.titleBox.height, pieBoxHeight / 2);\n}\n\nfunction getMaxPull(trace) {\n    var maxPull = trace.pull;\n    var j;\n    if(Array.isArray(maxPull)) {\n        maxPull = 0;\n        for(j = 0; j < trace.pull.length; j++) {\n            if(trace.pull[j] > maxPull) maxPull = trace.pull[j];\n        }\n    }\n    return maxPull;\n}\n\nfunction scootLabels(quadrants, trace) {\n    var xHalf, yHalf, equatorFirst, farthestX, farthestY,\n        xDiffSign, yDiffSign, thisQuad, oppositeQuad,\n        wholeSide, i, thisQuadOutside, firstOppositeOutsidePt;\n\n    function topFirst(a, b) { return a.pxmid[1] - b.pxmid[1]; }\n    function bottomFirst(a, b) { return b.pxmid[1] - a.pxmid[1]; }\n\n    function scootOneLabel(thisPt, prevPt) {\n        if(!prevPt) prevPt = {};\n\n        var prevOuterY = prevPt.labelExtraY + (yHalf ? prevPt.yLabelMax : prevPt.yLabelMin);\n        var thisInnerY = yHalf ? thisPt.yLabelMin : thisPt.yLabelMax;\n        var thisOuterY = yHalf ? thisPt.yLabelMax : thisPt.yLabelMin;\n        var thisSliceOuterY = thisPt.cyFinal + farthestY(thisPt.px0[1], thisPt.px1[1]);\n        var newExtraY = prevOuterY - thisInnerY;\n\n        var xBuffer, i, otherPt, otherOuterY, otherOuterX, newExtraX;\n\n        // make sure this label doesn't overlap other labels\n        // this *only* has us move these labels vertically\n        if(newExtraY * yDiffSign > 0) thisPt.labelExtraY = newExtraY;\n\n        // make sure this label doesn't overlap any slices\n        if(!Array.isArray(trace.pull)) return; // this can only happen with array pulls\n\n        for(i = 0; i < wholeSide.length; i++) {\n            otherPt = wholeSide[i];\n\n            // overlap can only happen if the other point is pulled more than this one\n            if(otherPt === thisPt || (\n                (helpers.castOption(trace.pull, thisPt.pts) || 0) >=\n                (helpers.castOption(trace.pull, otherPt.pts) || 0))\n            ) {\n                continue;\n            }\n\n            if((thisPt.pxmid[1] - otherPt.pxmid[1]) * yDiffSign > 0) {\n                // closer to the equator - by construction all of these happen first\n                // move the text vertically to get away from these slices\n                otherOuterY = otherPt.cyFinal + farthestY(otherPt.px0[1], otherPt.px1[1]);\n                newExtraY = otherOuterY - thisInnerY - thisPt.labelExtraY;\n\n                if(newExtraY * yDiffSign > 0) thisPt.labelExtraY += newExtraY;\n\n            } else if((thisOuterY + thisPt.labelExtraY - thisSliceOuterY) * yDiffSign > 0) {\n                // farther from the equator - happens after we've done all the\n                // vertical moving we're going to do\n                // move horizontally to get away from these more polar slices\n\n                // if we're moving horz. based on a slice that's several slices away from this one\n                // then we need some extra space for the lines to labels between them\n                xBuffer = 3 * xDiffSign * Math.abs(i - wholeSide.indexOf(thisPt));\n\n                otherOuterX = otherPt.cxFinal + farthestX(otherPt.px0[0], otherPt.px1[0]);\n                newExtraX = otherOuterX + xBuffer - (thisPt.cxFinal + thisPt.pxmid[0]) - thisPt.labelExtraX;\n\n                if(newExtraX * xDiffSign > 0) thisPt.labelExtraX += newExtraX;\n            }\n        }\n    }\n\n    for(yHalf = 0; yHalf < 2; yHalf++) {\n        equatorFirst = yHalf ? topFirst : bottomFirst;\n        farthestY = yHalf ? Math.max : Math.min;\n        yDiffSign = yHalf ? 1 : -1;\n\n        for(xHalf = 0; xHalf < 2; xHalf++) {\n            farthestX = xHalf ? Math.max : Math.min;\n            xDiffSign = xHalf ? 1 : -1;\n\n            // first sort the array\n            // note this is a copy of cd, so cd itself doesn't get sorted\n            // but we can still modify points in place.\n            thisQuad = quadrants[yHalf][xHalf];\n            thisQuad.sort(equatorFirst);\n\n            oppositeQuad = quadrants[1 - yHalf][xHalf];\n            wholeSide = oppositeQuad.concat(thisQuad);\n\n            thisQuadOutside = [];\n            for(i = 0; i < thisQuad.length; i++) {\n                if(thisQuad[i].yLabelMid !== undefined) thisQuadOutside.push(thisQuad[i]);\n            }\n\n            firstOppositeOutsidePt = false;\n            for(i = 0; yHalf && i < oppositeQuad.length; i++) {\n                if(oppositeQuad[i].yLabelMid !== undefined) {\n                    firstOppositeOutsidePt = oppositeQuad[i];\n                    break;\n                }\n            }\n\n            // each needs to avoid the previous\n            for(i = 0; i < thisQuadOutside.length; i++) {\n                var prevPt = i && thisQuadOutside[i - 1];\n                // bottom half needs to avoid the first label of the top half\n                // top half we still need to call scootOneLabel on the first slice\n                // so we can avoid other slices, but we don't pass a prevPt\n                if(firstOppositeOutsidePt && !i) prevPt = firstOppositeOutsidePt;\n                scootOneLabel(thisQuadOutside[i], prevPt);\n            }\n        }\n    }\n}\n\nfunction scalePies(cdpie, plotSize) {\n    var scaleGroups = [];\n\n    var pieBoxWidth, pieBoxHeight, i, j, cd0, trace,\n        maxPull, scaleGroup, minPxPerValUnit;\n\n    // first figure out the center and maximum radius for each pie\n    for(i = 0; i < cdpie.length; i++) {\n        cd0 = cdpie[i][0];\n        trace = cd0.trace;\n\n        pieBoxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]);\n        pieBoxHeight = plotSize.h * (trace.domain.y[1] - trace.domain.y[0]);\n        // leave some space for the title, if it will be displayed outside\n        if(trace.title.text && trace.title.position !== 'middle center') {\n            pieBoxHeight -= getTitleSpace(cd0, plotSize);\n        }\n\n        maxPull = getMaxPull(trace);\n\n        cd0.r = Math.min(pieBoxWidth, pieBoxHeight) / (2 + 2 * maxPull);\n\n        cd0.cx = plotSize.l + plotSize.w * (trace.domain.x[1] + trace.domain.x[0]) / 2;\n        cd0.cy = plotSize.t + plotSize.h * (1 - trace.domain.y[0]) - pieBoxHeight / 2;\n        if(trace.title.text && trace.title.position.indexOf('bottom') !== -1) {\n            cd0.cy -= getTitleSpace(cd0, plotSize);\n        }\n\n        if(trace.scalegroup && scaleGroups.indexOf(trace.scalegroup) === -1) {\n            scaleGroups.push(trace.scalegroup);\n        }\n    }\n\n    // Then scale any pies that are grouped\n    for(j = 0; j < scaleGroups.length; j++) {\n        minPxPerValUnit = Infinity;\n        scaleGroup = scaleGroups[j];\n\n        for(i = 0; i < cdpie.length; i++) {\n            cd0 = cdpie[i][0];\n            if(cd0.trace.scalegroup === scaleGroup) {\n                minPxPerValUnit = Math.min(minPxPerValUnit,\n                    cd0.r * cd0.r / cd0.vTotal);\n            }\n        }\n\n        for(i = 0; i < cdpie.length; i++) {\n            cd0 = cdpie[i][0];\n            if(cd0.trace.scalegroup === scaleGroup) {\n                cd0.r = Math.sqrt(minPxPerValUnit * cd0.vTotal);\n            }\n        }\n    }\n\n}\n\nfunction setCoords(cd) {\n    var cd0 = cd[0];\n    var trace = cd0.trace;\n    var currentAngle = trace.rotation * Math.PI / 180;\n    var angleFactor = 2 * Math.PI / cd0.vTotal;\n    var firstPt = 'px0';\n    var lastPt = 'px1';\n\n    var i, cdi, currentCoords;\n\n    if(trace.direction === 'counterclockwise') {\n        for(i = 0; i < cd.length; i++) {\n            if(!cd[i].hidden) break; // find the first non-hidden slice\n        }\n        if(i === cd.length) return; // all slices hidden\n\n        currentAngle += angleFactor * cd[i].v;\n        angleFactor *= -1;\n        firstPt = 'px1';\n        lastPt = 'px0';\n    }\n\n    function getCoords(angle) {\n        return [cd0.r * Math.sin(angle), -cd0.r * Math.cos(angle)];\n    }\n\n    currentCoords = getCoords(currentAngle);\n\n    for(i = 0; i < cd.length; i++) {\n        cdi = cd[i];\n        if(cdi.hidden) continue;\n\n        cdi[firstPt] = currentCoords;\n\n        currentAngle += angleFactor * cdi.v / 2;\n        cdi.pxmid = getCoords(currentAngle);\n        cdi.midangle = currentAngle;\n\n        currentAngle += angleFactor * cdi.v / 2;\n        currentCoords = getCoords(currentAngle);\n\n        cdi[lastPt] = currentCoords;\n\n        cdi.largeArc = (cdi.v > cd0.vTotal / 2) ? 1 : 0;\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}