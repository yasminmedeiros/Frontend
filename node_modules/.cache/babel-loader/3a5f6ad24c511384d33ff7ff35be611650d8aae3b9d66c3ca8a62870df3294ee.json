{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\nvar Lib = require('../../lib');\nvar BADNUM = require('../../constants/numerical').BADNUM;\nvar getTopojsonFeatures = require('../../lib/topojson_utils').getTopojsonFeatures;\nvar locationToFeature = require('../../lib/geo_location_utils').locationToFeature;\nvar geoJsonUtils = require('../../lib/geojson_utils');\nvar subTypes = require('../scatter/subtypes');\nvar style = require('./style');\nmodule.exports = function plot(gd, geo, calcData) {\n  for (var i = 0; i < calcData.length; i++) {\n    calcGeoJSON(calcData[i], geo.topojson);\n  }\n  function removeBADNUM(d, node) {\n    if (d.lonlat[0] === BADNUM) {\n      d3.select(node).remove();\n    }\n  }\n  var scatterLayer = geo.layers.frontplot.select('.scatterlayer');\n  var gTraces = Lib.makeTraceGroups(scatterLayer, calcData, 'trace scattergeo');\n\n  // TODO find a way to order the inner nodes on update\n  gTraces.selectAll('*').remove();\n  gTraces.each(function (calcTrace) {\n    var s = calcTrace[0].node3 = d3.select(this);\n    var trace = calcTrace[0].trace;\n    if (subTypes.hasLines(trace) || trace.fill !== 'none') {\n      var lineCoords = geoJsonUtils.calcTraceToLineCoords(calcTrace);\n      var lineData = trace.fill !== 'none' ? geoJsonUtils.makePolygon(lineCoords) : geoJsonUtils.makeLine(lineCoords);\n      s.selectAll('path.js-line').data([{\n        geojson: lineData,\n        trace: trace\n      }]).enter().append('path').classed('js-line', true).style('stroke-miterlimit', 2);\n    }\n    if (subTypes.hasMarkers(trace)) {\n      s.selectAll('path.point').data(Lib.identity).enter().append('path').classed('point', true).each(function (calcPt) {\n        removeBADNUM(calcPt, this);\n      });\n    }\n    if (subTypes.hasText(trace)) {\n      s.selectAll('g').data(Lib.identity).enter().append('g').append('text').each(function (calcPt) {\n        removeBADNUM(calcPt, this);\n      });\n    }\n\n    // call style here within topojson request callback\n    style(gd, calcTrace);\n  });\n};\nfunction calcGeoJSON(calcTrace, topojson) {\n  var trace = calcTrace[0].trace;\n  if (!Array.isArray(trace.locations)) return;\n  var features = getTopojsonFeatures(trace, topojson);\n  var locationmode = trace.locationmode;\n  for (var i = 0; i < calcTrace.length; i++) {\n    var calcPt = calcTrace[i];\n    var feature = locationToFeature(locationmode, calcPt.loc, features);\n    calcPt.lonlat = feature ? feature.properties.ct : [BADNUM, BADNUM];\n  }\n}","map":{"version":3,"names":["d3","require","Lib","BADNUM","getTopojsonFeatures","locationToFeature","geoJsonUtils","subTypes","style","module","exports","plot","gd","geo","calcData","i","length","calcGeoJSON","topojson","removeBADNUM","d","node","lonlat","select","remove","scatterLayer","layers","frontplot","gTraces","makeTraceGroups","selectAll","each","calcTrace","s","node3","trace","hasLines","fill","lineCoords","calcTraceToLineCoords","lineData","makePolygon","makeLine","data","geojson","enter","append","classed","hasMarkers","identity","calcPt","hasText","Array","isArray","locations","features","locationmode","feature","loc","properties","ct"],"sources":["/home/yasmin/Ãrea de Trabalho/Frontend/node_modules/plotly.js/src/traces/scattergeo/plot.js"],"sourcesContent":["/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n\n'use strict';\n\nvar d3 = require('d3');\n\nvar Lib = require('../../lib');\nvar BADNUM = require('../../constants/numerical').BADNUM;\nvar getTopojsonFeatures = require('../../lib/topojson_utils').getTopojsonFeatures;\nvar locationToFeature = require('../../lib/geo_location_utils').locationToFeature;\nvar geoJsonUtils = require('../../lib/geojson_utils');\nvar subTypes = require('../scatter/subtypes');\nvar style = require('./style');\n\nmodule.exports = function plot(gd, geo, calcData) {\n    for(var i = 0; i < calcData.length; i++) {\n        calcGeoJSON(calcData[i], geo.topojson);\n    }\n\n    function removeBADNUM(d, node) {\n        if(d.lonlat[0] === BADNUM) {\n            d3.select(node).remove();\n        }\n    }\n\n    var scatterLayer = geo.layers.frontplot.select('.scatterlayer');\n    var gTraces = Lib.makeTraceGroups(scatterLayer, calcData, 'trace scattergeo');\n\n    // TODO find a way to order the inner nodes on update\n    gTraces.selectAll('*').remove();\n\n    gTraces.each(function(calcTrace) {\n        var s = calcTrace[0].node3 = d3.select(this);\n        var trace = calcTrace[0].trace;\n\n        if(subTypes.hasLines(trace) || trace.fill !== 'none') {\n            var lineCoords = geoJsonUtils.calcTraceToLineCoords(calcTrace);\n\n            var lineData = (trace.fill !== 'none') ?\n                geoJsonUtils.makePolygon(lineCoords) :\n                geoJsonUtils.makeLine(lineCoords);\n\n            s.selectAll('path.js-line')\n                .data([{geojson: lineData, trace: trace}])\n              .enter().append('path')\n                .classed('js-line', true)\n                .style('stroke-miterlimit', 2);\n        }\n\n        if(subTypes.hasMarkers(trace)) {\n            s.selectAll('path.point')\n                .data(Lib.identity)\n             .enter().append('path')\n                .classed('point', true)\n                .each(function(calcPt) { removeBADNUM(calcPt, this); });\n        }\n\n        if(subTypes.hasText(trace)) {\n            s.selectAll('g')\n                .data(Lib.identity)\n              .enter().append('g')\n                .append('text')\n                .each(function(calcPt) { removeBADNUM(calcPt, this); });\n        }\n\n        // call style here within topojson request callback\n        style(gd, calcTrace);\n    });\n};\n\nfunction calcGeoJSON(calcTrace, topojson) {\n    var trace = calcTrace[0].trace;\n\n    if(!Array.isArray(trace.locations)) return;\n\n    var features = getTopojsonFeatures(trace, topojson);\n    var locationmode = trace.locationmode;\n\n    for(var i = 0; i < calcTrace.length; i++) {\n        var calcPt = calcTrace[i];\n        var feature = locationToFeature(locationmode, calcPt.loc, features);\n\n        calcPt.lonlat = feature ? feature.properties.ct : [BADNUM, BADNUM];\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}