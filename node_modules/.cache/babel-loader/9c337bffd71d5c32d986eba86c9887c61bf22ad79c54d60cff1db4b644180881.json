{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar mapboxgl = require('mapbox-gl');\nvar Fx = require('../../components/fx');\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\nvar dragElement = require('../../components/dragelement');\nvar prepSelect = require('../cartesian/select').prepSelect;\nvar selectOnClick = require('../cartesian/select').selectOnClick;\nvar constants = require('./constants');\nvar layoutAttributes = require('./layout_attributes');\nvar createMapboxLayer = require('./layers');\nfunction Mapbox(opts) {\n  this.id = opts.id;\n  this.gd = opts.gd;\n  this.container = opts.container;\n  this.isStatic = opts.staticPlot;\n  var fullLayout = opts.fullLayout;\n\n  // unique id for this Mapbox instance\n  this.uid = fullLayout._uid + '-' + this.id;\n\n  // create framework on instantiation for a smoother first plot call\n  this.div = null;\n  this.xaxis = null;\n  this.yaxis = null;\n  this.createFramework(fullLayout);\n\n  // state variables used to infer how and what to update\n  this.map = null;\n  this.accessToken = null;\n  this.styleObj = null;\n  this.traceHash = {};\n  this.layerList = [];\n}\nvar proto = Mapbox.prototype;\nmodule.exports = function createMapbox(opts) {\n  return new Mapbox(opts);\n};\nproto.plot = function (calcData, fullLayout, promises) {\n  var self = this;\n  var opts = fullLayout[self.id];\n\n  // remove map and create a new map if access token has change\n  if (self.map && opts.accesstoken !== self.accessToken) {\n    self.map.remove();\n    self.map = null;\n    self.styleObj = null;\n    self.traceHash = [];\n    self.layerList = {};\n  }\n  var promise;\n  if (!self.map) {\n    promise = new Promise(function (resolve, reject) {\n      self.createMap(calcData, fullLayout, resolve, reject);\n    });\n  } else {\n    promise = new Promise(function (resolve, reject) {\n      self.updateMap(calcData, fullLayout, resolve, reject);\n    });\n  }\n  promises.push(promise);\n};\nproto.createMap = function (calcData, fullLayout, resolve, reject) {\n  var self = this;\n  var gd = self.gd;\n  var opts = fullLayout[self.id];\n\n  // store style id and URL or object\n  var styleObj = self.styleObj = getStyleObj(opts.style);\n\n  // store access token associated with this map\n  self.accessToken = opts.accesstoken;\n\n  // create the map!\n  var map = self.map = new mapboxgl.Map({\n    container: self.div,\n    style: styleObj.style,\n    center: convertCenter(opts.center),\n    zoom: opts.zoom,\n    bearing: opts.bearing,\n    pitch: opts.pitch,\n    interactive: !self.isStatic,\n    preserveDrawingBuffer: self.isStatic,\n    doubleClickZoom: false,\n    boxZoom: false\n  });\n\n  // clear navigation container\n  var className = constants.controlContainerClassName;\n  var controlContainer = self.div.getElementsByClassName(className)[0];\n  self.div.removeChild(controlContainer);\n\n  // make sure canvas does not inherit left and top css\n  map._canvas.style.left = '0px';\n  map._canvas.style.top = '0px';\n  self.rejectOnError(reject);\n  map.once('load', function () {\n    self.updateData(calcData);\n    self.updateLayout(fullLayout);\n    self.resolveOnRender(resolve);\n  });\n  if (self.isStatic) return;\n  var wheeling = false;\n\n  // keep track of pan / zoom in user layout and emit relayout event\n  map.on('moveend', function (eventData) {\n    if (!self.map) return;\n\n    // 'moveend' gets triggered by map.setCenter, map.setZoom,\n    // map.setBearing and map.setPitch.\n    //\n    // Here, we make sure that state updates amd 'plotly_relayout'\n    // are triggered only when the 'moveend' originates from a\n    // mouse target (filtering out API calls) to not\n    // duplicate 'plotly_relayout' events.\n\n    if (eventData.originalEvent || wheeling) {\n      var optsNow = gd._fullLayout[self.id];\n      Registry.call('_storeDirectGUIEdit', gd.layout, gd._fullLayout._preGUI, self.getViewEdits(optsNow));\n      var viewNow = self.getView();\n      optsNow._input.center = optsNow.center = viewNow.center;\n      optsNow._input.zoom = optsNow.zoom = viewNow.zoom;\n      optsNow._input.bearing = optsNow.bearing = viewNow.bearing;\n      optsNow._input.pitch = optsNow.pitch = viewNow.pitch;\n      gd.emit('plotly_relayout', self.getViewEdits(viewNow));\n    }\n    wheeling = false;\n  });\n  map.on('wheel', function () {\n    wheeling = true;\n  });\n  map.on('mousemove', function (evt) {\n    var bb = self.div.getBoundingClientRect();\n\n    // some hackery to get Fx.hover to work\n    evt.clientX = evt.point.x + bb.left;\n    evt.clientY = evt.point.y + bb.top;\n    evt.target.getBoundingClientRect = function () {\n      return bb;\n    };\n    self.xaxis.p2c = function () {\n      return evt.lngLat.lng;\n    };\n    self.yaxis.p2c = function () {\n      return evt.lngLat.lat;\n    };\n    Fx.hover(gd, evt, self.id);\n  });\n  function unhover() {\n    Fx.loneUnhover(fullLayout._toppaper);\n  }\n  map.on('dragstart', unhover);\n  map.on('zoomstart', unhover);\n  map.on('dblclick', function () {\n    var optsNow = gd._fullLayout[self.id];\n    Registry.call('_storeDirectGUIEdit', gd.layout, gd._fullLayout._preGUI, self.getViewEdits(optsNow));\n    var viewInitial = self.viewInitial;\n    map.setCenter(convertCenter(viewInitial.center));\n    map.setZoom(viewInitial.zoom);\n    map.setBearing(viewInitial.bearing);\n    map.setPitch(viewInitial.pitch);\n    var viewNow = self.getView();\n    optsNow._input.center = optsNow.center = viewNow.center;\n    optsNow._input.zoom = optsNow.zoom = viewNow.zoom;\n    optsNow._input.bearing = optsNow.bearing = viewNow.bearing;\n    optsNow._input.pitch = optsNow.pitch = viewNow.pitch;\n    gd.emit('plotly_doubleclick', null);\n    gd.emit('plotly_relayout', self.getViewEdits(viewNow));\n  });\n\n  // define event handlers on map creation, to keep one ref per map,\n  // so that map.on / map.off in updateFx works as expected\n  self.clearSelect = function () {\n    gd._fullLayout._zoomlayer.selectAll('.select-outline').remove();\n  };\n\n  /**\n   * Returns a click handler function that is supposed\n   * to handle clicks in pan mode.\n   */\n  self.onClickInPanFn = function (dragOptions) {\n    return function (evt) {\n      var clickMode = gd._fullLayout.clickmode;\n      if (clickMode.indexOf('select') > -1) {\n        selectOnClick(evt.originalEvent, gd, [self.xaxis], [self.yaxis], self.id, dragOptions);\n      }\n      if (clickMode.indexOf('event') > -1) {\n        // TODO: this does not support right-click. If we want to support it, we\n        // would likely need to change mapbox to use dragElement instead of straight\n        // mapbox event binding. Or perhaps better, make a simple wrapper with the\n        // right mousedown, mousemove, and mouseup handlers just for a left/right click\n        // pie would use this too.\n        Fx.click(gd, evt.originalEvent);\n      }\n    };\n  };\n};\nproto.updateMap = function (calcData, fullLayout, resolve, reject) {\n  var self = this;\n  var map = self.map;\n  var opts = fullLayout[this.id];\n  self.rejectOnError(reject);\n  var styleObj = getStyleObj(opts.style);\n  if (self.styleObj.id !== styleObj.id) {\n    self.styleObj = styleObj;\n    map.setStyle(styleObj.style);\n    map.once('styledata', function () {\n      // need to rebuild trace layers on reload\n      // to avoid 'lost event' errors\n      self.traceHash = {};\n      self.updateData(calcData);\n      self.updateLayout(fullLayout);\n      self.resolveOnRender(resolve);\n    });\n  } else {\n    self.updateData(calcData);\n    self.updateLayout(fullLayout);\n    self.resolveOnRender(resolve);\n  }\n  if (this.gd._context._scrollZoom.mapbox) {\n    map.scrollZoom.enable();\n  } else {\n    map.scrollZoom.disable();\n  }\n};\nproto.updateData = function (calcData) {\n  var traceHash = this.traceHash;\n  var traceObj, trace, i, j;\n\n  // update or create trace objects\n  for (i = 0; i < calcData.length; i++) {\n    var calcTrace = calcData[i];\n    trace = calcTrace[0].trace;\n    traceObj = traceHash[trace.uid];\n    if (traceObj) {\n      traceObj.update(calcTrace);\n    } else if (trace._module) {\n      traceHash[trace.uid] = trace._module.plot(this, calcTrace);\n    }\n  }\n\n  // remove empty trace objects\n  var ids = Object.keys(traceHash);\n  idLoop: for (i = 0; i < ids.length; i++) {\n    var id = ids[i];\n    for (j = 0; j < calcData.length; j++) {\n      trace = calcData[j][0].trace;\n      if (id === trace.uid) continue idLoop;\n    }\n    traceObj = traceHash[id];\n    traceObj.dispose();\n    delete traceHash[id];\n  }\n};\nproto.updateLayout = function (fullLayout) {\n  var map = this.map;\n  var opts = fullLayout[this.id];\n  map.setCenter(convertCenter(opts.center));\n  map.setZoom(opts.zoom);\n  map.setBearing(opts.bearing);\n  map.setPitch(opts.pitch);\n  this.updateLayers(fullLayout);\n  this.updateFramework(fullLayout);\n  this.updateFx(fullLayout);\n  this.map.resize();\n};\nproto.resolveOnRender = function (resolve) {\n  var map = this.map;\n  map.on('render', function onRender() {\n    if (map.loaded()) {\n      map.off('render', onRender);\n      // resolve at end of render loop\n      setTimeout(resolve, 0);\n    }\n  });\n};\nproto.rejectOnError = function (reject) {\n  var map = this.map;\n  function handler() {\n    reject(new Error(constants.mapOnErrorMsg));\n  }\n  map.once('error', handler);\n  map.once('style.error', handler);\n  map.once('source.error', handler);\n  map.once('tile.error', handler);\n  map.once('layer.error', handler);\n};\nproto.createFramework = function (fullLayout) {\n  var self = this;\n  var div = self.div = document.createElement('div');\n  div.id = self.uid;\n  div.style.position = 'absolute';\n  self.container.appendChild(div);\n\n  // create mock x/y axes for hover routine\n  self.xaxis = {\n    _id: 'x',\n    c2p: function c2p(v) {\n      return self.project(v).x;\n    }\n  };\n  self.yaxis = {\n    _id: 'y',\n    c2p: function c2p(v) {\n      return self.project(v).y;\n    }\n  };\n  self.updateFramework(fullLayout);\n};\nproto.updateFx = function (fullLayout) {\n  var self = this;\n  var map = self.map;\n  var gd = self.gd;\n  if (self.isStatic) return;\n  function invert(pxpy) {\n    var obj = self.map.unproject(pxpy);\n    return [obj.lng, obj.lat];\n  }\n  var dragMode = fullLayout.dragmode;\n  var fillRangeItems;\n  if (dragMode === 'select') {\n    fillRangeItems = function fillRangeItems(eventData, poly) {\n      var ranges = eventData.range = {};\n      ranges[self.id] = [invert([poly.xmin, poly.ymin]), invert([poly.xmax, poly.ymax])];\n    };\n  } else {\n    fillRangeItems = function fillRangeItems(eventData, poly, pts) {\n      var dataPts = eventData.lassoPoints = {};\n      dataPts[self.id] = pts.filtered.map(invert);\n    };\n  }\n\n  // Note: dragOptions is needed to be declared for all dragmodes because\n  // it's the object that holds persistent selection state.\n  // Merge old dragOptions with new to keep possibly initialized\n  // persistent selection state.\n  var oldDragOptions = self.dragOptions;\n  self.dragOptions = Lib.extendDeep(oldDragOptions || {}, {\n    element: self.div,\n    gd: gd,\n    plotinfo: {\n      id: self.id,\n      xaxis: self.xaxis,\n      yaxis: self.yaxis,\n      fillRangeItems: fillRangeItems\n    },\n    xaxes: [self.xaxis],\n    yaxes: [self.yaxis],\n    subplot: self.id\n  });\n\n  // Unregister the old handler before potentially registering\n  // a new one. Otherwise multiple click handlers might\n  // be registered resulting in unwanted behavior.\n  map.off('click', self.onClickInPanHandler);\n  if (dragMode === 'select' || dragMode === 'lasso') {\n    map.dragPan.disable();\n    map.on('zoomstart', self.clearSelect);\n    self.dragOptions.prepFn = function (e, startX, startY) {\n      prepSelect(e, startX, startY, self.dragOptions, dragMode);\n    };\n    dragElement.init(self.dragOptions);\n  } else {\n    map.dragPan.enable();\n    map.off('zoomstart', self.clearSelect);\n    self.div.onmousedown = null;\n\n    // TODO: this does not support right-click. If we want to support it, we\n    // would likely need to change mapbox to use dragElement instead of straight\n    // mapbox event binding. Or perhaps better, make a simple wrapper with the\n    // right mousedown, mousemove, and mouseup handlers just for a left/right click\n    // pie would use this too.\n    self.onClickInPanHandler = self.onClickInPanFn(self.dragOptions);\n    map.on('click', self.onClickInPanHandler);\n  }\n};\nproto.updateFramework = function (fullLayout) {\n  var domain = fullLayout[this.id].domain;\n  var size = fullLayout._size;\n  var style = this.div.style;\n  style.width = size.w * (domain.x[1] - domain.x[0]) + 'px';\n  style.height = size.h * (domain.y[1] - domain.y[0]) + 'px';\n  style.left = size.l + domain.x[0] * size.w + 'px';\n  style.top = size.t + (1 - domain.y[1]) * size.h + 'px';\n  this.xaxis._offset = size.l + domain.x[0] * size.w;\n  this.xaxis._length = size.w * (domain.x[1] - domain.x[0]);\n  this.yaxis._offset = size.t + (1 - domain.y[1]) * size.h;\n  this.yaxis._length = size.h * (domain.y[1] - domain.y[0]);\n};\nproto.updateLayers = function (fullLayout) {\n  var opts = fullLayout[this.id];\n  var layers = opts.layers;\n  var layerList = this.layerList;\n  var i;\n\n  // if the layer arrays don't match,\n  // don't try to be smart,\n  // delete them all, and start all over.\n\n  if (layers.length !== layerList.length) {\n    for (i = 0; i < layerList.length; i++) {\n      layerList[i].dispose();\n    }\n    layerList = this.layerList = [];\n    for (i = 0; i < layers.length; i++) {\n      layerList.push(createMapboxLayer(this, i, layers[i]));\n    }\n  } else {\n    for (i = 0; i < layers.length; i++) {\n      layerList[i].update(layers[i]);\n    }\n  }\n};\nproto.destroy = function () {\n  if (this.map) {\n    this.map.remove();\n    this.map = null;\n    this.container.removeChild(this.div);\n  }\n};\nproto.toImage = function () {\n  this.map.stop();\n  return this.map.getCanvas().toDataURL();\n};\n\n// convenience wrapper to create set multiple layer\n// 'layout' or 'paint options at once.\nproto.setOptions = function (id, methodName, opts) {\n  for (var k in opts) {\n    this.map[methodName](id, k, opts[k]);\n  }\n};\n\n// convenience method to project a [lon, lat] array to pixel coords\nproto.project = function (v) {\n  return this.map.project(new mapboxgl.LngLat(v[0], v[1]));\n};\n\n// get map's current view values in plotly.js notation\nproto.getView = function () {\n  var map = this.map;\n  var mapCenter = map.getCenter();\n  var center = {\n    lon: mapCenter.lng,\n    lat: mapCenter.lat\n  };\n  return {\n    center: center,\n    zoom: map.getZoom(),\n    bearing: map.getBearing(),\n    pitch: map.getPitch()\n  };\n};\nproto.getViewEdits = function (cont) {\n  var id = this.id;\n  var keys = ['center', 'zoom', 'bearing', 'pitch'];\n  var obj = {};\n  for (var i = 0; i < keys.length; i++) {\n    var k = keys[i];\n    obj[id + '.' + k] = cont[k];\n  }\n  return obj;\n};\nfunction getStyleObj(val) {\n  var styleValues = layoutAttributes.style.values;\n  var styleDflt = layoutAttributes.style.dflt;\n  var styleObj = {};\n  if (Lib.isPlainObject(val)) {\n    styleObj.id = val.id;\n    styleObj.style = val;\n  } else if (typeof val === 'string') {\n    styleObj.id = val;\n    styleObj.style = styleValues.indexOf(val) !== -1 ? convertStyleVal(val) : val;\n  } else {\n    styleObj.id = styleDflt;\n    styleObj.style = convertStyleVal(styleDflt);\n  }\n  styleObj.transition = {\n    duration: 0,\n    delay: 0\n  };\n  return styleObj;\n}\n\n// if style is part of the 'official' mapbox values, add URL prefix and suffix\nfunction convertStyleVal(val) {\n  return constants.styleUrlPrefix + val + '-' + constants.styleUrlSuffix;\n}\nfunction convertCenter(center) {\n  return [center.lon, center.lat];\n}","map":{"version":3,"names":["mapboxgl","require","Fx","Lib","Registry","dragElement","prepSelect","selectOnClick","constants","layoutAttributes","createMapboxLayer","Mapbox","opts","id","gd","container","isStatic","staticPlot","fullLayout","uid","_uid","div","xaxis","yaxis","createFramework","map","accessToken","styleObj","traceHash","layerList","proto","prototype","module","exports","createMapbox","plot","calcData","promises","self","accesstoken","remove","promise","Promise","resolve","reject","createMap","updateMap","push","getStyleObj","style","Map","center","convertCenter","zoom","bearing","pitch","interactive","preserveDrawingBuffer","doubleClickZoom","boxZoom","className","controlContainerClassName","controlContainer","getElementsByClassName","removeChild","_canvas","left","top","rejectOnError","once","updateData","updateLayout","resolveOnRender","wheeling","on","eventData","originalEvent","optsNow","_fullLayout","call","layout","_preGUI","getViewEdits","viewNow","getView","_input","emit","evt","bb","getBoundingClientRect","clientX","point","x","clientY","y","target","p2c","lngLat","lng","lat","hover","unhover","loneUnhover","_toppaper","viewInitial","setCenter","setZoom","setBearing","setPitch","clearSelect","_zoomlayer","selectAll","onClickInPanFn","dragOptions","clickMode","clickmode","indexOf","click","setStyle","_context","_scrollZoom","mapbox","scrollZoom","enable","disable","traceObj","trace","i","j","length","calcTrace","update","_module","ids","Object","keys","idLoop","dispose","updateLayers","updateFramework","updateFx","resize","onRender","loaded","off","setTimeout","handler","Error","mapOnErrorMsg","document","createElement","position","appendChild","_id","c2p","v","project","invert","pxpy","obj","unproject","dragMode","dragmode","fillRangeItems","poly","ranges","range","xmin","ymin","xmax","ymax","pts","dataPts","lassoPoints","filtered","oldDragOptions","extendDeep","element","plotinfo","xaxes","yaxes","subplot","onClickInPanHandler","dragPan","prepFn","e","startX","startY","init","onmousedown","domain","size","_size","width","w","height","h","l","t","_offset","_length","layers","destroy","toImage","stop","getCanvas","toDataURL","setOptions","methodName","k","LngLat","mapCenter","getCenter","lon","getZoom","getBearing","getPitch","cont","val","styleValues","values","styleDflt","dflt","isPlainObject","convertStyleVal","transition","duration","delay","styleUrlPrefix","styleUrlSuffix"],"sources":["/home/yasmin/Ãrea de Trabalho/Frontend/node_modules/plotly.js/src/plots/mapbox/mapbox.js"],"sourcesContent":["/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n\n'use strict';\n\nvar mapboxgl = require('mapbox-gl');\n\nvar Fx = require('../../components/fx');\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\nvar dragElement = require('../../components/dragelement');\nvar prepSelect = require('../cartesian/select').prepSelect;\nvar selectOnClick = require('../cartesian/select').selectOnClick;\nvar constants = require('./constants');\nvar layoutAttributes = require('./layout_attributes');\nvar createMapboxLayer = require('./layers');\n\nfunction Mapbox(opts) {\n    this.id = opts.id;\n    this.gd = opts.gd;\n    this.container = opts.container;\n    this.isStatic = opts.staticPlot;\n\n    var fullLayout = opts.fullLayout;\n\n    // unique id for this Mapbox instance\n    this.uid = fullLayout._uid + '-' + this.id;\n\n    // create framework on instantiation for a smoother first plot call\n    this.div = null;\n    this.xaxis = null;\n    this.yaxis = null;\n    this.createFramework(fullLayout);\n\n    // state variables used to infer how and what to update\n    this.map = null;\n    this.accessToken = null;\n    this.styleObj = null;\n    this.traceHash = {};\n    this.layerList = [];\n}\n\nvar proto = Mapbox.prototype;\n\nmodule.exports = function createMapbox(opts) {\n    return new Mapbox(opts);\n};\n\nproto.plot = function(calcData, fullLayout, promises) {\n    var self = this;\n    var opts = fullLayout[self.id];\n\n    // remove map and create a new map if access token has change\n    if(self.map && (opts.accesstoken !== self.accessToken)) {\n        self.map.remove();\n        self.map = null;\n        self.styleObj = null;\n        self.traceHash = [];\n        self.layerList = {};\n    }\n\n    var promise;\n\n    if(!self.map) {\n        promise = new Promise(function(resolve, reject) {\n            self.createMap(calcData, fullLayout, resolve, reject);\n        });\n    } else {\n        promise = new Promise(function(resolve, reject) {\n            self.updateMap(calcData, fullLayout, resolve, reject);\n        });\n    }\n\n    promises.push(promise);\n};\n\nproto.createMap = function(calcData, fullLayout, resolve, reject) {\n    var self = this;\n    var gd = self.gd;\n    var opts = fullLayout[self.id];\n\n    // store style id and URL or object\n    var styleObj = self.styleObj = getStyleObj(opts.style);\n\n    // store access token associated with this map\n    self.accessToken = opts.accesstoken;\n\n    // create the map!\n    var map = self.map = new mapboxgl.Map({\n        container: self.div,\n\n        style: styleObj.style,\n        center: convertCenter(opts.center),\n        zoom: opts.zoom,\n        bearing: opts.bearing,\n        pitch: opts.pitch,\n\n        interactive: !self.isStatic,\n        preserveDrawingBuffer: self.isStatic,\n\n        doubleClickZoom: false,\n        boxZoom: false\n    });\n\n    // clear navigation container\n    var className = constants.controlContainerClassName;\n    var controlContainer = self.div.getElementsByClassName(className)[0];\n    self.div.removeChild(controlContainer);\n\n    // make sure canvas does not inherit left and top css\n    map._canvas.style.left = '0px';\n    map._canvas.style.top = '0px';\n\n    self.rejectOnError(reject);\n\n    map.once('load', function() {\n        self.updateData(calcData);\n        self.updateLayout(fullLayout);\n        self.resolveOnRender(resolve);\n    });\n\n    if(self.isStatic) return;\n\n    var wheeling = false;\n\n    // keep track of pan / zoom in user layout and emit relayout event\n    map.on('moveend', function(eventData) {\n        if(!self.map) return;\n\n        // 'moveend' gets triggered by map.setCenter, map.setZoom,\n        // map.setBearing and map.setPitch.\n        //\n        // Here, we make sure that state updates amd 'plotly_relayout'\n        // are triggered only when the 'moveend' originates from a\n        // mouse target (filtering out API calls) to not\n        // duplicate 'plotly_relayout' events.\n\n        if(eventData.originalEvent || wheeling) {\n            var optsNow = gd._fullLayout[self.id];\n            Registry.call('_storeDirectGUIEdit', gd.layout, gd._fullLayout._preGUI, self.getViewEdits(optsNow));\n\n            var viewNow = self.getView();\n            optsNow._input.center = optsNow.center = viewNow.center;\n            optsNow._input.zoom = optsNow.zoom = viewNow.zoom;\n            optsNow._input.bearing = optsNow.bearing = viewNow.bearing;\n            optsNow._input.pitch = optsNow.pitch = viewNow.pitch;\n\n            gd.emit('plotly_relayout', self.getViewEdits(viewNow));\n        }\n        wheeling = false;\n    });\n\n    map.on('wheel', function() {\n        wheeling = true;\n    });\n\n    map.on('mousemove', function(evt) {\n        var bb = self.div.getBoundingClientRect();\n\n        // some hackery to get Fx.hover to work\n        evt.clientX = evt.point.x + bb.left;\n        evt.clientY = evt.point.y + bb.top;\n\n        evt.target.getBoundingClientRect = function() { return bb; };\n\n        self.xaxis.p2c = function() { return evt.lngLat.lng; };\n        self.yaxis.p2c = function() { return evt.lngLat.lat; };\n\n        Fx.hover(gd, evt, self.id);\n    });\n\n    function unhover() {\n        Fx.loneUnhover(fullLayout._toppaper);\n    }\n\n    map.on('dragstart', unhover);\n    map.on('zoomstart', unhover);\n\n    map.on('dblclick', function() {\n        var optsNow = gd._fullLayout[self.id];\n        Registry.call('_storeDirectGUIEdit', gd.layout, gd._fullLayout._preGUI, self.getViewEdits(optsNow));\n\n        var viewInitial = self.viewInitial;\n        map.setCenter(convertCenter(viewInitial.center));\n        map.setZoom(viewInitial.zoom);\n        map.setBearing(viewInitial.bearing);\n        map.setPitch(viewInitial.pitch);\n\n        var viewNow = self.getView();\n        optsNow._input.center = optsNow.center = viewNow.center;\n        optsNow._input.zoom = optsNow.zoom = viewNow.zoom;\n        optsNow._input.bearing = optsNow.bearing = viewNow.bearing;\n        optsNow._input.pitch = optsNow.pitch = viewNow.pitch;\n\n        gd.emit('plotly_doubleclick', null);\n        gd.emit('plotly_relayout', self.getViewEdits(viewNow));\n    });\n\n    // define event handlers on map creation, to keep one ref per map,\n    // so that map.on / map.off in updateFx works as expected\n    self.clearSelect = function() {\n        gd._fullLayout._zoomlayer.selectAll('.select-outline').remove();\n    };\n\n    /**\n     * Returns a click handler function that is supposed\n     * to handle clicks in pan mode.\n     */\n    self.onClickInPanFn = function(dragOptions) {\n        return function(evt) {\n            var clickMode = gd._fullLayout.clickmode;\n\n            if(clickMode.indexOf('select') > -1) {\n                selectOnClick(evt.originalEvent, gd, [self.xaxis], [self.yaxis], self.id, dragOptions);\n            }\n\n            if(clickMode.indexOf('event') > -1) {\n                // TODO: this does not support right-click. If we want to support it, we\n                // would likely need to change mapbox to use dragElement instead of straight\n                // mapbox event binding. Or perhaps better, make a simple wrapper with the\n                // right mousedown, mousemove, and mouseup handlers just for a left/right click\n                // pie would use this too.\n                Fx.click(gd, evt.originalEvent);\n            }\n        };\n    };\n};\n\nproto.updateMap = function(calcData, fullLayout, resolve, reject) {\n    var self = this;\n    var map = self.map;\n    var opts = fullLayout[this.id];\n\n    self.rejectOnError(reject);\n\n    var styleObj = getStyleObj(opts.style);\n\n    if(self.styleObj.id !== styleObj.id) {\n        self.styleObj = styleObj;\n        map.setStyle(styleObj.style);\n\n        map.once('styledata', function() {\n            // need to rebuild trace layers on reload\n            // to avoid 'lost event' errors\n            self.traceHash = {};\n            self.updateData(calcData);\n            self.updateLayout(fullLayout);\n            self.resolveOnRender(resolve);\n        });\n    } else {\n        self.updateData(calcData);\n        self.updateLayout(fullLayout);\n        self.resolveOnRender(resolve);\n    }\n\n    if(this.gd._context._scrollZoom.mapbox) {\n        map.scrollZoom.enable();\n    } else {\n        map.scrollZoom.disable();\n    }\n};\n\nproto.updateData = function(calcData) {\n    var traceHash = this.traceHash;\n    var traceObj, trace, i, j;\n\n    // update or create trace objects\n    for(i = 0; i < calcData.length; i++) {\n        var calcTrace = calcData[i];\n\n        trace = calcTrace[0].trace;\n        traceObj = traceHash[trace.uid];\n\n        if(traceObj) {\n            traceObj.update(calcTrace);\n        } else if(trace._module) {\n            traceHash[trace.uid] = trace._module.plot(this, calcTrace);\n        }\n    }\n\n    // remove empty trace objects\n    var ids = Object.keys(traceHash);\n    idLoop:\n    for(i = 0; i < ids.length; i++) {\n        var id = ids[i];\n\n        for(j = 0; j < calcData.length; j++) {\n            trace = calcData[j][0].trace;\n            if(id === trace.uid) continue idLoop;\n        }\n\n        traceObj = traceHash[id];\n        traceObj.dispose();\n        delete traceHash[id];\n    }\n};\n\nproto.updateLayout = function(fullLayout) {\n    var map = this.map;\n    var opts = fullLayout[this.id];\n\n    map.setCenter(convertCenter(opts.center));\n    map.setZoom(opts.zoom);\n    map.setBearing(opts.bearing);\n    map.setPitch(opts.pitch);\n\n    this.updateLayers(fullLayout);\n    this.updateFramework(fullLayout);\n    this.updateFx(fullLayout);\n    this.map.resize();\n};\n\nproto.resolveOnRender = function(resolve) {\n    var map = this.map;\n\n    map.on('render', function onRender() {\n        if(map.loaded()) {\n            map.off('render', onRender);\n            // resolve at end of render loop\n            setTimeout(resolve, 0);\n        }\n    });\n};\n\nproto.rejectOnError = function(reject) {\n    var map = this.map;\n\n    function handler() {\n        reject(new Error(constants.mapOnErrorMsg));\n    }\n\n    map.once('error', handler);\n    map.once('style.error', handler);\n    map.once('source.error', handler);\n    map.once('tile.error', handler);\n    map.once('layer.error', handler);\n};\n\nproto.createFramework = function(fullLayout) {\n    var self = this;\n\n    var div = self.div = document.createElement('div');\n    div.id = self.uid;\n    div.style.position = 'absolute';\n    self.container.appendChild(div);\n\n    // create mock x/y axes for hover routine\n    self.xaxis = {\n        _id: 'x',\n        c2p: function(v) { return self.project(v).x; }\n    };\n    self.yaxis = {\n        _id: 'y',\n        c2p: function(v) { return self.project(v).y; }\n    };\n\n    self.updateFramework(fullLayout);\n};\n\nproto.updateFx = function(fullLayout) {\n    var self = this;\n    var map = self.map;\n    var gd = self.gd;\n\n    if(self.isStatic) return;\n\n    function invert(pxpy) {\n        var obj = self.map.unproject(pxpy);\n        return [obj.lng, obj.lat];\n    }\n\n    var dragMode = fullLayout.dragmode;\n    var fillRangeItems;\n\n    if(dragMode === 'select') {\n        fillRangeItems = function(eventData, poly) {\n            var ranges = eventData.range = {};\n            ranges[self.id] = [\n                invert([poly.xmin, poly.ymin]),\n                invert([poly.xmax, poly.ymax])\n            ];\n        };\n    } else {\n        fillRangeItems = function(eventData, poly, pts) {\n            var dataPts = eventData.lassoPoints = {};\n            dataPts[self.id] = pts.filtered.map(invert);\n        };\n    }\n\n    // Note: dragOptions is needed to be declared for all dragmodes because\n    // it's the object that holds persistent selection state.\n    // Merge old dragOptions with new to keep possibly initialized\n    // persistent selection state.\n    var oldDragOptions = self.dragOptions;\n    self.dragOptions = Lib.extendDeep(oldDragOptions || {}, {\n        element: self.div,\n        gd: gd,\n        plotinfo: {\n            id: self.id,\n            xaxis: self.xaxis,\n            yaxis: self.yaxis,\n            fillRangeItems: fillRangeItems\n        },\n        xaxes: [self.xaxis],\n        yaxes: [self.yaxis],\n        subplot: self.id\n    });\n\n    // Unregister the old handler before potentially registering\n    // a new one. Otherwise multiple click handlers might\n    // be registered resulting in unwanted behavior.\n    map.off('click', self.onClickInPanHandler);\n    if(dragMode === 'select' || dragMode === 'lasso') {\n        map.dragPan.disable();\n        map.on('zoomstart', self.clearSelect);\n\n        self.dragOptions.prepFn = function(e, startX, startY) {\n            prepSelect(e, startX, startY, self.dragOptions, dragMode);\n        };\n\n        dragElement.init(self.dragOptions);\n    } else {\n        map.dragPan.enable();\n        map.off('zoomstart', self.clearSelect);\n        self.div.onmousedown = null;\n\n        // TODO: this does not support right-click. If we want to support it, we\n        // would likely need to change mapbox to use dragElement instead of straight\n        // mapbox event binding. Or perhaps better, make a simple wrapper with the\n        // right mousedown, mousemove, and mouseup handlers just for a left/right click\n        // pie would use this too.\n        self.onClickInPanHandler = self.onClickInPanFn(self.dragOptions);\n        map.on('click', self.onClickInPanHandler);\n    }\n};\n\nproto.updateFramework = function(fullLayout) {\n    var domain = fullLayout[this.id].domain;\n    var size = fullLayout._size;\n\n    var style = this.div.style;\n    style.width = size.w * (domain.x[1] - domain.x[0]) + 'px';\n    style.height = size.h * (domain.y[1] - domain.y[0]) + 'px';\n    style.left = size.l + domain.x[0] * size.w + 'px';\n    style.top = size.t + (1 - domain.y[1]) * size.h + 'px';\n\n    this.xaxis._offset = size.l + domain.x[0] * size.w;\n    this.xaxis._length = size.w * (domain.x[1] - domain.x[0]);\n\n    this.yaxis._offset = size.t + (1 - domain.y[1]) * size.h;\n    this.yaxis._length = size.h * (domain.y[1] - domain.y[0]);\n};\n\nproto.updateLayers = function(fullLayout) {\n    var opts = fullLayout[this.id];\n    var layers = opts.layers;\n    var layerList = this.layerList;\n    var i;\n\n    // if the layer arrays don't match,\n    // don't try to be smart,\n    // delete them all, and start all over.\n\n    if(layers.length !== layerList.length) {\n        for(i = 0; i < layerList.length; i++) {\n            layerList[i].dispose();\n        }\n\n        layerList = this.layerList = [];\n\n        for(i = 0; i < layers.length; i++) {\n            layerList.push(createMapboxLayer(this, i, layers[i]));\n        }\n    } else {\n        for(i = 0; i < layers.length; i++) {\n            layerList[i].update(layers[i]);\n        }\n    }\n};\n\nproto.destroy = function() {\n    if(this.map) {\n        this.map.remove();\n        this.map = null;\n        this.container.removeChild(this.div);\n    }\n};\n\nproto.toImage = function() {\n    this.map.stop();\n    return this.map.getCanvas().toDataURL();\n};\n\n// convenience wrapper to create set multiple layer\n// 'layout' or 'paint options at once.\nproto.setOptions = function(id, methodName, opts) {\n    for(var k in opts) {\n        this.map[methodName](id, k, opts[k]);\n    }\n};\n\n// convenience method to project a [lon, lat] array to pixel coords\nproto.project = function(v) {\n    return this.map.project(new mapboxgl.LngLat(v[0], v[1]));\n};\n\n// get map's current view values in plotly.js notation\nproto.getView = function() {\n    var map = this.map;\n    var mapCenter = map.getCenter();\n    var center = { lon: mapCenter.lng, lat: mapCenter.lat };\n\n    return {\n        center: center,\n        zoom: map.getZoom(),\n        bearing: map.getBearing(),\n        pitch: map.getPitch()\n    };\n};\n\nproto.getViewEdits = function(cont) {\n    var id = this.id;\n    var keys = ['center', 'zoom', 'bearing', 'pitch'];\n    var obj = {};\n\n    for(var i = 0; i < keys.length; i++) {\n        var k = keys[i];\n        obj[id + '.' + k] = cont[k];\n    }\n\n    return obj;\n};\n\nfunction getStyleObj(val) {\n    var styleValues = layoutAttributes.style.values;\n    var styleDflt = layoutAttributes.style.dflt;\n    var styleObj = {};\n\n    if(Lib.isPlainObject(val)) {\n        styleObj.id = val.id;\n        styleObj.style = val;\n    } else if(typeof val === 'string') {\n        styleObj.id = val;\n        styleObj.style = (styleValues.indexOf(val) !== -1) ?\n             convertStyleVal(val) :\n             val;\n    } else {\n        styleObj.id = styleDflt;\n        styleObj.style = convertStyleVal(styleDflt);\n    }\n\n    styleObj.transition = {duration: 0, delay: 0};\n\n    return styleObj;\n}\n\n// if style is part of the 'official' mapbox values, add URL prefix and suffix\nfunction convertStyleVal(val) {\n    return constants.styleUrlPrefix + val + '-' + constants.styleUrlSuffix;\n}\n\nfunction convertCenter(center) {\n    return [center.lon, center.lat];\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}